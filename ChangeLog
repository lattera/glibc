2003-03-01  GOTO Masanori  <gotom@debian.or.jp>

	* argp/argp.h: Fix a typo.
	Reported by H.S.Teoh <hsteoh@quickfur.ath.cx>.

	* manual/terminal.texi: Fix cfmakeraw() definition from int to void.

2003-02-27  Pat Rankin  <rankin@pactechdata.com>

	* posix/regexec.c (proceed_next_node): Cast re_string_get_buffer to
	char *.
	(get_subexp): Likewise.

2003-03-01  GOTO Masanori  <gotom@debian.or.jp>

	* sysdeps/unix/sysv/linux/sparc/bits/fcntl.h (O_DIRECT): Define.

2003-02-26  Steven Munroe  <sjmunroe@us.ibm.com>

	* sysdeps/unix/sysv/linux/powerpc/bits/fcntl.h (O_DIRECT): Define.

2003-02-27  Roland McGrath  <roland@redhat.com>

	* sysdeps/powerpc/powerpc64/dl-machine.h (elf_machine_rela): Remove
	special case for dl_rtld_map in R_PPC64_RELATIVE; it's harmless to
	repeat it and avoids the test for the common case.
	Clean up and fix calculations for TLS relocs.

	* sysdeps/powerpc/powerpc64/dl-tls.h: Moved to ...
	* sysdeps/powerpc/dl-tls.h: ... here.
	(TLS_TP_OFFSET): New macro.

	* sunrpc/svc_udp.c (svcudp_recv): Add a cast to last change.

2003-02-27  Ulrich Drepper  <drepper@redhat.com>

	* sysdeps/i386/fpu/libm-test-ulps: Increase ULPs for yn due to
	code generation changes in recent gcc.

2003-02-26  Steven Munroe  <sjmunroe@us.ibm.com>

	* sysdeps/powerpc/fpu/fpu_control.h (_FPU_GETCW, _FPU_SETCW):
	Rename argument to avoid symbol conflict.

	* sysdeps/unix/sysv/linux/powerpc/bits/fcntl.h
	[__USE_GNU] (O_DIRECT): New macro.

2003-02-24  David Mosberger  <davidm@hpl.hp.com>

	* sysdeps/unix/sysv/linux/ia64/sysdep.S (__syscall_error): Fix
	unwind info.

2003-02-27  Ulrich Drepper  <drepper@redhat.com>

	* resolv/res_libc.c [USE___THREAD] (_res): Don't need the
	initializer anymore now that res_thread_freeres is more careful.

	* sunrpc/svc_udp.c (svcudp_recv): Remove all control messages
	except the PKTINFO.  Reset interface in PKTINFO.
	Patch by Neil Brown <neilb@cse.unsw.edu.au> [PR libc/4973].

2003-02-25  Steven Munroe  <sjmunroe@us.ibm.com>

	* elf/elf.h: Add new R_PPC64_* relocs for TLS.
	* elf/tls-macros.h [__powerpc64__] (TLS_LE, TLS_IE, TLS_LD, TLS_GD):
	Define.
	* sysdeps/powerpc/powerpc64/elf/configure.in: New file.
	* sysdeps/powerpc/powerpc64/elf/configure: New file (generated).
	* sysdeps/powerpc/powerpc64/dl-machine.h: Support new TLS relocs.
	* sysdeps/powerpc/powerpc64/dl-tls.h: New file.

	* sysdeps/powerpc/elf/libc-start.c (__libc_start_main):
	Do DL_SYSDEP_OSCHECK here, matching 2002-12-01 change to generic file.

2003-02-25  Andreas Jaeger  <aj@suse.de>

	* manual/memory.texi (Malloc Tunable Parameters): Clarify
	behaviour of M_MMAP_THRESHOLD.

2003-02-25  Roland McGrath  <roland@redhat.com>

	* resolv/res_init.c (res_thread_freeres): Bail out if _res.nscount is
	zero, inidicating _res was not initialized yet.

2003-02-24  Ulrich Drepper  <drepper@redhat.com>

	* sysdeps/unix/sysv/linux/ttyname_r.c (__ttyname_r): Remove EACCES
	test.

2003-02-24  Roland McGrath  <roland@redhat.com>

	* sysdeps/posix/pause.c: Add LIBC_CANCEL_HANDLED.

2003-02-23  Roland McGrath  <roland@redhat.com>

	* sysdeps/posix/pause.c: New file.
	* sysdeps/unix/common/pause.c: File removed.

2003-02-23  Ulrich Drepper  <drepper@redhat.com>

	* sysdeps/generic/bits/confname.h: Remove #ifs.

	* posix/Makefile (CFLAGS-regex.c): Remove RE_ENABLE_I18N definition.
	* posix/regex_internal.h (RE_ENABLE_I18N): Pretty printing.

	* resolv/res_libc.c [USE___THREAD] (_res): Initialize _vcsock
	element to -1.

2003-02-22  Ulrich Drepper  <drepper@redhat.com>

	* sysdeps/generic/dl-sysdep.c: Avoid warning.

2003-02-22  Roland McGrath  <roland@redhat.com>

	* resolv/tst-leaks.c: New file by Daniel Jacobowitz <drow@mvista.com>.
	* resolv/Makefile (tests): Add tst-leaks.
	($(objpfx)tst-leaks): Depend on $(objpfx)libresolv.so.
	(tst-leaks-ENV): New variable.
	($(objpfx)mtrace-tst-leaks): New target.
	(tests): Depend on it.

	* include/libc-internal.h: Declare __libc_thread_freeres.

	* Makerules: Fix last change to use $($(subdir)-version) when set.

	* Makerules (install-lib-nosubdir): Depend on installed
	libfoo-X.Y.Z.so and libfoo.so.NN files so they are installed
	regardless of the libfoo.so target's dependencies.

	* MakeTAGS (sub-make-vars): New variable, includes generating=t.
	Use that in $(MAKE) calls.

2003-02-22  Ulrich Drepper  <drepper@redhat.com>

	* catgets/gencat.c (read_input_file): Collision between
	auto-assigned numbers and user-defined nubmers is not fatal.
	Handle it.
	Patch by Michael M. Lampkin <michael.lampkin@ieee.org>.
	* catgets/Makefile: Add rules to run test2.msg test.
	* catgets/test2.msg: New file.

	* catgets/gencat.c (main): Return 1 if messages have been printed.

	* iconv/iconv_prog.c (main): Unify messages.

	* stdlib/strtod.c (INTERNAL): Remove bogus clearing of second word
	when shifting retval.
	* stdlib/tst-strtod.c (main): Add strtold test case.
	Reported by Fred J. Tydeman <tydeman@tybor.com>.

2003-02-21  Roland McGrath  <roland@redhat.com>

	* malloc/thread-freeres.c: Conditionalize on _LIBC_REENTRANT.
	* sunrpc/rpc_thread.c: Likewise for text_set_element use.
	(__rpc_thread_destroy): Add it to __libc_subfreeres too.

	* include/resolv.h: Add libc_hidden_proto for __res_nclose.
	* resolv/res_init.c (__res_nclose): Add libc_hidden_def.
	(res_thread_freeres): New function, on __libc_thread_subfreeres and
	__libc_subfreeres.

	* malloc/Versions (libc: GLIBC_PRIVATE): Add __libc_thread_freeres.
	* malloc/thread-freeres.c: New file.
	* malloc/Makefile (aux): Add it.
	* sunrpc/Versions (libc: GLIBC_PRIVATE): Removed.
	* sunrpc/rpc_thread.c (__rpc_thread_destroy): Put in special section
	"__libc_thread_freeres_fn" and add to __libc_thread_subfreeres set.

	* sysdeps/unix/sysv/linux/i386/geteuid.c (__geteuid): Typo fix.
	* sysdeps/unix/sysv/linux/i386/getgid.c (__getgid): Typo fix.

2003-02-21  Roland McGrath  <roland@frob.com>

	* sysdeps/mach/hurd/opendir.c (__opendir): Use O_NONBLOCK in open.

	* iconvdata/Makefile (tests): Add bug-iconv3 only if
	[$(have-thread-library) = yes].

2003-02-21  Ulrich Drepper  <drepper@redhat.com>

	* sysdeps/unix/sysv/linux/bits/signum.h (__SIGRTMAX): Define as _NSIG.

	* sysdeps/unix/sysv/linux/i386/getuid.c: Use INTERNAL_SYSCALL and do
	not chechk for errors (unless testing for 32bit variant).
	* sysdeps/unix/sysv/linux/i386/getgid.c: Likewise.
	* sysdeps/unix/sysv/linux/i386/geteuid.c: Likewise.
	* sysdeps/unix/sysv/linux/i386/getegid.c: Likewise.

2003-02-21  Jakub Jelinek  <jakub@redhat.com>

	* sysdeps/x86_64/dl-machine.h (elf_machine_rela) <R_X86_64_PC32>:
	Check for signed overflow, not unsigned.

	* sysdeps/sparc/sparc64/elf/configure.in: New file.
	* sysdeps/unix/sysv/linux/sparc/sparc64/Makefile (sysdep-CFLAGS):
	Use -fcall-used-g6, not -fcall-used-g7.

2003-02-21  Andreas Jaeger  <aj@suse.de>

	* sysdeps/x86_64/fpu/fesetenv.c (fesetenv): Fix setting of default
	mode.

	* sysdeps/x86_64/fpu/fsetexcptflg.c (fesetexceptflag): Do not
	clear whole mxcsr but only exceptions.

2003-02-21  Roland McGrath  <roland@redhat.com>

	* Makerules: Filter $(install-lib-ldscripts) out of list of targets
	for libfoo.so that need $(make-link) rules.

2003-02-21  Roland McGrath  <roland@frob.com>

	* sysdeps/mach/hurd/bits/typesizes.h (__DEV_T_TYPE): Use __U32_TYPE
	to match existing struct stat layout in mig protocols.

2003-02-20  Ulrich Drepper  <drepper@redhat.com>

	* version.h (VERSION): Bump to 2.3.2.

	* elf/Makefile (distribute): Add reldep9.c, tst-array1.exp,
	tst-array2.exp, tst-array4.exp, tst-array2dep.c, check-textrel.c,
	and dl-sysdep.h.
	* sysdeps/generic/Dist: Add sysdep-cancel.h.
	* sysdeps/powerpc/nofpu/Dist: Add soft-supp.h.
	* sysdeps/unix/Dist: Add s-proto-bp.S and s-proto-cancel.S.
	* sysdeps/unix/sysv/linux/Dist: Add pathconf.h.
	* sysdeps/unix/sysv/linux/i386/Dist: Add bp-thunk.h.
	* sysdeps/unix/sysv/linux/powerpc/powerpc64/Dist: Add fe_nomask.c and
	ucontext_i.h.
	* Makefile (distribute): Add include/stubs-prologue.h,
	include/gnu/stubs.h, scripts/merge-abilist.awk, and
	scripts/extract-abilist.awk.

2003-02-20  Roland McGrath  <roland@redhat.com>

	* math/Makefile (distribute): Don't add generated files.

2003-02-20  Ulrich Drepper  <drepper@redhat.com>

	* math/Makefile: Rearrange variable definitions slightly to get
	definition in the right order.

2003-02-20  Roland McGrath  <roland@redhat.com>

	* Makerules: Clean up conditional around include of tls.make.
	* Make-dist: Export generating=t to prevent using that.
	(+distinfo): Likewise for $(shell $(MAKE) ...) runs.

2003-02-20  Ulrich Drepper  <drepper@redhat.com>

	* inet/rcmd.c (rresvport_af): Avoid using invliad values.  Wrap
	around in search if port IPPORT_RESERVED/2 has been test.

2002-02-20  Paolo Bonzini  <bonzini@gnu.org>

	* posix/regcomp.c: Remove inclusions.
	* posix/regexec.c: Likewise.
	* posix/regex_internal.c: Likewise.
	* posix/regex_internal.h: Add inclusions here.
	* posix/regex.c: Only include sys/types.h before regex.h.  Include
	regex_internal.h here.  Include regex_internal.c before regcomp.c
	and regexec.c (might expose more opportunities to the C compiler).

	* posix/regcomp.c (parse_expression): Fix construct rejected by SGI CC.

	* posix/regex_internal.h [!_LIBC] (__mempcpy): Fix typo.
	[!_LIBC] (__wcrtomb): New definition.
	[!_LIBC]: Conditionalize enabling of I18N on HAVE_WCSCOLL and
	HAVE_LOCALE_H as well.

2003-02-20  Ulrich Drepper  <drepper@redhat.com>

	* sysdeps/unix/sysv/linux/tcsetattr.c (tcsetattr): Remove obsolete
	patch to check for system call errors.

2002-07-24  Philip Blundell  <philb@gnu.org>

	* sysdeps/unix/sysv/linux/arm/ioperm.c (init_iosys): Yield ENODEV
	on unknown systems.

2003-02-20  Franz Sirl  <Franz.Sirl-kernel@lauterbach.com>

	* sysdeps/powerpc/powerpc32/atomicity.h: Remove compiler workaround.
	* sysdeps/unix/sysv/linux/kernel-features.h
	(__ASSUME_NEW_PRCTL_SYSCALL): Defined for ppc32 too.
	* sysdeps/unix/sysv/linux/powerpc/powerpc32/fe_nomask.c: Use prctl
	if possible.
	* sysdeps/unix/sysv/linux/powerpc/powerpc32/vfork.S: Avoid short
	interprocedure branches.
	* sysdeps/powerpc/soft-fp/Dist (sim-full.c, fenv_const.c): Move to...
	* sysdeps/powerpc/nofpu/Dist: ...here.
	* sysdeps/unix/sysv/linux/powerpc/Dist (fe_nomask.c): Move to...
	* sysdeps/unix/sysv/linux/powerpc/powerpc32/Dist: ...here.
	* sysdeps/unix/sysv/linux/s390/s390-64/Dist (kernel_stat.h): Delete.
	* sysdeps/unix/sysv/linux/sparc/Dist (bits/utmpx.h): Delete.
	* sysdeps/unix/sysv/linux/x86_64/Dist (bits/utmpx.h): Delete.

2003-02-18  Alan Modra  <amodra@bigpond.net.au>

	* sysdeps/powerpc/powerpc32/sysdep.h (HIDDEN_JUMPTARGET): Redefine.

2003-02-20  Philip Blundell  <philb@gnu.org>

	* sysdeps/unix/sysv/linux/arm/sysdep.h (INLINE_SYSCALL): Add
	missing arguments to INTERNAL_SYSCALL_ERROR_P and
	INTERNAL_SYSCALL_ERRNO.

2003-02-20  Martin Schwidefsky  <schwidefsky@de.ibm.com>

	* sysdeps/unix/sysv/linux/s390/s390-32/chown.c (__real_chown): Test
	for __ASSUME_32BITUIDS.

2003-02-20  Andreas Schwab  <schwab@suse.de>

	* sysdeps/unix/sysv/linux/m68k/bits/mman.h: Add MADV_* and
	POSIX_MADV_* constants.

2003-02-20  Kaz Kojima  <kkojima@rr.iij4u.or.jp>

	* sysdeps/unix/sysv/linux/sh/pread.c: New file.
	* sysdeps/unix/sysv/linux/sh/pread64.c: New file.
	* sysdeps/unix/sysv/linux/sh/pwrite.c: New file.
	* sysdeps/unix/sysv/linux/sh/pwrite64.c: New file.

2003-02-19  Jiro Sekiba  <jir@yamato.ibm.com>

	* iconvdata/utf-16.c (gconv_end): Fix range of low surrogate.

2003-02-16  Roland McGrath  <roland@redhat.com>

	* signal/signal.h: Include <sys/ucontext.h>, not <ucontext.h>.

2003-02-19  Ulrich Drepper  <drepper@redhat.com>

	* stdlib/strtod.c (INTERNAL): Up the safety margin for cutting off
	decimal input digits.
	* stdlib/tst-strtod.c (main): Add test for strtof bug.

2003-02-18  Ulrich Drepper  <drepper@redhat.com>

	* sysdeps/unix/sysv/linux/ttyname_r.c (__ttyname_r): Recognize
	invalid file descriptors and missing access permissions.

2003-02-17  Ulrich Drepper  <drepper@redhat.com>

	* nss/getXXbyYY_r.c (REENTRANT_NAME): Return 0 if no entry has
	been found.

	* sysdeps/posix/sysconf.c (__sysconf): Test for LOGIN_NAME_MAX and
	TTY_NAME_MAX and not the _POSIX_* minimal value macros.
	* sysdeps/unix/sysv/linux/bits/local_lim.h: Define TTY_NAME_MAX
	and LOGIN_NAME_MAX.

2003-02-17  Kevin B. Hendricks  <kevin.hendricks@sympatico.ca>
	    Franz Sirl  <Franz.Sirl-kernel@lauterbach.com>

	* sysdeps/powerpc/elf/libc-start.c: Handle NONTLS_INIT_TP.
	* sysdeps/powerpc/powerpc32/__longjmp.S: Remove R2 handling.
	* sysdeps/powerpc/powerpc32/setjmp.S: Likewise.
	* sysdeps/powerpc/powerpc32/fpu/__longjmp.S: Likewise.
	* sysdeps/powerpc/powerpc32/fpu/setjmp.S: Likewise.

2003-02-17  Franz Sirl  <Franz.Sirl-kernel@lauterbach.com>

	* sysdeps/unix/sysv/linux/powerpc/ftruncate64.c: Delete.
	* sysdeps/unix/sysv/linux/powerpc/truncate64.c: Delete.
	* sysdeps/unix/sysv/linux/powerpc/pread64.c: Delete.
	* sysdeps/unix/sysv/linux/powerpc/pread.c: Delete.
	* sysdeps/unix/sysv/linux/powerpc/pwrite64.c: Delete.
	* sysdeps/unix/sysv/linux/powerpc/pwrite.c: Delete.

	* sysdeps/unix/sysv/linux/powerpc/fe_nomask.c: Move file...
	* sysdeps/unix/sysv/linux/powerpc/powerpc32/fe_nomask.c: ...here.
	* sysdeps/unix/sysv/linux/powerpc/glob64.c: Move file...
	* sysdeps/unix/sysv/linux/powerpc/powerpc32/glob64.c: ...here.

	* sysdeps/unix/sysv/linux/tcgetattr.c: Use INLINE_SYSCALL.
	* sysdeps/unix/sysv/linux/tcsetattr.c: Likewise.
	* sysdeps/unix/sysv/linux/powerpc/tcgetattr.c: Delete.
	* sysdeps/unix/sysv/linux/powerpc/tcsetattr.c: Delete.

2003-02-14  Thorsten Kukuk  <kukuk@suse.de>

	* nss/getent.c (print_hosts): Print all IP addresses of one host.

2003-02-15  Roland McGrath  <roland@frob.com>

	* sysdeps/mach/hurd/tls.h: New file.
	* sysdeps/mach/hurd/i386/tls.h: New file.

	* mach/errsystems.awk: Include <errno.h> in generated output.

	* sysdeps/mach/Makefile (mach-before-compile rule): Pass generating=t,
	use target mach-before-compile instead of generated.
	(mach-before-compile): New target.
	* Makerules: Disable use of tls.make if $(generating) is set.
	* mach/Makefile: Include mach-syscalls.mk even if no_deps=t.
	* sysdeps/mach/hurd/Makefile: Make generated hurd headers depend on
	mach-shortcuts.h so mach/ generation happens before hurd/.

2003-02-14  Ulrich Drepper  <drepper@redhat.com>

	* sysdeps/i386/fpu/s_nextafterl.c: Decrement high word of mantissa
	of demorm correctly if low word is zero.
	Reported by Fred J. Tydeman <tydeman@tybor.com>.
	* math/libm-test.inc (nextafter_test): New test, but disabled due
	to gcc bug.

	* sysdeps/generic/libc-start.c [HAVE_PTR_NTHREADS]: Decrement thread
	counter and only call __exit_thread if this is not the last thread.

2003-02-13  Jakub Jelinek  <jakub@redhat.com>

	* sysdeps/alpha/dl-machine.h (elf_machine_rela): Add instead of
	subtracting map->l_tls_offset.

2003-02-12  Ulrich Drepper  <drepper@redhat.com>

	* sysdeps/generic/bits/confname.h: Define _CS_GNU_LIBC_VERSION and
	_CS_GNU_LIBPTHREAD_VERSION.
	* posix/conststr.c: Handle these new values.
	* posix/getconf.c: Likewise.

	* sysdeps/mips/dl-machine.h (ELF_MACHINE_RUNTIME_TRAMPOLINE): Fix
	masking of version index.
	Patch by Lance Larsh <Lance.Larsh@oracle.com>.

2003-02-11  Ulrich Drepper  <drepper@redhat.com>

	* nss/nss_files/files-hosts.c (HOST_DB_LOOKUP): Compute alignment
	correctly.  Reported by Thorsten Kukuk.

2003-02-10  Ulrich Drepper  <drepper@redhat.com>

	* elf/Makefile (check-textrel-CFLAGS): Pass _XOPEN_SOURCE and
	_BSD_SOURCE to compiler.
	* elf/check-textrel.c (SWAP): Add parenthesis to avoid warnings.
	Patches by Alan Modra.

2003-02-08  Ulrich Drepper  <drepper@redhat.com>

	* io/ftwtest.c: Get current working directory before and after the
	nftw call and make sure they match.

2003-02-08  Jim Meyering  <jim@meyering.net>

	* io/ftw.c (ftw_startup): When using FTW_CHDIR, always remember
	the current directory, not just when DIR contains a slash.
	Reported by Manoj Srivastava.

2003-02-07  Jim Meyering  <jim@meyering.net>

	* io/ftw.c: Add autoconf-recommended block of alloca-related code.
	Include autoconf-recommended block of dirent/NAMELEN-related
	definitions and includes.  Use NAMELEN throughout, rather than
	_D_EXACT_NAMLEN.
	[_LIBC]: Define NAMELEN to _D_EXACT_NAMLEN.
	[!_LIBC] (__getcwd): Define to xgetcwd and declare xgetcwd.
	(stpcpy): Declare, if necessary.
	(mempcpy): Define, if necessary.
	[!_LIBC] (__stpcpy, __mempcpy): Define.
	[!_LIBC] (LXSTAT, XSTAT): Define.
	(lstat) [!LIBC && !LSTAT_FOLLOWS_SLASHED_SYMLINK]: Define to rpl_lstat.
	(find_object): Don't use c99-style struct initializer.
	Tweak wording in a couple comments.

2003-02-07  Kaz Kojima  <kkojima@rr.iij4u.or.jp>

	* elf/tls-macros.h: Add non-PIC TLS macros and fix clobber list
	for SH.
	* sysdeps/unix/sysv/linux/sh/brk.c: Add SYSCALL_INST_PAD
	after the trapa instruction.
	* sysdeps/unix/sysv/linux/sh/clone.S (__clone): Add additional
	parameters.
	* sysdeps/unix/sysv/linux/sh/sh4/sysdep.h: New file.
	(NEED_SYSCALL_INST_PAD): Define.
	* sysdeps/unix/sysv/linux/sh/sys/user.h (start_thread): Undef to
	avoid to use definition for the kernel.
	* sysdeps/unix/sysv/linux/sh/sysdep.h (SYSCALL_ERROR_HANDLER):
	Save and restore the frame pointer.
	(SYSCALL_INST_PAD): Define.
	(INLINE_SYSCALL): Make use of INTERNAL_SYSCALL.
	(INTERNAL_SYSCALL): Make use of ERR parameter. Add SYSCALL_INST_PAD
	after trapa instruction.
	(INTERNAL_SYSCALL_DECL, INTERNAL_SYSCALL_ERRNO,
	INTERNAL_SYSCALL_ERROR_P): Adjust accordingly.

2003-02-07  Jakub Jelinek  <jakub@redhat.com>

	* resolv/res_libc.c (_res): Ensure _res is not common symbol,
	so that it can have aliases.
	* inet/herrno.c (h_errno): Put it into .bss not .data section.

2003-02-07  Ulrich Drepper  <drepper@redhat.com>

	* elf/dl-runtime.c (fixup): Correct typo in version index computation.
	(profile_fixup): Likewise.
	Patch by Lance Larsh <Lance.Larsh@oracle.com>.

2002-11-24  Robert Love  <rml@tech9.net>

	* posix/sched.h: Second parameter of sched_setaffinity and
	sched_getaffinity is `unsigned int', not `unsigned long'.
	* sysdeps/generic/sched_setaffinity.c: Likewise.
	* sysdeps/generic/sched_getaffinity.c: Likewise.

2003-02-05  Ulrich Drepper  <drepper@redhat.com>

	* debug/catchsegv.sh: Fix typo in error messsage.
	Reported by John Levon <levon@movementarian.org>.

	* sysdeps/unix/sysv/linux/posix_fadvise.c: New file.
	* sysdeps/unix/sysv/linux/syscalls.list: Add posix_fadvise64 syscall.
	* sysdeps/unix/sysv/linux/alpha/syscalls.list: Likewise.
	* sysdeps/unix/sysv/linux/ia64/syscalls.list: Likewise.
	* sysdeps/unix/sysv/linux/powerpc/powerpc64/syscalls.list: Likewise.
	* sysdeps/unix/sysv/linux/s390/s390-64/syscalls.list: Likewise.
	* sysdeps/unix/sysv/linux/sparc/sparc64/syscalls.list: Likewise.

	* libio/putwc_u.c: Use _IO_putwc_unlocked, not _IO_putc_unlocked.
	Patch by Moritz Schulte <moritz@duesseldorf.ccc.de>.

2003-02-05  Jim Meyering  <jim@meyering.net>

	Fix a heap-corrupting bug.
	* io/ftw.c: Include <limits.h>.
	(PATH_MAX) [!defined PATH_MAX]: Define to 1024.
	(process_entry): Allocate enough space to hold the resulting
	file name.  Don't presume that 2*dirbufsize is enough.
	(ftw_startup): Always use PATH_MAX to compute buffer size, now that
	it is guaranteed to be defined.

2003-02-04  Ulrich Drepper  <drepper@redhat.com>

	* iconvdata/Makefile: Add rules to build and run bug-iconv3.
	* iconvdata/bug-iconv3.c: New file.

2003-02-04  Martin Schwidefsky  <schwidefsky@de.ibm.com>

	* sysdeps/unix/sysv/linux/s390/system.c: New file.

2003-02-03  Jakub Jelinek  <jakub@redhat.com>

	* sysdeps/sparc/sparc32/elf/configure.in (BROKEN_SPARC_WDISP22): New
	check.
	* config.h.in (BROKEN_SPARC_WDISP22): Add.

2003-02-03  Ulrich Drepper  <drepper@redhat.com>

	* sysdeps/i386/i686/memmove.S: New file.

2003-01-31  Steven Munroe  <sjmunroe@us.ibm.com>

	* sysdeps/unix/sysv/linux/powerpc/powerpc64/fe_nomask.c:
	Include kernel-features.h
	* sysdeps/unix/sysv/linux/powerpc/powerpc64/getcontext.S: Likewise.
	* sysdeps/unix/sysv/linux/powerpc/powerpc64/makecontext.S: Likewise.
	* sysdeps/unix/sysv/linux/powerpc/powerpc64/setcontext.S: Likewise.
	* sysdeps/unix/sysv/linux/powerpc/powerpc64/swapcontext.S: Likewise.

2003-02-02  Jakub Jelinek  <jakub@redhat.com>

	* elf/tls-macros.h [sparc] (TLS_LD, TLS_GD): Add "cc" clobbers.

2003-01-25  Jim Meyering  <jim@meyering.net>

	* io/ftw.c (object_compare): Compare inode numbers before device
	numbers, since the former are much more likely to differ.

2003-02-01  Ulrich Drepper  <drepper@redhat.com>

	* time/tzfile.c (__tzfile_compute): Change return value type to
	void.  Adjust return statements.
	* include/time.h (__tzfile_compute): Adjust prototype.

2003-02-01  Jim Meyering  <jim@meyering.net>

	* time/tzset.c (__tz_convert): Remove dead code; __tzfile_compute
	always returns 1.

2003-01-31  Steven Munroe  <sjmunroe@us.ibm.com>

	* sysdeps/unix/sysv/linux/powerpc/powerpc64/fe_nomask.c
	[!__ASSUME_NEW_PRCTL_SYSCALL]: Noop prctl syscall and set ENOSYS.

2003-01-31  Steven Munroe  <sjmunroe@us.ibm.com>

	* sysdeps/unix/sysv/linux/powerpc/powerpc64/getcontext.S
	[!__ASSUME_NEW_RT_SIGRETURN_SYSCALL]: Generate ENOSYS stub.
	* sysdeps/unix/sysv/linux/powerpc/powerpc64/makecontext.S
	[!__ASSUME_NEW_RT_SIGRETURN_SYSCALL]: Likewise.
	* sysdeps/unix/sysv/linux/powerpc/powerpc64/setcontext.S
	[!__ASSUME_NEW_RT_SIGRETURN_SYSCALL]: Likewise.
	* sysdeps/unix/sysv/linux/powerpc/powerpc64/swapcontext.S
	[!__ASSUME_NEW_RT_SIGRETURN_SYSCALL]: Likewise.

2003-01-31  Steven Munroe  <sjmunroe@us.ibm.com>

	* sysdeps/unix/sysv/linux/configure.in: Change arch_minimum_kernel
	back to 2.4.19 for powerpc64.
	* sysdeps/unix/sysv/linux/kernel-features.h
	(__ASSUME_NEW_PRCTL_SYSCALL): Define for powerpc64.
	(__ASSUME_NEW_RT_SIGRETURN_SYSCALL): Define for powerpc64.

2003-02-01  Ulrich Drepper  <drepper@redhat.com>

	* wcsmbs/wcscpy.c (wcscpy): Add alternative implementation for
	platforms with strange alignment requirements on wchar_t.

2003-01-31  Andreas Schwab  <schwab@suse.de>

	* sysdeps/unix/sysv/linux/alpha/syscalls.list: Remove __GI_*
	aliases, already added by make-syscalls.sh.
	* sysdeps/unix/sysv/linux/ia64/syscalls.list: Likewise.
	* sysdeps/unix/sysv/linux/hppa/syscalls.list: Likewise.
	* sysdeps/unix/sysv/linux/mips/syscalls.list: Likewise.
	* sysdeps/unix/sysv/linux/s390/s390-64/syscalls.list: Likewise.
	* sysdeps/unix/sysv/linux/sparc/sparc64/syscalls.list: Likewise.
	* sysdeps/unix/sysv/linux/x86_64/syscalls.list: Likewise.
	* sysdeps/unix/sysv/linux/syscalls.list: Likewise.
	* sysdeps/unix/inet/syscalls.list: Likewise.
	* sysdeps/unix/syscalls.list: Likewise.

2003-01-31  Andreas Schwab  <schwab@suse.de>

	* sysdeps/m68k/Makefile (sysdep-CFLAGS): Don't define, not needed
	any more.

2003-01-30  Jakub Jelinek  <jakub@redhat.com>

	* sysdeps/unix/sysv/linux/s390/s390-64/clone.S (__clone): Use lg,
	not l to load tls from stack.

2003-01-30  Roland McGrath  <roland@redhat.com>

	* sysdeps/generic/dl-tls.c (_dl_allocate_tls_init): Move check for
	null argument before all else.
	Reported by Martin Schwidefsky <schwidefsky@de.ibm.com>.

2003-01-30  Jakub Jelinek  <jakub@redhat.com>

	* sysdeps/powerpc/powerpc32/dl-machine.h (elf_machine_lazy_rel):
	Move to RESOLVE protected part of the header.
	* sysdeps/powerpc/powerpc64/dl-machine.h (elf_machine_lazy_rel):
	Likewise.

2003-01-30  Ulrich Drepper  <drepper@redhat.com>

	* stdio-common/Makefile (tests): Add bug15.
	(bug15-ENV): Define.
	* stdio-common/bug15.c: New file.

2002-10-07  Wolfram Gloger  <wg@malloc.de>

	* malloc/malloc.c (sYSMALLOc): Only check for breakage due
	to foreign sbrk()'s if arena is contiguous.  Bug report from
	Bruno Haible <bruno@clisp.org>.

2003-01-30  Jakub Jelinek  <jakub@redhat.com>

	* sysdeps/s390/libc-tls.c: Include stdlib.h.

2003-01-30  Jakub Jelinek  <jakub@redhat.com>

	* stdio-common/vfprintf.c (vfprintf): Only subtract lowest 3 bits of
	ps.__count.

2003-01-30  Ulrich Drepper  <drepper@redhat.com>

	* sysdeps/unix/sysv/linux/s390/s390-32/clone.S: Fix storing and
	restoring of %r6.
	* sysdeps/unix/sysv/linux/s390/s390-64/clone.S: Likewise.  Use
	64-bit load.
	Patch by Martin Schwidefsky  <schwidefsky@de.ibm.com>.

2003-01-30  Jakub Jelinek  <jakub@redhat.com>

	* elf/dl-reloc.c (CHECK_STATIC_TLS): Move _dl_signal_error...
	(allocate_static_tls): ...here.  Add __attribute_noinline__.
	Don't return on failure.
	(_dl_reloc_bad_type): Add __attribute_noinline__.
	* elf/do-rel.h (elf_dynamic_do_rel): Add
	__attribute__((always_inline)).
	* elf/dynamic-link.h (elf_machine_rel, elf_machine_rela,
	elf_machine_rel_relative, elf_machine_rela_relative,
	elf_machine_lazy_rel): Add prototypes with
	__attribute__((always_inline)).

2003-01-29  David Mosberger  <davidm@hpl.hp.com>

	* elf/dl-support.c (_dl_aux_init): Handle AT_SYSINFO.

2003-01-29  Roland McGrath  <roland@redhat.com>

	* configure.in: Barf if configured in $srcdir.

2003-01-28  Steven Munroe  <sjmunroe@us.ibm.com>

	* sysdeps/unix/sysv/linux/powerpc/powerpc64/fe_nomask.c
	(__fe_nomask_env): Change __prctl call to INTERNAL_SYSCALL.

2003-01-28  Martin Schwidefsky  <schwidefsky@de.ibm.com>

	* sysdeps/unix/sysv/linux/s390/s390-32/clone.S: Reorder additional
	clone parameters to match the order used on ia32.
	* sysdeps/unix/sysv/linux/s390/s390-64/clone.S: Likewise.

2003-01-27  Martin Schwidefsky  <schwidefsky@de.ibm.com>

	* elf/elf.h: Add new s390 relocs.
	* elf/tls-macros.h: Add s390 versions.
	* sysdeps/s390/Versions [GLIBC_2.3] (ld): Export __tls_get_offset.
	* sysdeps/s390/dl-tls.h: New file.
	* sysdeps/s390/libc-tls.c: New file.
	* sysdeps/s390/s390-32/dl-machine.h (elf_machine_type_class): Add TLS
	relocs for class PLT.
	(elf_machine_rela): Handle TLS relocs.
	* sysdeps/s390/s390-64/dl-machine.h: Likewise.
	* sysdeps/s390/s390-32/elf/configure.in: Add TLS check.
	* sysdeps/s390/s390-64/elf/configure.in: Likewise.
	* sysdeps/unix/sysv/linux/s390/s390-32/clone.S: Add support for
	CLONE_CHILD_*TID flags.
	* sysdeps/unix/sysv/linux/s390/s390-64/clone.S: Likewise.
	* sysdeps/unix/sysv/linux/s390/s390-64/mmap.S: Use branch with 32
	bit offset.
	* sysdeps/unix/sysv/linux/s390/s390-64/socket.S: Likewise.
	* sysdeps/unix/sysv/linux/s390/s390-64/syscall.S: Likewise.
	* sysdeps/unix/sysv/linux/s390/s390-32/sysdep.S (__syscall_error):
	Support USE___THREAD. Define RTLD_PRIVATE_ERRNO variant.
	* sysdeps/unix/sysv/linux/s390/s390-64/sysdep.S (__syscall_error):
	Likewise.
	* sysdeps/unix/sysv/linux/s390/s390-32/sysdep.h:
	(SYSCALL_ERROR_LABEL): Move define next to SYSCALL_ERROR_HANDLER.
	(SYSCALL_ERROR_HANDLER): Add USE___THREAD and RTLD_PRIVATE_ERRNO
	variants.
	* sysdeps/unix/sysv/linux/s390/s390-64/sysdep.h:
	(SYSCALL_ERROR_LABEL): Move define next to SYSCALL_ERROR_HANDLER. Use
	direct branch to syscall_error for !PIC and PIC && !_LIBC_REENTRANT.
	(SYSCALL_ERROR_HANDLER): Add USE___THREAD and RTLD_PRIVATE_ERRNO
	variants.

2003-01-28  Ulrich Drepper  <drepper@redhat.com>

	* sysdeps/unix/common/pause.c (do_pause): New function.  Split
	from __libc_pause.  Implement using sigsuspend.
	(__libc_pause): Call do_pause to do the real work.

	* sysdeps/posix/sigpause.c (do_sigpause): Check range of
	sig_or_mask parameter is is_sig != 0.

2003-01-21  Philip Blundell  <philb@gnu.org>

	* sysdeps/unix/sysv/linux/bits/ioctls.h (SIOCSIFNAME): Define.

2003-01-27  Steven Munroe  <sjmunroe@us.ibm.com>

	* stdio-common/Makefile: Add bug14-ENV to set LOCPATH for make check.

2003-01-27  Ulrich Drepper  <drepper@redhat.com>

	* stdio-common/bug14.c: Use official name for the locale.

	* stdio-common/vfprintf.c [USE_IN_LIBIO]: Use _IO_cleanup_region_start
	instead of __libc_cleanup_region_start and _IO_cleanup_region_end
	instead of __libc_cleanup_region_end.

	* sysdeps/unix/sysv/linux/i386/system.c (CLEANUP_HANDLER): Pass 1
	as first parameter to __libc_cleanup_region_start.

	* sysdeps/unix/sysv/linux/powerpc/powerpc64/fe_nomask.c
	(__fe_nomask_env): Use __prctl not prctl.
	* sysdeps/unix/sysv/linux/syscalls.list: Add __prctl alias for
	prctl syscall.

	* elf/dl-reloc.c (CHECK_STATIC_TLS): Improve error message.

	* elf/dl-open.c (_dl_tls_static_size): Bump to 2048.

	* elf/dl-reloc.c (allocate_static_tls): Avoid arithmetic
	wrap-around in test.

2003-01-26  Andreas Schwab  <schwab@suse.de>

	* sysdeps/wordsize-32/divdi3.c: Export the functions only as
	compatibility symbols.  Remove INTDEF for __divdi3.
	* sysdeps/wordsize-32/lldiv.c: Don't use __divdi3_internal.
	* sysdeps/powerpc/powerpc32/divdi3.c: Remove.
	* sysdeps/powerpc/powerpc32/Makefile (CPPFLAGS-divdi3.c): Don't
	define.
	* sysdeps/powerpc/powerpc32/Dist: Remove divdi3.c.

2003-01-24  Jakub Jelinek  <jakub@redhat.com>

	* elf/tls-macros.h: Add SPARC 32-bit definitions.
	* sysdeps/sparc/sparc32/elf/configure.in: Add TLS check.
	* sysdeps/sparc/sparc32/dl-machine.h: Add dl_machine_h guards
	for the first half of the header.  Include tls.h.
	(elf_machine_type_class): Return ELF_RTYPE_CLASS_PLT for TLS
	relocs too.
	(elf_machine_rela): Handle TLS relocs.
	* sysdeps/sparc/dl-tls.h: New file.

	* sysdeps/unix/sysv/linux/sparc/sparc32/socket.S: Add cancellation
	support.

	* sysdeps/sparc/sparc32/sparcv9/hp-timing.h: Use %g6 instead of %g7.
	* sysdeps/sparc/sparc32/memchr.S: Likewise.
	* sysdeps/sparc/sparc32/memcpy.S: Likewise.
	* sysdeps/sparc/sparc32/strcat.S: Likewise.
	* sysdeps/sparc/sparc32/strchr.S: Likewise.
	* sysdeps/sparc/sparc32/strcmp.S: Likewise.
	* sysdeps/sparc/sparc32/strcpy.S: Likewise.
	* sysdeps/sparc/sparc64/sparcv9b/memcpy.S: Likewise.
	* sysdeps/sparc/sparc64/hp-timing.h: Likewise.
	* sysdeps/sparc/sparc64/memcpy.S: Likewise.
	* sysdeps/sparc/sparc64/stpcpy.S: Likewise.
	* sysdeps/sparc/sparc64/stpncpy.S: Likewise.
	* sysdeps/sparc/sparc64/strcat.S: Likewise.
	* sysdeps/sparc/sparc64/strchr.S: Likewise.
	* sysdeps/sparc/sparc64/strcmp.S: Likewise.
	* sysdeps/sparc/sparc64/strcpy.S: Likewise.
	* sysdeps/sparc/sparc64/strncmp.S: Likewise.
	* sysdeps/sparc/sparc64/strncpy.S: Likewise.
	* sysdeps/unix/sysv/linux/sparc/sparc32/sysdep.h: Likewise.
	* sysdeps/unix/sysv/linux/sparc/sparc64/sysdep.h: Likewise.

2003-01-24  Andreas Schwab  <schwab@suse.de>

	* elf/dl-close.c (_dl_close): Don't relocate DT_FINI_ARRAY
	elements, and process them backwards.
	* elf/Makefile ($(objpfx)tst-array4): New target.
	($(objpfx)tst-array4.out): Likewise.
	(tests) [$(have-initfini-array) = yes]: Add tst-array4.
	* elf/tst-array4.c: New file.
	* elf/tst-array4.exp: Likewise.

2003-01-24  Steven Munroe  <sjmunroe@us.ibm.com>

	* sysdeps/unix/sysv/linux/powerpc/powerpc64/fe_nomask.c: New file.

2003-01-27  Guido Guenther  <agx@sigxcpu.org>

	* sysdeps/unix/sysv/linux/mips/sysdep.h (SYSCALL_ERROR_LABEL): Define.
	* sysdeps/unix/sysv/linux/mips/pread.c: Add support for
	cancellation handling and handle both __NR_pread64 and __NR_pread.
	* sysdeps/unix/sysv/linux/mips/pread64.c: Likewise.
	* sysdeps/unix/sysv/linux/mips/pwrite.c: Add support for
	cancellation handling and handle both __NR_pwrite64 and __NR_pwrite.
	* sysdeps/unix/sysv/linux/mips/pwrite64.c: Likewise.
	* sysdeps/unix/mips/sysdep.S: Don't set errno in the _LIBC_REENTRANT
	case, use register names consistently.

2003-01-27  Wolfram Gloger  <wg@malloc.de>

	* malloc/hooks.c (mem2chunk_check): Check alignment of mem
	pointer, not of the computed chunk.  Bug report from Carlos
	O'Donell <carlos@baldric.uwo.ca>.

2003-01-25  Andreas Schwab  <schwab@suse.de>

	* sysdeps/m68k/dl-machine.h (_dl_start_user): Use pc-relative
	addressing to save GOT entries.

2003-01-21  Jakub Jelinek  <jakub@redhat.com>

	* sysdeps/unix/alpha/sysdep.h (inline_syscall0,
	inline_syscall1, inline_syscall2, inline_syscall3,
	inline_syscall4, inline_syscall5, inline_syscall6): Add __volatile__.
	* sysdeps/unix/sysv/linux/alpha/sysdep.h (INTERNAL_SYSCALL): Add
	__attribute__((unused)) to ChEcK.

2003-01-20  Martin Schwidefsky  <schwidefsky@de.ibm.com>

	* sysdeps/unix/sysv/linux/s390/s390-32/sysdep.h (INTERNAL_SYSCALL):
	Fix inline assembler constraints.
	* sysdeps/unix/sysv/linux/s390/s390-64/sysdep.h (INTERNAL_SYSCALL):
	Likewise.

	* sysdeps/s390/s390-64/Makefile (pic-ccflag): Use -fpic instead of
	-fPIC.

2003-01-20  Segher Boessenkool  <segher@koffie.nl>

	* sysdeps/ieee754/dbl-64/sincos32.c (__mpcos): Really
	compute the cosine, not the sine, even if x > 0.8.

2003-01-19  Ulrich Drepper  <drepper@redhat.com>

	* nis/nss_nis/nis-spwd.c: Make _nss_nis_endspent an alias of
	_nss_nis_setspent.  Work around the different prototypes.
	* nis/nss_nis/nis-rpc.c (internal_nis_setrpcent): Use
	internal_nis_endrpcent.
	(internal_nis_endrpcent): Change return type to void.  Change callers.
	* nis/nss_nis/nis-pwd.c: Make _nss_nis_endpwent an alias of
	_nss_nis_setpwent.  Work around the different prototypes.
	* nis/nss_nis/nis-proto.c (_nss_nis_endprotoent): Split out body
	of the function to...
	(internal_nis_endprotoent): ... here.  New function.
	(internal_nis_setprotoent): Use internal_nis_endprotoent.
	* nis/nss_nis/nis-network.c: Make _nss_nis_endnetent an alias of
	_nss_nis_setnetent.  Work around the different prototypes.
	* nis/nss_nis/nis-netgrp.c (_nss_nis_endnetgrent): Split out body
	of the function to...
	(internal_nis_endnetgrent): ... here.  New function.
	(_nss_nis_setnetgrent): Use internal_nis_endnetgrent.

2003-01-19  Jim Meyering  <jim@meyering.net>

	* time/strftime.c: (widen): Merge nearly-identical definitions.
	(nl_get_alt_digit) [! defined my_strftime]: Define.
	(my_strftime) [_NL_CURRENT]: Merge nearly-identical uses of
	_nl_get_alt_digit and _nl_get_walt_digit.

2003-01-19  Ulrich Drepper  <drepper@redhat.com>

	* time/strftime.c (my_strftime): Handle very large width
	specifications for numeric values correctly.  Improve checks for
	overflow.
	* time/Makefile (tests): Add tst-strftime.
	* time/tst-strftime.c: New file.

2003-01-18  Ulrich Drepper  <drepper@redhat.com>

	* nis/nss_nis/nis-hosts.c: Make _nss_nis_endhostent an alias of
	_nss_nis_sethostent.  Work around the different prototypes.
	* nis/nss_nis/nis-grp.c: Make _nss_nis_endgrent an alias of
	_nss_nis_setgrent.  Work around the different prototypes.
	* nis/nss_nis/nis-ethers.c (internal_nis_endetherent): New
	function.  Split out from _nss_nis_endetherent.
	(internal_nis_setetherent): Use internal_nis_endetherent instead of
	duplicating the code.
	* nis/nss_nis/nis-alias.c: Make _nss_nss_nis_endaliasent an alias
	of _nss_nis_setaliasent.
	* nis/nss_nis/nis-service.c (internal_nis_setservent): Reuse
	internal_nis_endservent code, don't duplicate it.

	* inet/rexec.c (rexec_af): Protect socket operations with
	TEMP_FAILURE_RETRY.  Use writev instead of multiple write.
	* inet/rcmd.c (rcmd_af): Likewise.

2003-01-17  Roland McGrath  <roland@redhat.com>

	* math/libm-test.inc (sin_test, cos_test, sincos_test) [TEST_DOUBLE]:
	Add test of value 0.80190127184058835.

	* elf/dl-open.c: Fix typo ifdef -> ifndef on _dl_tls_static_size defn.

2003-01-17  Richard Henderson  <rth@redhat.com>

	* sysdeps/alpha/dl-machine.h (elf_machine_type_class): Add TLS
	relocs for class PLT.
	* sysdeps/alpha/libc-tls.c: New file.
	* sysdeps/unix/alpha/sysdep.S (EPILOGUE, GPSAVEREG): New.
	(LOADGP) [!PIC]: Rewrite to preserve caller's gp.

2003-01-17  Jakub Jelinek  <jakub@redhat.com>

	* sysdeps/unix/sysv/linux/ia64/dl-static.c (_dl_static_init): Use
	__libc_lock_{,un}lock_recursive instead of __libc_lock_{,un}lock
	on _dl_static_lock.

2003-01-17  Andreas Jaeger  <aj@suse.de>

	* stdio-common/bug14.c: Include stdlib.h for exit prototype.

2003-01-16  Steven Munroe  <sjmunroe@us.ibm.com>

	* sysdeps/unix/sysv/linux/powerpc/powerpc64/getcontext.S: New file.
	* sysdeps/unix/sysv/linux/powerpc/powerpc64/makecontext.S: New file.
	* sysdeps/unix/sysv/linux/powerpc/powerpc64/setcontext.S: New file.
	* sysdeps/unix/sysv/linux/powerpc/powerpc64/swapcontext.S: New file.
	* sysdeps/unix/sysv/linux/powerpc/powerpc64/ucontext_i.h: New file.
	* sysdeps/unix/sysv/linux/powerpc/sys/ucontext.h: New file.
	* sysdeps/unix/sysv/linux/configure.in: Minimum kernel for PPC64
	is 2.4.21.

2003-01-16  Ulrich Drepper  <drepper@redhat.com>

	* sysdeps/generic/glob.c (glob): Assume sysconf() always returns
	values != -1 for _LIBC.  Use extend_alloca to reallocate alloca'ed
	buffers.

	* sysdeps/generic/sysconf.c: Unconditionally implement
	_SC_GETPW_R_SIZE_MAX and _SC_GETGR_R_SIZE_MAX.
	* sysdeps/posix/sysconf.c: Likewise.

2003-01-16  Jakub Jelinek  <jakub@redhat.com>

	* posix/regcomp.c (parse_bracket_exp): If build_charclass fails,
	set *err to the returned error, not to REG_ESPACE unconditionally.
	(build_word_op): Likewise.
	* posix/Makefile (tests): Add bug-regex16.
	* posix/bug-regex16.c: New test.

2003-01-16  Jakub Jelinek  <jakub@redhat.com>

	* elf/dl-load.c (_dl_map_object_from_fd): Use
	GL(dl_tls_dtv_slotinfo_list) != NULL to check whether TLS has
	been already initialized.

2003-01-15  Dmitry V. Levin  <ldv@altlinux.org>

	* sysdeps/unix/sysv/linux/ptsname.c: Fix typo in comment.

2003-01-16  Jakub Jelinek  <jakub@redhat.com>

	* posix/regcomp.c (re_compile_internal): If clearing buffer, clear
	allocated too.  Reported by Al Viro <aviro@redhat.com>.

2003-01-16  Roland McGrath  <roland@redhat.com>

	Tweak merged .abilist file format to merge duplicate symbols in
	different sets into multi-version stanzas with new "| SET regexp..."
	header continuation lines.
	* scripts/merge-abilist.awk: Rewritten for new format.
	* scripts/extract-abilist.awk: Likewise.

2003-01-15  Ulrich Drepper  <drepper@redhat.com>

	* nscd/connections.c (nscd_run): Remove bogus return which isn't
	necessary with gcc 3.2+.
	(nscd_init): Don't use error() to print message, use dbg_log.

	* iconv/gconv_simple.c (STORE_REST): Explicitly store the total
	expected size into state.
	(UNPACK_BYTES): Do the reverse.
	* iconv/loop.c: Use CLEAR_STATE if defined to clear __state element.
	* wcsmbs/tst-mbrtowc.c (utf8_test_1): Add test for the bug.
	Reported by Al Viro <aviro@redhat.com>.

	* stdio-common/Makefile (tests): Add bug14.
	* stdio-common/bug14.c: New file.

	* stdio-common/vfscanf.c: When recognizing multibyte characters in
	string reset the byte counter after mbrtowc reported it is not a
	partial character.  Reported by Al Viro <aviro@redhat.com>.

2003-01-15  Steven Munroe  <sjmunroe@us.ibm.com>

	* sysdeps/unix/sysv/linux/powerpc/powerpc64/socket.S: Include
	sysdep-cancel.h, not sysdep.h.

2003-01-15  Ulrich Drepper  <drepper@redhat.com>

	* nscd/connections.c (nscd_run): Protect accept call with
	TEMP_FAILURE_RETRY.

2003-01-15  Andreas Schwab  <schwab@suse.de>

	* sysdeps/unix/Makefile: Include $(common-objpfx)s-proto-bp.d.
	(common-generated): Add s-proto-bp.d.
	* sysdeps/unix/make-syscalls.sh: Use s-proto-bp.d for dependencies
	of bp thunks.
	* sysdeps/unix/s-proto-bp.S: New file.
	* sysdeps/generic/bp-thunks.h: Don't include <sys/vm86.h> here.
	Use <io/sys/sendfile.h> instead of <sys/sendfile.h>.
	* sysdeps/unix/sysv/linux/i386/bp-thunks.h: New file.

2003-01-15  Roland McGrath  <roland@redhat.com>

	* Makerules: Use -include for tls.make, suppresses warning.
	Move gen-as-const-headers rules up so before-compile is set in time.
	(sed-remove-dotdot): Fix to work right for subdirs or top dir.

2003-01-15  Ulrich Drepper  <drepper@redhat.com>

	* nscd/nscd.c (main): Make code to close all file descriptors
	faster and more robust.

	* nscd/nscd_getpw_r.c (nscd_getpw_r): Consolidate writing of the
	request with one writev call.  Protect all read calls with
	TEMP_FAILURE_RETRY.
	* nscd/nscd_getgr_r.c (nscd_getgr_r): Likewise.
	* nscd/nscd_gethst_r.c (nscd_gethst_r): Likewise.

	* nscd/hstcache.c: Use extend_alloca to reallocate alloca'd buffer.
	Protect writev calls with TEMP_FAILURE_RETRY.
	* nscd/grpcache.c: Likewise.
	* nscd/pwdcache.c: Likewise.

	* nscd/hstcache.c (addhstbynamev6): Don't interpret hostname as
	IPv6 address in debug output.

2003-01-14  Roland McGrath  <roland@redhat.com>

	* Makerules (check-abi-%): Use two rules for $(common-objpfx) and
	$(objpfx) directories, and get rid of vpath directives.  The previous
	arrangement resulted in files being written to the source directories
	when run in a clean build.  Find all .abilist files in $(..)abilist/.
	(update-abi-%): Likewise.
	(generated): Don't add .symlist files, they'll be intermediates.

	* sysdeps/generic/init-first.c: Add a comment.

	* elf/Makefile ($(objpfx)ld.so): Pass -z defs in link.

	* scripts/gen-as-const.awk: Grok lone "--" as a separator between
	#includes and expressions.

	* scripts/merge-abilist.awk: Omit cpu-.*-os.*/modifier from merged
	config list when it already contains cpu-.*-os.* without / part.

	* Makerules (sed-remove-dotdot): New variable.
	($(common-objpfx)%.make): Use it.  Depend on $(before-compile).
	($(common-objpfx)%.h $(common-objpfx)%.h.d): Likewise.
	(check-abi-config): New variable, append /tls or /notls to the tuple.
	(check-abi-%): Use that for -v config value.
	Find .abilist files in abilist/libfoo.abilist, not in subdir.
	* Rules: Move bits/stdio_lim.h generation rules to Makerules.

2003-01-14  Ulrich Drepper  <drepper@redhat.com>

	* manual/install.texi: Correct description of header preparation for
	Linux build.  Patch by mhwood@Ameritech.Net [PR libc/4941].

2003-01-14  Guido Guenther  <agx@sigxcpu.org>

	* sysdeps/unix/sysv/linux/mips/sysdep.h (INTERNAL_SYSCALL,
	INTERNAL_SYSCALL_DECL, INTERNAL_SYSCALL_ERRNO,
	INTERNAL_SYSCALL_ERROR_P, INLINE_SYSCALL): Define.

2003-01-14  Steven Munroe  <sjmunroe@us.ibm.com>

	* sysdeps/unix/sysv/linux/powerpc/powerpc64/sysdep.h
	(INTERNAL_SYSCALL): Make use of ERR parameter.
	(INTERNAL_SYSCALL_DECL, INTERNAL_SYSCALL_ERRNO,
	INTERNAL_SYSCALL_ERROR_P): Adjust accordingly.
	(INLINE_SYSCALL): Make use of INTERNAL_SYSCALL.
	* sysdeps/unix/sysv/linux/powerpc/powerpc64/vfork.S: New file.

2003-01-14  Ulrich Drepper  <drepper@redhat.com>

	* sunrpc/pm_getport.c (pmap_getport): Open TCP socket if protocol
	== IPPROTO_TCP.
	Patch by James Strandboge <jamie@tpptraining.com> [PR libc/4943].

	* sysdeps/unix/sysv/linux/i386/dl-procinfo.c (_dl_x86_cap_flags):
	Fix entry for bit 31.

	* iconvdata/Makefile: Add rules to build IBM866NAV.
	* iconvdata/ibm866nav.c: New file.
	* iconvdata/tst-tables.sh: Add IBM866NAV.
	* iconvdata/gconv-modules: Add entries for IBM866NAV.

2003-01-13  Ulrich Drepper  <drepper@redhat.com>

	* string/tester.c (test_strcpy): Use the previously #if 0'ed code
	to test void* parameters.

	* sysdeps/i386/i486/bits/string.h (__STRING_SMALLL_GET16): Cast
	source pointer before dereferencing.
	(__STRING_SMALLL_GET32): Likewise.
	(__memset_gc): Add missing parenthesis around macro arguments.
	Patch by Denis Zaitsev <zzz@cd-club.ru>.

	* sysdeps/i386/i486/bits/string.h (__strspn_cg): Tell the compiler
	that %eax is modified.  Reported by Denis Zaitsev <zzz@cd-club.ru>.

2003-01-14  Jakub Jelinek  <jakub@redhat.com>

	* sysdeps/unix/alpha/sysdep.h (INLINE_SYSCALL): Undefined before
	defining.

2003-01-13  Martin Schwidefsky  <schwidefsky@de.ibm.com>

	* sysdeps/s390/s390-64/initfini.c: Avoid unterminated string literals.
	* sysdeps/unix/sysv/linux/s390/s390-32/sysdep.h (L): Don't define it
	here.
	* sysdeps/unix/sysv/linux/s390/s390-64/sysdep.h (L): Likewise.

2003-01-13  Martin Schwidefsky  <schwidefsky@de.ibm.com>

	* sysdeps/s390/s390-32/sysdep.h (JUMPTARGET): Move branch instructions
	from here...
	(PSEUDO): ... to here.
	* sysdeps/s390/s390-64/sysdep.h (JUMPTARGET): Move branch instruction
	from here...
	(PSEUDO): ... to here.

2003-01-13  Ulrich Drepper  <drepper@redhat.com>

	* locale/programs/charmap-dir.c (charmap_readdir): Use struct
	dirent64 instead of struct dirent for dirent.  Call readdir64
	instead of readdir.

	* locale/programs/locfile.c (siblings_uncached): Use struct
	dirent64 instead of struct dirent for other_dentry.  Call
	readdir64 instead of readdir.

	* elf/ldconfig.c (direntry): Change type to struct dirent64.
	(search_dir): Use readdir64 instead of readdir.
	Patch by Zhangfan Xing <xing@pacific.jpl.nasa.gov>.

2003-01-12  Roland McGrath  <roland@redhat.com>

	* hurd/lookup-retry.c (__hurd_file_name_lookup_retry): Use strtoul,
	not strtol.  The former is usable in ld.so, the latter not.

	* include/fcntl.h: Declare __libc_creat.

	* sysdeps/mach/hurd/Makefile (libmachuser-link.so-no-z-defs,
	libhurduser-link.so-no-z-defs): New variables.

	* malloc/malloc.c: Revert last change.
	* malloc/malloc.h (_int_*): Move these decls to ...
	* include/malloc.h: ... here.  Add attribute_hidden.
	(_int_valloc): Declare it too.

2003-01-12  Ulrich Drepper  <drepper@redhat.com>

	* elf/dl-close.c (_dl_close): Fix typo, must be == not = in
	search for removed searchlist.  Reported by Roland McGrath.

	* io/ftwtest-sh: Add test for case of symlink to nonexisting file
	given as start file.

	* io/ftw.c (ftw_startup): Use correct name in check for symlink
	without existing target.  Patch by Jim Meyering.

	* Makerules (build-shlib-helper): Don't use -z defs linker option
	if no-z-defs is defined either.

2003-01-10  Martin Schwidefsky  <schwidefsky@de.ibm.com>

	* sysdeps/unix/sysv/linux/s390/s390-64/kernel_stat.h: Remove unused
	file.

2003-01-10  Martin Schwidefsky  <schwidefsky@de.ibm.com>

	* sysdeps/unix/sysv/linux/s390/s390-32/syscalls.list: Add vfork.
	* sysdeps/unix/sysv/linux/s390/s390-64/syscalls.list: Likewise.

2003-01-12  Ulrich Drepper  <drepper@redhat.com>

	* io/ftwtest-sh: Add test case for relative path with /. at the end.

2003-01-12  Jim Meyering  <jim@meyering.net>

	* io/ftw.c (ftw_startup): When trying to stat the starting directory,
	use the basename if we've already chdir'd into its parent directory.

2003-01-12  Ulrich Drepper  <drepper@redhat.com>

	* io/ftw.c (process_entry): Use relative path when using chdir()
	to change directory after call to ftw_dir.
	* io/ftwtest-sh: Add test for relative path argument to nftw()
	with FTW_CHDIR option.

2002-01-12  Franz Sirl  <Franz.Sirl-kernel@lauterbach.com>

	* sysdeps/unix/sysv/linux/kernel-features.h (__ASSUME_VFORK_SYSCALL):
	Define for powerpc.
	* sysdeps/unix/sysv/linux/powerpc/syscall.S: Take register alignment
	into account.
	* sysdeps/unix/sysv/linux/powerpc/powerpc32/sysdep.h
	(INTERNAL_SYSCALL): Make use of ERR parameter.
	(INTERNAL_SYSCALL_DECL, INTERNAL_SYSCALL_ERRNO,
	INTERNAL_SYSCALL_ERROR_P): Adjust accordingly.
	(INLINE_SYSCALL): Make use of INTERNAL_SYSCALL.
	* sysdeps/unix/sysv/linux/powerpc/powerpc32/vfork.S: New file.

2002-01-09  Richard Henderson  <rth@redhat.com>

	* sysdeps/alpha/dl-machine.h (elf_machine_rela): Compute
	DTPREL64 and TPREL64 without loadbase applied.

2002-01-09  Richard Henderson  <rth@redhat.com>

	* sysdeps/unix/alpha/sysdep.S: Use correct definition of errno
	for NOT_IN_libc.

	* sysdeps/unix/sysv/linux/alpha/sysdep.h: Move inline syscall bits...
	* sysdeps/unix/alpha/sysdep.h: ... here.
	(PSEUDO_LOADGP): Remove.
	(PSEUDO_PROLOGUE): Load GP in non-pic case.
	(SYSCALL_ERROR_LABEL): New.
	(PSEUDO): Use it in error branch.
	(PSEUDO_END): Add $syscall_error label.

2003-01-12  Andreas Jaeger  <aj@suse.de>

	* math/bits/mathcalls.h: Round is a const function.

2003-01-11  Jim Meyering  <jim@meyering.net>

	* io/ftw.c [HAVE_CONFIG_H]: Include <config.h>.
	[HAVE_SYS_PARAM_H || _LIBC]: Guard inclusion of <sys/param.h>.
	Include <sys/stat.h>, not <include/sys/stat.h>, if !_LIBC.
	[!_LIBC] (__chdir, __closedir, __fchdir, __getcwd, __opendir): Define.
	[!_LIBC] (__readdir64, __tdestroy, __tfind, __tsearch): Define.
	[!_LIBC] (internal_function, dirent64, MAX): Define.
	(__set_errno): Define if not already defined.
	(open_dir_stream): When FTW_CHDIR is enabled, invoke opendir on
	the basename, not the entire file name.
	(process_entry): When FTW_CHDIR is enabled, invoke XSTAT or LXSTAT on
	the basename, not the entire file name.

2003-01-12  Ulrich Drepper  <drepper@redhat.com>

	* string/tester.c (test_strcpy): Disable last added strcpy until
	it is fixed.

2003-01-11  Philip Blundell  <philb@gnu.org>

	* sysdeps/unix/sysv/linux/arm/socket.S: Add cancellation support.

2003-01-11  Andreas Schwab  <schwab@suse.de>

	* Makerules: Add vpath for %.dynsym and %.so so that the
	implicit rule chaining for check-abi works.

2003-01-11  Kaz Kojima  <kkojima@rr.iij4u.or.jp>

	* sysdeps/unix/sysv/linux/sh/sysdep.h (SYSCALL_ERROR_HANDLER):
	Add non-PIC case.

2003-01-11  Jakub Jelinek  <jakub@redhat.com>

	* elf/tls-macros.h [__ia64__] (__TLS_CALL_CLOBBERS): Define.
	[__ia64__] (TLS_LE, TLS_IE): Fix typos.  Add ;; at start of asm if
	gp is used early.
	[__ia64__] (TLS_LD, TLS_GD): Likewise.  Use __TLS_CALL_CLOBBERS.
	* elf/Makefile ($(objpfx)tst-tlsmod5.so, $(objpfx)tst-tlsmod6.so):
	Ensure libc.so in DT_NEEDED.
	* sysdeps/alpha/dl-machine.h (elf_machine_rela): Move
	CHECK_STATIC_TLS before l_tls_offset use.
	* sysdeps/i386/dl-machine.h (elf_machine_rel, elf_machine_rela):
	Likewise.
	* sysdeps/sh/dl-machine.h (elf_machine_rela): Likewise.
	* sysdeps/generic/dl-tls.c (_dl_allocate_tls_storage) [TLS_DTV_AT_TP]:
	Allocate TLS_PRE_TCB_SIZE bytes below result.
	(_dl_deallocate_tls) [TLS_DTV_AT_TP]: Adjust before freeing.
	* sysdeps/generic/libc-tls.c (__libc_setup_tls): If
	TLS_INIT_TP_EXPENSIVE is not defined, allocate even if no PT_TLS
	segment has been found.  If TLS_DTV_AT_TP, allocate TLS_PRE_TCB_SIZE
	bytes below result and add tcb_offset to memsz.
	* sysdeps/ia64/dl-tls.h (__tls_get_addr): New prototype.
	* sysdeps/ia64/dl-machine.h: Include tls.h.
	(elf_machine_type_class): Return ELF_RTYPE_CLASS_PLT for TLS relocs
	too.
	(elf_machine_rela): Assume if sym_map != NULL sym is non-NULL too.
	Handle R_IA64_DTPMOD*, R_IA64_DTPREL* and R_IA64_TPREL* relocations.
	* sysdeps/ia64/libc-tls.c: New file.

2003-01-10  Steven Munroe  <sjmunroe@us.ibm.com>

	* sysdeps/powerpc/powerpc64/sysdep.h (PSEUDO_RET): Add branch hit.
	* sysdeps/unix/sysv/linux/powerpc/bits/stat.h (STAT_VER_LINUX):
	Fix type.  Move definition out of #if.
	* sysdeps/unix/sysv/linux/powerpc/powerpc64/ftruncate64.c: New file.
	* sysdeps/unix/sysv/linux/powerpc/powerpc64/pread.c: New file.
	* sysdeps/unix/sysv/linux/powerpc/powerpc64/pread64.c: New file.
	* sysdeps/unix/sysv/linux/powerpc/powerpc64/pwrite.c: New file.
	* sysdeps/unix/sysv/linux/powerpc/powerpc64/pwrite64.c: New file.
	* sysdeps/unix/sysv/linux/powerpc/powerpc64/socket.S: Add cancellation
	support.
	* sysdeps/unix/sysv/linux/powerpc/powerpc64/syscalls.list: Remove
	ftruncate64, pread64, pwrite64, truncate64 entries.
	* sysdeps/unix/sysv/linux/powerpc/powerpc64/sysdep.h
	(INLINE_SYSCALL): New version that supports function call like
	syscalls.  Add __builtin_expect.
	(LOADARGS_n): Add argument size safety checks.
	(INTERNAL_SYSCALL): New Macro.
	* sysdeps/unix/sysv/linux/powerpc/powerpc64/truncate64.c: New file.
	* sysdeps/unix/sysv/linux/powerpc/sys/procfs.h [__PPC_ELF_H]: Avoid
	redefinition of elf_fpreg_t and elf_fpregset_t.

2003-01-12  Ulrich Drepper  <drepper@redhat.com>

	* elf/dl-close.c (_dl_close): Add several asserts.  Correct and
	simplify test for unloading.  If loader of a DSO is unloaded do not
	use its scope anymore.  Fall back to own scope and adjust opencounts.
	Fix several comments.
	* elf/dl-deps.c (_dl_map_object_deps): Always allocate memory for
	the l_searchlist, not only for l_initfini.

	* elf/dl-lookup.c (add_dependencies): Avoid creating relocation
	dependencies if objects cannot be removed.  Remove object with the
	definition as not unloadable if necessary.

	* elf/reldep6.c: Create relocation dependency before closing the first
	module.

2003-01-10  Guido Gnther  <agx@sigxcpu.org>

	* sysdeps/unix/mips/fork.S: Add PSEUDO_END.
	* sysdeps/unix/mips/brk.S: Likewise.
	* sysdeps/unix/mips/pipe.S: Likewise.

2003-01-10  Andreas Schwab  <schwab@suse.de>

	* sysdeps/unix/sysv/linux/m68k/getsysstats.c: New file.

	* sysdeps/unix/sysv/linux/m68k/vfork.S: Optimize for kernels which
	are known to have the vfork syscall.

	* sysdeps/m68k/sysdep.h (JUMPTARGET): Undefine before defining it.

	* sysdeps/unix/sysv/linux/kernel-features.h
	(__ASSUME_MMAP2_SYSCALL, __ASSUME_TRUNCATE64_SYSCALL)
	(__ASSUME_STAT64_SYSCALL, __ASSUME_FCNTL64)
	(__ASSUME_VFORK_SYSCALL): Define for m68k kernels >= 2.4.12.

2003-01-09  Jakub Jelinek  <jakub@redhat.com>

	* elf/Makefile: Add rules to build and run reldep9 test.
	* elf/reldep9.c: New file.
	* elf/reldep9mod1.c: New file.
	* elf/reldep9mod2.c: New file.
	* elf/reldep9mod3.c: New file.

2003-01-09  Jakub Jelinek  <jakub@redhat.com>

	* elf/Makefile: Add rules to build and run nodelete2 test.
	* elf/nodelete2.c: New file.
	* elf/nodel2mod1.c: New file.
	* elf/nodel2mod2.c: New file.
	* elf/nodel2mod3.c: New file.

2003-01-09  Jakub Jelinek  <jakub@redhat.com>

	* posix/test-vfork.c (noop): Add __attribute_noinline__.
	* sysdeps/generic/sysdep.h (JUMPTARGET): Define if not defined.
	* sysdeps/i386/sysdep.h (JUMPTARGET): Undefine JUMPTARGET before
	defining it.
	* sysdeps/powerpc/powerpc32/sysdep.h (JUMPTARGET): Likewise.
	* sysdeps/powerpc/powerpc64/sysdep.h (JUMPTARGET): Likewise.
	* sysdeps/s390/s390-32/sysdep.h (JUMPTARGET): Likewise.
	* sysdeps/s390/s390-64/sysdep.h (JUMPTARGET): Likewise.
	* sysdeps/x86_64/sysdep.h (JUMPTARGET): Likewise.

2003-01-09  Andreas Schwab  <schwab@suse.de>

	* sysdeps/m68k/fpu/libm-test-ulps: Regenerated.

2003-01-08  Ulrich Drepper  <drepper@redhat.com>

	* sysdeps/unix/sysv/linux/arm/sysdep.h (INTERNAL_SYSCALL,
	INTERNAL_SYSCALL_ERROR_P, INTERNAL_SYSCALL_ERRNO): Add err
	argument.
	(INTERNAL_SYSCALL_DECL): Define.

2003-01-06  Jakub Jelinek  <jakub@redhat.com>

	* sysdeps/unix/sysv/linux/ia64/sysdep.h (INTERNAL_SYSCALL,
	INTERNAL_SYSCALL_ERROR_P, INTERNAL_SYSCALL_ERRNO): Add err
	argument.
	(INTERNAL_SYSCALL_DECL): Define.
	* sysdeps/unix/sysv/linux/powerpc/powerpc32/sysdep.h: Likewise.
	* sysdeps/unix/sysv/linux/sparc/sysdep.h: Likewise.
	* sysdeps/unix/sysv/linux/i386/sysdep.h: Likewise.
	(INLINE_SYSCALL): Adjust.
	* sysdeps/unix/sysv/linux/s390/s390-32/sysdep.h: Likewise.
	* sysdeps/unix/sysv/linux/s390/s390-64/sysdep.h: Likewise.
	* sysdeps/unix/sysv/linux/m68k/sysdep.h: Likewise.
	* sysdeps/unix/sysv/linux/x86_64/sysdep.h: Likewise.
	* elf/dl-misc.c (_dl_debug_vdprintf): Add INTERNAL_SYSCALL_DECL,
	add err argument to INTERNAL_SYSCALL* macros.
	* sysdeps/unix/sysv/linux/i386/brk.c (__brk): Likewise.
	* sysdeps/unix/sysv/linux/i386/system.c (cancel_handler): Likewise.
	* sysdeps/unix/sysv/linux/m68k/brk.c (__brk): Likewise.
	* sysdeps/unix/sysv/linux/m68k/getpagesize.c  (__getpagesize):
	Likewise.
	* sysdeps/unix/sysv/linux/sigwait.c (do_sigwait): Likewise.
	* sysdeps/unix/sysv/linux/i386/sigaction.c (__libc_sigaction): Use
	INLINE_SYSCALL instead of INTERNAL_SYSCALL and setting errno.

2003-01-07  Ulrich Drepper  <drepper@redhat.com>

	Unify symbols in user namespace exported by libc.so and libc.a.
	* argp/argp-fmtstream.c: Don't define argp_make_fmtstream,
	argp_fmtstream_free, and argp_fmtstream_printf.
	* argp/argp-fs-xinl.c: Don't define argp_fmtstream_putc,
	argp_fmtstream_puts, argp_fmtstream_write, argp_fmtstream_set_lmargin,
	argp_fmtstream_set_rmargin, argp_fmtstream_set_wmargin, and
	argp_fmtstream_point.
	* gmon/gmon.c: Don't define write_profiling.
	* libio/genops.c: Don't define _cleanup.

	* intl/explodename.c (_nl_find_language.c): Mark as static.
	* intl/loadinfo.h: Remove _nl_find_language prototype.

	* libio/fileops.c (_IO_file_seekoff_maybe_mmap): Mark as static.
	* libio/libioP.h: Remove declaration.

	* libio/iopopen.c (_IO_proc_jumps): Mark as static.
	* libio/libioP.h: Remove declaration.

	* sysdeps/generic/unwind-dw2.c: Mark __frame_state_for with STATIC.
	* sysdeps/generic/framestate.c: Define STATIC before including
	unwind-dw2.c.

	* time/Versions [GLIBC_2.3.2] (libc): Export strptime_l.

2003-01-06  Philip Blundell  <philb@gnu.org>

	* sysdeps/unix/arm/sysdep.S (syscall_error): Optimise a little.
	[__LIBC_REENTRANT]: Unify PIC and non-PIC cases.

	* sysdeps/unix/sysv/linux/arm/sysdep.h (PSEUDO): Remove .type
	directive.
	(PSEUDO_RET): Use SYSCALL_ERROR in place of __syscall_error.
	(SYSCALL_ERROR): New.
	(SYSCALL_ERROR_HANDLER) [NOT_IN_libc]: Provide local copy of error
	handling code.
	(INTERNAL_SYSCALL): Define.
	(INLINE_SYSCALL): Use it.
	(INTERNAL_SYSCALL_ERROR_P, INTERNAL_SYSCALL_ERRNO): Define.
	* sysdeps/unix/sysv/linux/arm/socket.S (__socket): Use
	SYSCALL_ERROR in place of __syscall_error.

2003-01-07  Jakub Jelinek  <jakub@redhat.com>

	* sysdeps/ia64/bits/byteswap.h [__GNUC__ >= 2] (__bswap_16,
	__bswap_32, __bswap_64): Put x into temporary variable
	to avoid warnings.
	[!__GNUC__] (__bswap_16, __bswap_32, __bswap_64): Change into static
	(inline) functions.
	* sysdeps/s390/bits/byteswap.h [__GNUC__ >= 2] (__bswap_16,
	__bswap_32, __bswap_64): Put x into temporary variable
	to avoid warnings.
	[!__GNUC__] (__bswap_16, __bswap_32, __bswap_64): Change into static
	(inline) functions.
	* sysdeps/i386/bits/byteswap.h [!__GNUC__] (__bswap_16, __bswap_32):
	Likewise.

2003-01-07  Jakub Jelinek  <jakub@redhat.com>

	* sysdeps/unix/sysv/linux/alpha/adjtime.c (ntp_adjtime): New weak
	alias.

2003-01-07  Jakub Jelinek  <jakub@redhat.com>

	* elf/rtld.c (_rtld_global): Remove _dl_dynamic_weak initializer.
	* elf/dl-support.c (_dl_dynamic_weak): Initialize to 0.

2003-01-07  Ulrich Drepper  <drepper@redhat.com>

	* math/libm-test.inc (significand_test): New function.
	(main): Call it.

2003-01-06  Roland McGrath  <roland@redhat.com>

	* sysdeps/i386/i486/bits/string.h (memset): Add parens around macro
	arguments.
	(memcpy, memrchr, strcpy, __stpcpy, strncpy, strcat): Likewise.
	(strcmp, strncat, strncmp, strchr, __strchrnul, strchrnul): Likewise.
	(index, strrchr, rindex, strcspn, strspn, strpbrk, strstr): Likewise.

	* string/tester.c (test_strcpy): Add test with `void *' arguments.

2003-01-06  Ulrich Drepper  <drepper@redhat.com>

	* sysdeps/i386/fpu/s_significandl.c (__significandl): Really
	return significand and not the exponent.
	Reported by Nelson H. F. Beebe <beebe@math.utah.edu>.

	* elf/dl-misc.c (_dl_debug_vdprintf): Help PPC port by explicitly
	taking address of iov in INTERNAL_SYSCALL call.  Patch by Franz Sirl.

	* malloc/malloc.c: Mark all _int_* functions as static.

2003-01-06  Jakub Jelinek  <jakub@redhat.com>

	* sysdeps/unix/alpha/sysdep.h (PSEUDO): Use PSEUDO_PREPARE_ARGS.
	* sysdeps/unix/sysv/linux/alpha/sigsuspend.S: Add cancellation
	handling.
	* sysdeps/unix/sysv/linux/alpha/select.S: Likewise.

2003-01-06  Franz Sirl  <Franz.Sirl-kernel@lauterbach.com>

	* sysdeps/powerpc/powerpc32/sysdep.h (PSEUDO_RET): Add branch hint.
	* sysdeps/unix/sysv/linux/powerpc/powerpc32/socket.S: Add cancellation
	support.
	* sysdeps/unix/sysv/linux/powerpc/powerpc32/syscalls.list: Remove
	ftruncate64, truncate64, pread64 and pwrite64 entries.
	* sysdeps/unix/sysv/linux/powerpc/powerpc32/sysdep.h
	(INLINE_SYSCALL): Add __builtin_expect.
	(LOADARGS_n): Add argument size safety checks.
	* sysdeps/unix/sysv/linux/powerpc/powerpc32/ftruncate64.c: New file.
	* sysdeps/unix/sysv/linux/powerpc/powerpc32/truncate64.c: New file.
	* sysdeps/unix/sysv/linux/powerpc/powerpc32/pread.c: New file.
	* sysdeps/unix/sysv/linux/powerpc/powerpc32/pread64.c: New file.
	* sysdeps/unix/sysv/linux/powerpc/powerpc32/pwrite.c: New file.
	* sysdeps/unix/sysv/linux/powerpc/powerpc32/pwrite64.c: New file.

2003-01-06  Jakub Jelinek  <jakub@redhat.com>

	* sysdeps/generic/sysdep-cancel.h (LIBC_CANCEL_HANDLED): Define.
	* sysdeps/generic/creat.c: Include sysdep-cancel.h.
	(LIBC_CANCEL_HANDLED): Add.

	* sysdeps/unix/sysv/linux/alpha/sysdep.h
	(inline_syscall_r0_constraint): Rename to...
	(inline_syscall_r0_out_constraint): ... this.  Add =.
	(inline_syscall[0-6]): Use inline_syscall_r0_out_constraint.

2003-01-06  Andreas Schwab  <schwab@suse.de>

	* sysdeps/m68k/dl-machine.h (elf_machine_runtime_setup): Make
	sure this is always inlined.
	(elf_machine_rela): Likewise.

	* sysdeps/m68k/Makefile (sysdep-CFLAGS): Increase inline limit.

2003-01-04  Roland McGrath  <roland@redhat.com>

	* Makeconfig (+mkdep): Add -MP flag.
	Suggested by Art Haas <ahaas@airmail.net>.

2003-01-05  Andreas Schwab  <schwab@suse.de>

	* sysdeps/m68k/Makefile (CFLAGS-.oS): Append -fPIC.

2003-01-05  Kaz Kojima  <kkojima@rr.iij4u.or.jp>

	* sysdeps/unix/sysv/linux/sh/clone.S (__clone): Use
	SYSCALL_ERROR_HANDLER.
	* sysdeps/unix/sysv/linux/sh/pipe.S (__libc_pipe): Likewise.
	* sysdeps/unix/sysv/linux/sh/socket.S (__socket): Likewise.
	Add support for cancellation handling.
	* sysdeps/unix/sysv/linux/sh/syscall.S (__syscall): Use
	SYSCALL_ERROR_HANDLER.
	* sysdeps/unix/sysv/linux/sh/vfork.S (__vfork): Likewise.
	* sysdeps/unix/sysv/linux/sh/sysdep.h (PSEUDO): Likewise.
	Add support for cancellation handling.
	(SYSCALL_ERROR_HANDLER): Define PIC variants.

2003-01-04  Franz Sirl  <Franz.Sirl-kernel@lauterbach.com>

	* sysdeps/unix/sysv/linux/powerpc/powerpc32/syscalls.list: Mark
	__syscall_pread64 and __syscall_pwrite64 cancelable.
	* sysdeps/unix/sysv/linux/powerpc/powerpc32/sysdep.h
	(INTERNAL_SYSCALL): New macro.
	(LOADARGS_0, LOADARGS_1): Fix.

2003-01-05  Ulrich Drepper  <drepper@redhat.com>

	* Makerules (build-shlip-helper): Unless told otherwise, add
	-Wl,-z,defs to linker command line.
	* rt/Makefile (librt.so): Link with ld.so.
	* dlfcn/Makefile (libdl.so): Likewise.

2003-01-05  Jakub Jelinek  <jakub@redhat.com>

	* sysdeps/unix/sysv/linux/s390/s390-32/socket.S: Add support for
	cancellation handling.
	* sysdeps/unix/sysv/linux/s390/s390-64/socket.S: Likewise.
	* sysdeps/unix/sysv/linux/s390/s390-64/sigsuspend.c: Likewise.

2003-01-04  Ulrich Drepper  <drepper@redhat.com>

	* sysdeps/unix/sysv/linux/i386/system.c (cancel_handler): Correct
	order of parameters passed to kill.

2003-01-04  Andreas Schwab  <schwab@suse.de>

	* sysdeps/unix/sysv/linux/m68k/bits/stat.h: Add nanosecond fields.

2002-01-03  Paul Eggert  <eggert@twinsun.com>

	* malloc/obstack.h (__INT_TO_PTR) [__STDC__]: Cast result to
	(void *) to avoid diagnostic with native c89 on SGI IRIX 6.5
	when compiling Bison 1.875's `bitset bset = obstack_alloc
	(bobstack, bytes);'.  Problem reported by Nelson H. F. Beebe.

2003-01-04  Ulrich Drepper  <drepper@redhat.com>

	* sysdeps/posix/system.c (do_system): Minor optimizations.  Remove
	unnecessary code.
	Correct reference counter in case SIGQUIT handler installation failed.

2003-01-03  Ulrich Drepper  <drepper@redhat.com>

	* include/libc-symbols.h [HAVE_WEAK_SYMBOLS] (_weak_extern):
	Define using _Pragma(weak ...).

2003-01-03  Andreas Jaeger  <aj@suse.de>, Jakub Jelinek <jakub@redhat.com>

	* resolv/res_libc.c: Provide declaration for __res_init_weak and
	reorder declarations.

2003-01-03  Art Haas  <ahaas@airmail.net>

	* localedata/tests-mbwc/dat_iswalnum.c: Convert GCC extension
	initializer syntax to C99.
	* localedata/tests-mbwc/dat_iswalpha.c: Likewise.
	* localedata/tests-mbwc/dat_iswcntrl.c: Likewise.
	* localedata/tests-mbwc/dat_iswctype.c: Likewise.
	* localedata/tests-mbwc/dat_iswdigit.c: Likewise.
	* localedata/tests-mbwc/dat_iswgraph.c: Likewise.
	* localedata/tests-mbwc/dat_iswlower.c: Likewise.
	* localedata/tests-mbwc/dat_iswprint.c: Likewise.
	* localedata/tests-mbwc/dat_iswpunct.c: Likewise.
	* localedata/tests-mbwc/dat_iswspace.c: Likewise.
	* localedata/tests-mbwc/dat_iswupper.c: Likewise.
	* localedata/tests-mbwc/dat_iswxdigit.c: Likewise.
	* localedata/tests-mbwc/dat_mblen.c: Likewise.
	* localedata/tests-mbwc/dat_mbrlen.c: Likewise.
	* localedata/tests-mbwc/dat_mbrtowc.c: Likewise.
	* localedata/tests-mbwc/dat_mbsrtowcs.c: Likewise.
	* localedata/tests-mbwc/dat_mbstowcs.c: Likewise.
	* localedata/tests-mbwc/dat_mbtowc.c: Likewise.
	* localedata/tests-mbwc/dat_strcoll.c: Likewise.
	* localedata/tests-mbwc/dat_strfmon.c: Likewise.
	* localedata/tests-mbwc/dat_strxfrm.c: Likewise.
	* localedata/tests-mbwc/dat_swscanf.c: Likewise.
	* localedata/tests-mbwc/dat_towctrans.c: Likewise.
	* localedata/tests-mbwc/dat_towlower.c: Likewise.
	* localedata/tests-mbwc/dat_towupper.c: Likewise.
	* localedata/tests-mbwc/dat_wcrtomb.c: Likewise.
	* localedata/tests-mbwc/dat_wcscat.c: Likewise.
	* localedata/tests-mbwc/dat_wcschr.c: Likewise.
	* localedata/tests-mbwc/dat_wcscmp.c: Likewise.
	* localedata/tests-mbwc/dat_wcscoll.c: Likewise.
	* localedata/tests-mbwc/dat_wcscpy.c: Likewise.
	* localedata/tests-mbwc/dat_wcscspn.c: Likewise.
	* localedata/tests-mbwc/dat_wcslen.c: Likewise.
	* localedata/tests-mbwc/dat_wcsncat.c: Likewise.
	* localedata/tests-mbwc/dat_wcsncmp.c: Likewise.
	* localedata/tests-mbwc/dat_wcsncpy.c: Likewise.
	* localedata/tests-mbwc/dat_wcspbrk.c: Likewise.
	* localedata/tests-mbwc/dat_wcsrtombs.c: Likewise.
	* localedata/tests-mbwc/dat_wcsspn.c: Likewise.
	* localedata/tests-mbwc/dat_wcsstr.c: Likewise.
	* localedata/tests-mbwc/dat_wcstod.c: Likewise.
	* localedata/tests-mbwc/dat_wcstok.c: Likewise.
	* localedata/tests-mbwc/dat_wcstombs.c: Likewise.
	* localedata/tests-mbwc/dat_wcswidth.c: Likewise.
	* localedata/tests-mbwc/dat_wcsxfrm.c: Likewise.
	* localedata/tests-mbwc/dat_wctob.c: Likewise.
	* localedata/tests-mbwc/dat_wctomb.c: Likewise.
	* localedata/tests-mbwc/dat_wctrans.c: Likewise.
	* localedata/tests-mbwc/dat_wctype.c: Likewise.
	* localedata/tests-mbwc/dat_wcwidth.c: Likewise.

2003-01-03  Richard Henderson  <rth@redhat.com>

	* sysdeps/unix/sysv/linux/alpha/sysdep.h (inline_syscall_r0_asm): New.
	(inline_syscall_r0_constraint): New.
	(inline_syscall[0-6]): Use them.

2003-01-03  Jakub Jelinek  <jakub@redhat.com>

	* sysdeps/generic/ldsodefs.h (_dl_allocate_tls, _dl_deallocate_tls):
	Add rtld_hidden_proto.
	* sysdeps/generic/dl-tls.c (_dl_deallocate_tls): Add rtld_hidden_def.
	(_dl_allocate_tls): Likewise.  Remove INTDEF.

2002-07-05  Kaz Kojima  <kkojima@rr.iij4u.or.jp>

	* sysdeps/sh/memcpy.S: Optimize.  Based on a patch by Toshiyasu
	Morita <toshiyasu.morita@hsa.hitachi.com>.
	* sysdeps/sh/memcpy.S: Likewise.

2003-01-02  Ulrich Drepper  <drepper@redhat.com>

	* sysdeps/pthread/aio_suspend.c (aio_suspend): Don't quite remove
	any, but unify the test.

2003-01-02  Jakub Jelinek  <jakub@redhat.com>

	* sysdeps/unix/sysv/linux/arm/sigaction.c (__sigaction,
	sigaction): Protect weak_alias and libc_hidden_weak with
	#ifndef LIBC_SIGACTION.
	* sysdeps/unix/sysv/linux/ia64/sigaction.c (__sigaction,
	sigaction): Likewise.
	* sysdeps/unix/sysv/linux/mips/sigaction.c (__sigaction,
	sigaction): Likewise.
	* sysdeps/unix/sysv/linux/s390/s390-64/sigaction.c (__sigaction,
	sigaction): Likewise.
	* sysdeps/unix/sysv/linux/sparc/sparc32/sigaction.c (__sigaction,
	sigaction): Likewise.
	* sysdeps/unix/sysv/linux/sparc/sparc64/sigaction.c (__sigaction,
	sigaction): Likewise.
	* sysdeps/unix/sysv/linux/x86_64/sigaction.c (__sigaction,
	sigaction): Likewise.
	* sysdeps/unix/sysv/linux/i386/sigaction.c (__sigaction,
	sigaction): Likewise.  Remove SIGCANCEL handling here.
	* sysdeps/unix/sysv/linux/sigaction.c (__sigaction, sigaction):
	Likewise.

2003-01-02  Art Haas  <ahaas@airmail.net>

	* login/tst-utmp.c: Convert GCC extension initializer syntax to C99.

2003-01-02  Ulrich Drepper  <drepper@redhat.com>

	* posix/getconf.c: Update copyright year.
	* nss/getent.c: Likewise.
	* nscd/nscd_nischeck.c: Likewise.
	* iconv/iconvconfig.c: Likewise.
	* iconv/iconv_prog.c: Likewise.
	* elf/ldconfig.c: Likewise.
	* catgets/gencat.c: Likewise.
	* csu/version.c: Likewise.
	* elf/ldd.bash.in: Likewise.
	* elf/sprof.c (print_version): Likewise.
	* locale/programs/locale.c: Likewise.
	* locale/programs/localedef.c: Likewise.
	* nscd/nscd.c (print_version): Likewise.
	* debug/xtrace.sh: Likewise.
	* malloc/memusage.sh: Likewise.
	* malloc/mtrace.pl: Likewise.

2003-01-01  Jakub Jelinek  <jakub@redhat.com>

	* io/sys/stat.h: Include time.h with __need_timespec even if
	__USE_MISC is defined but __USE_XOPEN is not.

2003-01-01  Andreas Jaeger  <aj@suse.de>

	* resolv/nss_dns/dns-host.c (_nss_dns_gethostbyaddr_r): Use union
	type to avoid strict aliasing problem.
	(_nss_dns_gethostbyname2_r): Likewise.
	* resolv/nss_dns/dns-network.c (_nss_dns_getnetbyaddr_r): Likewise.
	(_nss_dns_getnetbyname_r): Likewise.
	* resolv/gethnamaddr.c (_gethtent): Likewise.
	(gethostbyname2): Likewise.

2002-12-31  Ulrich Drepper  <drepper@redhat.com>

	* string/string-inlines.c: Define __memcpy_g and __strchr_g macros
	to avoid using the exported symbols.  Define aliases with the
	original names separately.

	* include/time.h: Add libc_hidden_proto for __strftime_l.
	* include/wchar.h: Add libc_hidden_proto for __wcsftime_l.
	* time/strftime.c: Always use libc_hidden_def if _LIBC.

	* libio/libioP.h: Add libc_hidden_proto for _IO_file_open.
	* libio/fileops.c: Add libc_hidden_def for _IO_file_open.

	* malloc/mtrace.c: Add libc_hidden_proto and libc_hidden_def for
	tr_break.

	* csu/Makefile (routines): Add dso_handle.
	* csu/dso_handle.c: New file.

2002-12-31  Roland McGrath  <roland@redhat.com>

	* Makerules (compile.S, COMPILE.S): Remove -DASSEMBLER here.
	Use $(S-CPPFLAGS) in place of $(asm-CPPFLAGS).
	(S-CPPFLAGS): Add -DASSEMBLER here instead.
	(generate-md5, +make-deps): Fix magic to get $(S-CPPFLAGS).

2002-12-31  Ulrich Drepper  <drepper@redhat.com>

	* malloc/thread-m.h [SHARED] (thread_atfork): Assume __dso_handle
	is available.

2002-12-31  Andreas Jaeger  <aj@suse.de>

	* sysdeps/unix/sysv/linux/powerpc/powerpc32/kernel_stat.h: Sync
	with Linux kernel.
	* sysdeps/unix/sysv/linux/sparc/sparc32/kernel_stat.h: Likewise.
	* sysdeps/unix/sysv/linux/s390/s390-64/kernel_stat.h: Likewise.
	* sysdeps/unix/sysv/linux/hppa/kernel_stat.h: Likewise.

	* sysdeps/unix/sysv/linux/kernel_stat.h
	(_HAVE_STAT_NSEC,_HAVE_STAT_NSEC64): New.

	* sysdeps/unix/sysv/linux/xstatconv.c (xstat_conv): Re-add
	__unused[1-3] since they're needed by some platforms.  Handle
	_HAVE_STAT_NSEC and _HAVE_STAT_NSEC64.

	* sysdeps/unix/sysv/linux/x86_64/bits/stat.h: Add nsec resolution
	for structs stat and stat64.
	* sysdeps/unix/sysv/linux/ia64/bits/stat.h: Likewise.
	* sysdeps/unix/sysv/linux/powerpc/bits/stat.h: Likewise.
	* sysdeps/unix/sysv/linux/sparc/bits/stat.h: Likewise.
	* sysdeps/unix/sysv/linux/s390/bits/stat.h: Likewise.

	* io/sys/stat.h [__USE_MISC]: Define __need_timespec for struct stat.

	* sysdeps/unix/sysv/linux/xstatconv.c (xstat_conv): Adjust for
	nsec resolution changes.
	(xstat64_conv): Likewise.
	(xstat32_conv): Likewise.

	* sysdeps/unix/sysv/linux/kernel_stat.h: Add nsec resolution for
	struct kernel_stat.

	* sysdeps/unix/sysv/linux/bits/stat.h: Add nsec resolution for
	structs stat and stat64.

	* time/time.h (__timespec_defined): Define for __USE_MISC.

2002-12-31  Ulrich Drepper  <drepper@redhat.com>

	* include/signal.h: Add libc_hidden_proto for __libc_current_sigrtmin
	and __libc_current_sigrtmax.

2002-12-31  Jakub Jelinek  <jakub@redhat.com>

	* include/errno.h (__errno_location): Add prototype.
	Use libc_hidden_proto unconditionally.
	* include/netdb.h (__h_errno_location): Use libc_hidden_proto
	unconditionally.
	* include/resolv.h (__res_state): Likewise.

	* hurd/errno-loc.c (__errno_location): Add libc_hidden_def.
	* include/sys/socket.h (accept): Add libc_hidden_proto.
	* include/errno.h (__errno_location): Likewise.
	* include/netdb.h (__h_errno_location): Likewise.
	* include/resolv.h (__res_state): Likewise.
	* include/unistd.h (__lseek): Likewise.
	* sysdeps/generic/errno-loc.c (__errno_location): Add libc_hidden_def.
	* sysdeps/generic/herrno-loc.c (__h_errno_location): Likewise.
	* sysdeps/generic/res-state.c (__res_state): Likewise.
	* sysdeps/generic/accept.c (accept): Likewise.
	* sysdeps/generic/lseek.c (__lseek): Likewise.
	* sysdeps/generic/allocrtsig.c (__libc_current_sigrtmin,
	__libc_current_sigrtmax): Likewise.
	* sysdeps/mach/hurd/accept.c (accept): Likewise.
	* sysdeps/mach/hurd/lseek.c (__lseek): Likewise.
	* sysdeps/unix/sysv/aix/accept.c (accept): Likewise.
	* sysdeps/unix/sysv/aix/lseek.c (__lseek): Likewise.
	* sysdeps/unix/sysv/linux/accept.S (accept): Likewise.
	* sysdeps/unix/inet/syscalls.list (__GI_accept): New alias to accept.
	* sysdeps/unix/sysv/linux/alpha/syscalls.list (__GI_accept): Likewise.
	* sysdeps/unix/sysv/linux/hppa/syscalls.list (__GI_accept): Likewise.
	* sysdeps/unix/sysv/linux/ia64/syscalls.list (__GI___lseek): New
	alias to llseek.
	(__GI_accept): New alias to accept.
	* sysdeps/unix/sysv/linux/mips/syscalls.list (__GI_accept): Likewise.
	* sysdeps/unix/sysv/linux/s390/s390-64/syscalls.list (__GI___lseek):
	New alias to llseek.
	(__GI_accept): New alias to accept.
	* sysdeps/unix/sysv/linux/sparc/sparc64/syscalls.list (__GI_accept):
	Likewise.
	* sysdeps/unix/sysv/linux/x86_64/syscalls.list (__GI_accept):
	Likewise.
	* sysdeps/unix/syscalls.list (__GI___lseek): New alias to lseek.

	* sysdeps/alpha/setjmp.S : Use libc_hidden_def(name) instead of
	strong_alias (name, __GI_name).
	* sysdeps/arm/bsd-_setjmp.S : Likewise.
	* sysdeps/hppa/bsd-_setjmp.S : Likewise.
	* sysdeps/i386/bsd-_setjmp.S : Likewise.
	* sysdeps/mips/mips64/bsd-_setjmp.S : Likewise.
	* sysdeps/mips/bsd-_setjmp.S : Likewise.
	* sysdeps/powerpc/powerpc32/bsd-_setjmp.S : Likewise.
	* sysdeps/powerpc/powerpc64/setjmp.S : Likewise.
	* sysdeps/s390/s390-32/elf/setjmp.S : Likewise.
	* sysdeps/s390/s390-32/bsd-_setjmp.S : Likewise.
	* sysdeps/s390/s390-64/elf/setjmp.S : Likewise.
	* sysdeps/s390/s390-64/bsd-_setjmp.S : Likewise.
	* sysdeps/sh/bsd-_setjmp.S : Likewise.
	* sysdeps/sparc/sparc32/setjmp.S : Likewise.
	* sysdeps/unix/arm/fork.S : Likewise.
	* sysdeps/unix/bsd/hp/m68k/vfork.S : Likewise.
	* sysdeps/unix/bsd/i386/vfork.S : Likewise.
	* sysdeps/unix/bsd/osf/alpha/fork.S : Likewise.
	* sysdeps/unix/bsd/sun/m68k/vfork.S : Likewise.
	* sysdeps/unix/bsd/ultrix4/mips/vfork.S : Likewise.
	* sysdeps/unix/bsd/vax/vfork.S : Likewise.
	* sysdeps/unix/i386/fork.S : Likewise.
	* sysdeps/unix/mips/fork.S : Likewise.
	* sysdeps/unix/sparc/fork.S : Likewise.
	* sysdeps/unix/sparc/vfork.S : Likewise.
	* sysdeps/unix/sysv/linux/arm/vfork.S : Likewise.
	* sysdeps/unix/sysv/linux/cris/vfork.S : Likewise.
	* sysdeps/unix/sysv/linux/i386/vfork.S : Likewise.
	* sysdeps/unix/sysv/linux/ia64/fork.S : Likewise.
	* sysdeps/unix/sysv/linux/ia64/setjmp.S : Likewise.
	* sysdeps/unix/sysv/linux/ia64/vfork.S : Likewise.
	* sysdeps/unix/sysv/linux/m68k/vfork.S : Likewise.
	* sysdeps/unix/sysv/linux/sh/vfork.S : Likewise.
	* sysdeps/unix/sysv/linux/sparc/sparc64/longjmp.S : Likewise.
	* sysdeps/unix/sysv/linux/sparc/sparc64/setjmp.S : Likewise.
	* sysdeps/unix/sysv/linux/sparc/fork.S : Likewise.
	* sysdeps/unix/sysv/linux/sparc/vfork.S : Likewise.
	* sysdeps/unix/sysv/linux/x86_64/vfork.S : Likewise.
	* sysdeps/unix/fork.S : Likewise.
	* sysdeps/vax/bsd-_setjmp.S : Likewise.
	* sysdeps/x86_64/bsd-_setjmp.S : Likewise.

	* sysdeps/unix/sysv/linux/ia64/sysdep.h: Guard against multiple
	inclusion.

2002-12-31  Ulrich Drepper  <drepper@redhat.com>

	* include/unistd.h: Add libc_hidden_proto for __fork and __vfork.
	* sysdeps/generic/fork.c: Add libc_hidden_def for __fork.
	* sysdeps/mach/hurd/fork.c: Likewise.
	* sysdeps/unix/sysv/aix/fork.c: Likewise.
	* sysdeps/unix/fork.S: Add __GI___fork alias.
	* sysdeps/unix/arm/fork.S: Likewise.
	* sysdeps/unix/bsd/osf/alpha/fork.S: Likewise.
	* sysdeps/unix/i386/fork.S: Likewise.
	* sysdeps/unix/mips/fork.S: Likewise.
	* sysdeps/unix/sparc/fork.S: Likewise.
	* sysdeps/unix/sysv/linux/ia64/fork.S: Likewise.
	* sysdeps/unix/sysv/linux/sparc/fork.S: Likewise.
	* sysdeps/unix/sysv/linux/syscalls.list: Likewise.
	* sysdeps/generic/vfork.c: Add libc_hidden_def for __vfork.
	* sysdeps/unix/bsd/hp/m68k/vfork.S: Add __GI___vfork alias.
	* sysdeps/unix/bsd/i386/vfork.S: Likewise.
	* sysdeps/unix/bsd/sun/m68k/vfork.S: Likewise.
	* sysdeps/unix/bsd/ultrix4/mips/vfork.S: Likewise.
	* sysdeps/unix/bsd/vax/vfork.S: Likewise.
	* sysdeps/unix/sparc/vfork.S: Likewise.
	* sysdeps/unix/sysv/linux/arm/vfork.S: Likewise.
	* sysdeps/unix/sysv/linux/cris/vfork.S: Likewise.
	* sysdeps/unix/sysv/linux/i386/vfork.S: Likewise.
	* sysdeps/unix/sysv/linux/ia64/vfork.S: Likewise.
	* sysdeps/unix/sysv/linux/m68k/vfork.S: Likewise.
	* sysdeps/unix/sysv/linux/sh/vfork.S: Likewise.
	* sysdeps/unix/sysv/linux/sparc/vfork.S: Likewise.
	* sysdeps/unix/sysv/linux/x86_64/vfork.S: Likewise.

	* include/time.h: Add libc_hidden_proto for __nanosleep.
	* sysdeps/generic/nanosleep.c: Add libc_hidden_def for __nanosleep.
	* sysdeps/mach/nanosleep.c: Likewise.
	* sysdeps/unix/sysv/aix/nanosleep.c: Likewise.
	* sysdeps/unix/sysv/linux/syscalls.list: Add __GI___nanosleep alias.

	* libio/libioP.h: Add libc_hidden_proto for _IO_list_lock,
	_IO_list_unlock, and _IO_list_resetlock.
	* libio/genops.c: Add libc_hidden_def for _IO_list_lock,
	_IO_list_unlock, and _IO_list_resetlock.

	* libio/libioP.h: Add libc_hidden_proto for _IO_iter_begin,
	_IO_iter_end, _IO_iter_next, and _IO_iter_file.
	* libio/genops.c: Add libc_hidden_def for _IO_iter_begin,
	_IO_iter_end, _IO_iter_next, and _IO_iter_file.

	* include/setjmp.h: Add libc_hidden_proto for __libc_longjmp.
	* sysdeps/generic/longjmp.c: Add libc_hidden_def for __longjmp.
	* sysdeps/unix/sysv/linux/sparc/sparc64/longjmp.S: Add
	__GI___longjmp alias.

	* include/setjmp.h: Add libc_hidden_proto for _setjmp.
	* sysdeps/alpha/setjmp.S: Add __GI__setjmp alias.
	* sysdeps/arm/bsd-_setjmp.S: Likewise.
	* sysdeps/generic/bsd-_setjmp.c: Likewise.
	* sysdeps/hppa/bsd-_setjmp.S: Likewise.
	* sysdeps/i386/bsd-_setjmp.S: Likewise.
	* sysdeps/m68k/bsd-_setjmp.c: Likewise.
	* sysdeps/mips/bsd-_setjmp.S: Likewise.
	* sysdeps/mips/mips64/bsd-_setjmp.S: Likewise.
	* sysdeps/powerpc/powerpc32/bsd-_setjmp.S: Likewise.
	* sysdeps/powerpc/powerpc64/setjmp.S: Likewise.
	* sysdeps/s390/s390-32/bsd-_setjmp.S: Likewise.
	* sysdeps/s390/s390-32/elf/setjmp.S: Likewise.
	* sysdeps/s390/s390-64/bsd-_setjmp.S: Likewise.
	* sysdeps/s390/s390-64/elf/setjmp.S: Likewise.
	* sysdeps/sh/bsd-_setjmp.S: Likewise.
	* sysdeps/sparc/sparc32/setjmp.S: Likewise.
	* sysdeps/unix/sysv/linux/ia64/setjmp.S: Likewise.
	* sysdeps/unix/sysv/linux/sparc/sparc64/setjmp.S: Likewise.
	* sysdeps/vax/bsd-_setjmp.S: Likewise.
	* sysdeps/x86_64/bsd-_setjmp.S: Likewise.

2002-12-30  Ulrich Drepper  <drepper@redhat.com>

	* malloc/thread-m.h (thread_atfork): Define using __register_atfork.

2002-12-30  Roland McGrath  <roland@redhat.com>

	* Rules (generated): Target removed.
	* mach/Makefile (generated): Define it here instead.

	* math/Makefile (generated): Add m_*l and m_*f variants too.

2002-12-30  Ulrich Drepper  <drepper@redhat.com>

	* elf/dl-close.c (_dl_close): Handle relocation dependencies among
	the to-be-deleted objects right away instead of later separately.
	The latter fails because the scope data structures of the DSO
	might already be gone.

	* elf/Makefile: Add rules to build and run reldep8 test.
	* elf/reldep8.c: New file.
	* elf/reldep8mod1.c: New file.
	* elf/reldep8mod2.c: New file.
	* elf/reldep8mod3.c: New file.
	Contributed by Jakub Jelinek.

2002-12-24  GOTO Masanori  <gotom@debian.or.jp>

	* sysdeps/unix/sysv/linux/getdents.c (__GETDENTS): Fix condition
	checking of return value ENOSYS from getdents64.

2002-12-28  Andreas Schwab  <schwab@suse.de>

	* sysdeps/unix/Makefile: Include $(common-objpfx)s-proto-cancel.d.
	($(common-objpfx)s-%.d): Generalized from
	$(common-objpfx)s-proto.d rule.
	(common-generated): Add s-proto-cancel.d.
	* sysdeps/unix/make-syscalls.sh: Use s-proto-cancel.d for
	cancellable syscalls.
	* sysdeps/unix/s-proto-cancel.S: New file.

2002-12-29  Roland McGrath  <roland@redhat.com>

	* resolv/res_libc.c: Move _res defn magic after res_init defn
	so _res macro is in effect for that code.

	* Makerules ($(common-objpfx)%.h $(common-objpfx)%.h.d): Fix sed
	pattern for prepending $(..) so it doesn't affect $(foo).

	* math/Makefile (generated): Add $(addsuffix .c .S,$(calls:s_%=m_%)).

2002-12-29  Jakub Jelinek  <jakub@redhat.com>

	* elf/cache.c (add_to_cache): Don't loop forever with 1ULL << 63 set
	in hwcap.

2002-12-28  Ulrich Drepper  <drepper@redhat.com>

	* misc/sys/cdefs.h (__attribute_deprecated__): New #define.

2002-12-28  Andreas Jaeger  <aj@suse.de>

	* sysdeps/generic/readelflib.c (process_elf_file): Cast value to
	avoid warning.
	* sysdeps/generic/dl-cache.c (_dl_load_cache_lookup): Likewise.

2002-12-27  Jakub Jelinek  <jakub@redhat.com>

	* inet/herrno.c (__h_errno_location): Remove.
	* inet/Makefile (routines): Add herrno-loc.
	* resolv/res_libc.c (__res_state): Remove.
	* resolv/Makefile (routines): Add res-state.
	* sysdeps/generic/herrno-loc.c: New file.
	* sysdeps/generic/res-state.c: New file.

2002-12-27  Jakub Jelinek  <jakub@redhat.com>

	* sysdeps/unix/sysv/linux/i386/sysdep.h (I386_USE_SYSENTER):
	Only define if USE_DL_SYSINFO is defined.

2002-12-22  Jakub Jelinek  <jakub@redhat.com>

	* sysdeps/unix/sysv/linux/ia64/sysdep.h (INLINE_SYSCALL,
	INTERNAL_SYSCALL, INTERNAL_SYSCALL_ERROR_P, INTERNAL_SYSCALL_ERROR):
	Define. Patch by Richard Henderson and Jes Sorensen.
	(PSEUDO): Remove unnecessary ;;.
	* elf/rtld.c (dl_main): Initialize TLS even if no PT_TLS segments
	are found unless TLS_INIT_TP_EXPENSIVE.  Use NONTLS_INIT_TP.
	* sysdeps/generic/libc-tls.c (__libc_setup_tls): Use NONTLS_INIT_TP
	if not initializing thread pointer.
	[!USE_TLS && NONTLS_INIT_TP] (__pthread_initialize_minimal): New.
	* sysdeps/generic/libc-start.c (__pthread_initialize_minimal): Don't
	make it weak also if NONTLS_INIT_TP.
	* sysdeps/unix/common/pause.c: Handle cancellation.
	* sysdeps/unix/sysv/linux/sparc/sparc32/sysdep.h [DONT_LOAD_G1]
	(LOADSYSCALL): Remove.
	(SYSCALL_ERROR_HANDLER_ENTRY): Define.
	(SYSCALL_ERROR_HANDLER): Use it.
	(PSEUDO): Don't jump around error handler.
	* sysdeps/unix/sysv/linux/sparc/sparc32/pipe.S (__libc_pipe): Don't
	jump around error handler.
	* sysdeps/unix/sysv/linux/sparc/sparc32/syscall.S (syscall): Likewise.
	* sysdeps/unix/sysv/linux/sparc/sparc32/socket.S (__socket): Branch
	to __syscall_error_handler on failure.
	* sysdeps/unix/sysv/linux/sparc/sparc64/sysdep.h [DONT_LOAD_G1]
	(LOADSYSCALL): Remove.
	(SYSCALL_ERROR_HANDLER_ENTRY): Define.
	(SYSCALL_ERROR_HANDLER): Use it.
	(PSEUDO): Don't jump around error handler.
	* sysdeps/unix/sysv/linux/sparc/sparc64/pipe.S (__libc_pipe): Don't
	jump around error handler.
	* sysdeps/unix/sysv/linux/sparc/sparc64/syscall.S (syscall): Likewise.
	* sysdeps/unix/sysv/linux/sparc/sparc64/socket.S (__socket): Branch
	to __syscall_error_handler on failure.

2002-12-27  Roland McGrath  <roland@redhat.com>

	* scripts/gen-as-const.awk: New file.
	* Makefile (distribute): Add it.
	* Makerules ($(common-objpfx)%.h %.h.d: %.sym): New pattern rule.
	(before-compile): Add $(gen-as-const-headers:%.sym=$(common-objpfx)%.h)
	to the list.
	(+depfiles): Add $(addprefix $(common-objpfx),$(gen-as-const-headers)).

2002-12-27  Andreas Schwab  <schwab@suse.de>

	* sysdeps/unix/sysv/linux/m68k/socket.S: Add cancellation support.

2002-12-27  Jakub Jelinek  <jakub@redhat.com>

	* malloc/arena.c (ptmalloc_init): Don't call next_env_entry if
	_environ is NULL.

2002-12-27  Andreas Schwab  <schwab@suse.de>

	* Makerules ($(common-objpfx)%.make): Filter through
	$(sed-remove-objpfx).

2002-12-23  Roland McGrath  <roland@redhat.com>

	* scripts/abilist.awk: Produce a more compact format, divided into
	stanzas for each version set, the set name listed only once.
	* scripts/extract-abilist.awk: New file.
	* scripts/merge-abilist.awk: New file.
	* Makerules (check-abi-%, update-abi-%): New pattern rules.
	(update-abi, check-abi): New targets.
	* Makefile (+subdir_targets): Add subdir_{check,update}-abi.

2002-12-19  Roland McGrath  <roland@redhat.com>

	* Makerules (%.symlist): Use LC_ALL=C when running awk script.

	* sysdeps/unix/sysv/linux/i386/brk.c (__brk): Cast result of
	INTERNAL_SYSCALL.

2002-12-21  Andreas Schwab  <schwab@suse.de>

	* elf/check-textrel.c (handle_file): Swap p_type.

2002-12-21  Andreas Schwab  <schwab@suse.de>

	* sysdeps/unix/sysv/linux/m68k/sysdep.h (INTERNAL_SYSCALL): Define.
	(INLINE_SYSCALL): Use it.
	(INTERNAL_SYSCALL_ERROR_P, INTERNAL_SYSCALL_ERRNO): Define.
	(SYSCALL_ERROR_HANDLER): Define RTLD_PRIVATE_ERRNO variant.

	* sysdeps/unix/sysv/linux/m68k/getpagesize.c: Use INTERNAL_SYSCALL.
	* sysdeps/unix/sysv/linux/m68k/brk.c: Likewise.

2002-12-20  Art Haas  <ahaas@airmail.net>

	* sysdeps/gnu/siglist.c: Convert GCC extension initializer
	syntax to C99.

2002-12-21  Philip Blundell  <philb@gnu.org>

	* sysdeps/arm/elf/start.S (_start): Optimise a little.  Push stack
	top as seventh arg to __libc_start_main.
	Reported by paulnash@wildseed.com.

	* sysdeps/unix/sysv/linux/arm/clone.S: Small optimisation.

	* sysdeps/unix/sysv/linux/arm/sigcontextinfo.h: Elide
	compatibility cruft when new enough kernel is assumed.

2002-12-20  Jakub Jelinek  <jakub@redhat.com>

	* sysdeps/unix/sysv/linux/i386/brk.c (__brk): Use INTERNAL_SYSCALL
	instead of INLINE_SYSCALL.

2002-12-20  Ulrich Drepper  <drepper@redhat.com>

	* sysdeps/unix/sysv/linux/i386/sigaction.c (__libc_sigaction): Fix
	typo.

	* sysdeps/unix/sysv/linux/alpha/bits/shm.h: Define SHM_HUGETLB.
	* sysdeps/unix/sysv/linux/bits/shm.h: Likewise.
	* sysdeps/unix/sysv/linux/hppa/bits/shm.h: Likewise.
	* sysdeps/unix/sysv/linux/ia64/bits/shm.h: Likewise.
	* sysdeps/unix/sysv/linux/mips/bits/shm.h: Likewise.
	* sysdeps/unix/sysv/linux/powerpc/bits/shm.h: Likewise.
	* sysdeps/unix/sysv/linux/s390/bits/shm.h: Likewise.
	* sysdeps/unix/sysv/linux/sparc/bits/shm.h: Likewise.
	* sysdeps/unix/sysv/linux/x86_64/bits/shm.h: Likewise.
	Patch by William Lee Irwin <wli@holomorphy.com>.

2002-12-20  Andreas Schwab  <schwab@suse.de>

	* locale/programs/ld-measurement.c (measurement_output): Fix
	index calculation.

2002-12-20  Ulrich Drepper  <drepper@redhat.com>

	* include/libio.h [_IO_MTSAFE_IO && _IO_lock_inexpensive]:
	Redefine _IO_flockifle and _IO_funlockfile as inlines.

	* sysdeps/generic/dl-sysdep.c (_dl_important_hwcaps): For TLS
	builds add "tls" in the search path.
	* elf/ldconfig.c (is_hwcap_platform): Also recognize "tls".
	(path_hwcap): Recognize "tls".

2002-12-19  Ulrich Drepper  <drepper@redhat.com>

	* sysdeps/unix/sysv/linux/i386/system.c (cancel_handler): Use
	__waitpid instead of waitpid.

	* sysdeps/unix/sysv/linux/i386/_exit.S: Use ENTER_KERNEL instead of
	int $0x80.
	* sysdeps/unix/sysv/linux/i386/getcontext.S: Likewise.
	* sysdeps/unix/sysv/linux/i386/setcontext.S: Likewise.
	* sysdeps/unix/sysv/linux/i386/swapcontext.S: Likewise.

	* sysdeps/unix/sysv/linux/i386/sysdep.h: Add support to use AT_SYSINFO
	information for system calls.

	* sysdeps/generic/dl-sysdep.h: Define RTLD_PRIVATE_ERRNO to 1 only
	for ld.so.

	* elf/rtld.c (_dl_start) [USE___THREAD]: Define initdtv.

2002-12-19  Roland McGrath  <roland@redhat.com>

	* iconvdata/ibm856.h: Convert GCC extension initializer syntax to C99.
	* iconvdata/ibm922.h: Likewise.
	* iconvdata/ibm930.h: Likewise.
	* iconvdata/ibm932.h: Likewise.
	* iconvdata/ibm933.h: Likewise.
	* iconvdata/ibm935.h: Likewise.
	* iconvdata/ibm937.h: Likewise.
	* iconvdata/ibm939.h: Likewise.
	* iconvdata/ibm943.h: Likewise.
	* iconvdata/isiri-3342.h: Likewise.

2002-12-19  Ulrich Drepper  <drepper@redhat.com>

	* test-skeleton.c (main): Make sure correct value is seen as
	argv[0] after adjustment of argv, and argc.

	* elf/rtld.c: Don't initialize _dl_dynamic_weak to 1 if
	RTLD_CORRECT_DYNAMIC_WEAK is defined.

2002-12-19  Jakub Jelinek  <jakub@redhat.com>

	* nscd/connections.c (nscd_run): Shut up warning.
	* tst-ungetc.c (assert): Undefined before redefining.

2002-12-19  Ulrich Drepper  <drepper@redhat.com>

	* posix/regex.c: Use __builtin_expect even outside glibc if gcc 3
	is used.

2002-12-17  Art Haas  <ahaas@airmail.net>

	* iconvdata/cp737.h: Convert GCC extension initializer syntax to C99.
	* iconvdata/cp775.h: Likewise.
	* iconvdata/ibm1046.h: Likewise.
	* iconvdata/ibm1124.h: Likewise.
	* iconvdata/ibm1129.h: Likewise.
	* iconvdata/ibm1132.h: Likewise.
	* iconvdata/ibm1133.h: Likewise.
	* iconvdata/ibm1160.h: Likewise.
	* iconvdata/ibm1161.h: Likewise.
	* iconvdata/ibm1162.h: Likewise.
	* iconvdata/ibm1163.h: Likewise.
	* iconvdata/ibm1164.h: Likewise.

2002-12-19  Ulrich Drepper  <drepper@redhat.com>

	* sysdeps/unix/sysv/linux/i386/system.c: Define FORK only if
	__ASSUME_CLONE_THREAD_FLAGS is defined.
	* sysdeps/unix/sysv/linux/kernel-features.h
	(__ASSUME_CLONE_THREAD_FLAGS): Define for x86 and kernel >= 2.5.50.

2002-12-18  Ulrich Drepper  <drepper@redhat.com>

	* sysdeps/unix/sysv/linux/i386/brk.c: Use INTERNAL_SYSCALL instead
	of asm.
	* sysdeps/unix/sysv/linux/i386/sigaction.c: Likewise.

	* elf/dl-support.c [NEED_DL_SYSINFO]: Define and initialize
	_dl_sysinfo.
	[DL_SYSINFO_IMPLEMENTATION]: If defined use it to generate the needed
	code.
	* elf/rtld.c [DL_NEED_SYSINFO]: Initialize _dl_sysinfo element of
	_rtld_global.
	[DL_SYSINFO_IMPLEMENTATION]: If defined use it to generate the needed
	code.
	* sysdeps/generic/dl-sysdep.c (_dl_sysdep_start) [NEED_DL_SYSINFO]:
	Check for AT_SYSINFO and set _dl_sysinfo appropriately.
	* sysdeps/generic/ldsodefs.h (struct rtld_global) [NEED_DL_SYSINFO]:
	Add _dl_sysinfo.

2002-12-18  Jakub Jelinek  <jakub@redhat.com>

	* misc/Versions [libc: GLIBC_2.3.1]: Move __libc_readv and
	__libc_writev to...
	[libc: GLIBC_PRIVATE]: ...here.
	* sysvipc/Versions [libc: GLIBC_2.3.1]: Move __libc_msgrcv and
	__libc_msgsnd to...
	[libc: GLIBC_PRIVATE]: ...here.

2002-12-18  Ulrich Drepper  <drepper@redhat.com>

	* sysdeps/unix/sysv/linux/i386/sysdep.h: Define ENTER_KERNEL macro.
	Use it instead of directly int $0x80.
	* sysdeps/unix/sysv/linux/i386/brk.c: Use ENTER_KERNEL.
	* sysdeps/unix/sysv/linux/i386/mmap64.S: Likewise.
	* sysdeps/unix/sysv/linux/i386/mmap.S: Likewise.
	* sysdeps/unix/sysv/linux/i386/sigaction.c: Likewise.
	* sysdeps/unix/sysv/linux/i386/socket.S: Likewise.
	* sysdeps/unix/sysv/linux/i386/syscall.S: Likewise.

2002-12-17  Ulrich Drepper  <drepper@redhat.com>

	* malloc/malloc.c (mALLOPt): Make sure malloc is initialized.

	* elf/elf.h (AT_SYSINFO): New define.
	* sysdeps/generic/dl-sysdep.c (_dl_show_auxv): Add support for
	AT_SYSINFO.

2002-12-17  Jakub Jelinek  <jakub@redhat.com>

	* sysdeps/unix/sysv/linux/alpha/syscalls.list (msgrcv, msgsnd):
	Make cancelable.
	* sysdeps/unix/sysv/linux/hppa/syscalls.list (msgrcv, msgsnd):
	Likewise.
	* sysdeps/unix/sysv/linux/ia64/syscalls.list (msgrcv, msgsnd):
	Likewise.
	* sysdeps/unix/sysv/linux/s390/s390-64/syscalls.list (msgrcv, msgsnd):
	Likewise.
	* sysdeps/unix/sysv/linux/x86_64/syscalls.list (msgrcv, msgsnd):
	Likewise.
	* sysdeps/unix/sysv/linux/ia64/sigsuspend.c (__sigsuspend): Likewise.

	* malloc/thread-m.h (mutex_init, mutex_lock, mutex_trylock,
	mutex_unlock): If not building NPTL, use __libc_maybe_call2 if
	available, otherwise __libc_maybe_call.
	* sysdeps/unix/sysv/linux/x86_64/recv.c: Add support for
	cancellation handling.
	* sysdeps/unix/sysv/linux/x86_64/send.c: Likewise.

2002-12-17  Isamu Hasegawa  <isamu@yamato.ibm.com>

	* posix/regcomp.c (free_workarea_compile): Free the new member
	ORG_INDICES.
	(analyze): Initialize ORG_INDICES.
	(duplicate_node_closure): Search for a existing node, which is
	duplicated from the node ORG_DEST and satisfies the constraint
	CONSTRAINT.  And use it to avoid inifimite loop.
	(search_duplicated_node): New function.
	(duplicate_node): Store the index of the original node.
	* posix/regex_internal.c (re_dfa_add_node): Realloc ORG_INDICES
	if needed.
	* posix/regex_internal.h (re_dfa_t): Add new members.

2002-12-17  Ulrich Drepper  <drepper@redhat.com>

	* stdio-common/tst-fdopen.c: Undefine assert before redefining it.

2002-12-16  Ulrich Drepper  <drepper@redhat.com>

	* sysdeps/posix/system.c (do_system): Add support for installation
	of cancellation handlers.
	* sysdeps/unix/sysv/linux/i386/system.c: New file.

	* stdlib/Makefile (tests): Add tst-system.
	* stdlib/tst-system.c: New file.

	* sysdeps/unix/sysv/linux/i386/socket.S [NEED_CANCELLATION &&
	CENABLE]: Don't lose content of %ebx.

2002-12-17  Jakub Jelinek  <jakub@redhat.com>

	* sysdeps/unix/sysv/linux/i386/socket.S: Use SINGLE_THREAD_P
	macro instead of comparing %gs:MULTIPLE_THREADS_OFFSET directly.

2002-12-16  Ulrich Drepper  <drepper@redhat.com>

	* sysdeps/posix/getaddrinfo.c (gaih_inet): If __nss_lookup_function
	fails to return a function pointer don't use it.

2002-12-16  Art Haas  <ahaas@airmail.net>

	* io/ftw.c: Convert GCC extension initializer syntax to C99.
	* iconvdata/iso-ir-165.c: Likewise.
	* iconvdata/jis0208.c: Likewise.
	* iconvdata/jis0212.c: Likewise.

2002-12-16  Ulrich Drepper  <drepper@redhat.com>

	* sysdeps/unix/sysv/linux/syscalls.list: Add epoll_create,
	epoll_ctl, and epoll_wait.
	* sysdeps/unix/sysv/linux/Versions [libc: GLIBC_2.3.2]: Add
	epoll_create, epoll_ctl, and epoll_wait.
	* sysdeps/unix/sysv/linux/sys/epoll.h: New file.  Written by
	Davide Libenzi <davidel@xmailserver.org>.
	* sysdeps/unix/sysv/linux/Dist: Add sys/epoll.h.
	* sysdeps/unix/sysv/linux/Makefile [subdir=misc] (sysdep_headers):
	Add sys/epoll.h.

2002-12-16  Art Haas  <ahaas@airmail.net>

	* sysdeps/generic/bp-semctl.h: Convert GCC extension initializer
	syntax to C99
	* sysdeps/unix/sysv/aix/settimer.c: Likewise.
	* sysdeps/unix/sysv/aix/sleep.c: Likewise.
	* sysdeps/unix/sysv/aix/usleep.c: Likewise.

2002-12-16  Ulrich Drepper  <drepper@redhat.com>

	* stdio-common/Makefile (routines): Remove lockfile.  Add
	flockfile, ftrylockfile, and funlockfile.
	* sysdeps/generic/lockfile.c: Removed.  Each function has its own file.
	* sysdeps/generic/flockfile.c: New file.
	* sysdeps/generic/ftrylockfile.c: New file.
	* sysdeps/generic/funlockfile.c: New file.

2002-12-16  Jakub Jelinek  <jakub@redhat.com>

	* sysdeps/unix/sysv/linux/i386/socket.S: Use CENABLE and CDISABLE
	macros instead of doing the calls directly.
	* sysdeps/unix/make-syscalls.sh: Add ptw-*.$o target name to rules.
	* Makerules ($(+sysdir_pfx)sysd-rules): Emit rules for ptw-%
	targets.

2002-12-16  Jakub Jelinek  <jakub@redhat.com>

	* sysdeps/i386/fpu/bits/mathinline.h: Backout last change.
	* sysdeps/ieee754/bits/nan.h: Likewise.

	* sysdeps/unix/sysv/linux/ia64/syscalls.list (__syscall_open,
	__syscall_wait4, __syscall_ioctl, __syscall_write): Add.

2002-12-16  Roland McGrath  <roland@redhat.com>

	* sunrpc/xdr_mem.c (xdrmem_inline): Fix argument type.
	* sunrpc/xdr_rec.c (xdrrec_inline): Likewise.
	* sunrpc/xdr_stdio.c (xdrstdio_inline): Likewise.

	* sysdeps/unix/sysv/linux/syscalls.list: Add getpmsg, putpmsg.
	* sysdeps/unix/sysv/linux/mips/syscalls.list: Remove s_getpmsg,
	s_putpmsg.
	* sysdeps/unix/sysv/linux/i386/getpmsg.c: File removed.
	* sysdeps/unix/sysv/linux/i386/putpmsg.c: File removed.
	* sysdeps/unix/sysv/linux/m68k/getpmsg.c: File removed.
	* sysdeps/unix/sysv/linux/m68k/putpmsg.c: File removed.
	* sysdeps/unix/sysv/linux/mips/getpmsg.c: File removed.
	* sysdeps/unix/sysv/linux/mips/putpmsg.c: File removed.
	* sysdeps/unix/sysv/linux/powerpc/getpmsg.c: File removed.
	* sysdeps/unix/sysv/linux/powerpc/putpmsg.c: File removed.

2002-12-13  Paul Eggert  <eggert@twinsun.com>

	* sunrpc/rpc/xdr.h (struct XDR.xdr_ops.x_inline): 2nd arg
	is now u_int, not int.
	(struct XDR.x_handy): Now u_int, not int.
	* sunrpc/xdr_mem.c: Include <limits.h>.
	(xdrmem_getlong, xdrmem_putlong, xdrmem_getbytes, xdrmem_putbytes,
	xdrmem_inline, xdrmem_getint32, xdrmem_putint32):
	x_handy is now unsigned, not signed.
	Do not decrement x_handy if no change is made.
	(xdrmem_setpos): Check for int overflow.
	* sunrpc/xdr_sizeof.c (x_inline): 2nd arg is now unsigned.
	(xdr_sizeof): Remove cast that is now unnecessary, now that
	x_handy is unsigned.

2002-12-15  Art Haas  <ahaas@airmail.net>

	* iconv/gconv_conf.c: Convert GCC extension initializer syntax to C99.
	* iconvdata/gap.awk: Likewise.
	* iconvdata/gen-8bit-gap-1.sh: Likewise.
	* iconvdata/gen-8bit-gap.sh: Likewise.
	* locale/C-address.c: Likewise.
	* locale/C-collate.c: Likewise.
	* locale/C-ctype.c: Likewise.
	* locale/C-identification.c: Likewise.
	* locale/C-measurement.c: Likewise.
	* locale/C-messages.c: Likewise.
	* locale/C-monetary.c: Likewise.
	* locale/C-name.c: Likewise.
	* locale/C-numeric.c: Likewise.
	* locale/C-paper.c: Likewise.
	* locale/C-telephone.c: Likewise.
	* locale/C-time.c: Likewise.
	* nscd/connections.c: Likewise.
	* nscd/grpcache.c: Likewise.
	* nscd/hstcache.c: Likewise.
	* nscd/pwdcache.c: Likewise.
	* stdio-common/vfprintf.c: Likewise.
	* stdlib/random.c: Likewise.
	* sysdeps/generic/siglist.c: Likewise.
	* sysdeps/i386/fpu/bits/mathinline.h: Likewise.
	* sysdeps/ieee754/bits/nan.h: Likewise.
	* sysdeps/posix/sprofil.c: Likewise.
	* sysdeps/unix/sysv/linux/sleep.c: Likewise.
	* sysdeps/unix/sysv/linux/sysctl.c: Likewise.
	* sysdeps/unix/sysv/linux/usleep.c: Likewise.

2002-12-15  Roland McGrath  <roland@redhat.com>

	* sysdeps/unix/sysv/linux/readv.c (do_readv): Use prototype defn.

	* sysdeps/unix/sysv/linux/wait.c: Don't include <nptl/pthreadP.h> or
	<tls.h> here, no need for it.
	* sysdeps/unix/sysv/linux/waitpid.c: Likewise.

	* sysdeps/unix/sysv/linux/i386/fcntl.c (do_fcntl): Take ARG as void *
	parameter, not varargs parameter.

	* sysdeps/generic/sysdep-cancel.h (LIBC_CANCEL_RESET): Evaluate the
	argument so it's not an unused variable.

	* resolv/resolv.h (__p_key_syms, __p_cert_syms, __p_class_syms,
	__p_type_syms, __p_rcode_syms): Remove decls, never really intended
	for users.

	* resolv/Versions (libresolv: GLIBC_2.3.2): New set, add __p_rcode.

2002-12-15  Ulrich Drepper  <drepper@redhat.com>

	* sysdeps/unix/sysv/linux/i386/fcntl.c (do_fcntl): This is the
	original __libc_fcntl code.  Just renamed.

2002-12-15  Andreas Schwab  <schwab@suse.de>

	* sysdeps/unix/sysv/linux/m68k/clone.S: Make inline syscall to _exit.

2002-12-14  Olaf Hering  <olh@suse.de>

	* sysdeps/powerpc/bits/setjmp.h: Include <bits/wordsize.h>.
	* sysdeps/powerpc/powerpc64/setjmp.S: Fix typo in r18 load.

2002-12-15  Ulrich Drepper  <drepper@redhat.com>

	* sysdeps/unix/sysv/linux/libc_fatal.c: New file.

	* sysdeps/generic/sysdep-cancel.h: Add dummy definitions for
	SINGLE_THREAD_P, LIBC_CANCEL_ASYNC, and LIBC_CANCEL_RESET.

	* sysdeps/unix/sysv/linux/open64.c: New file.

	* sysdeps/generic/pselect.c: Add support for cancellation handling.
	* sysdeps/posix/open64.c: Likewise.
	* sysdeps/posix/sigpause.c: Likewise.
	* sysdeps/posix/sigwait.c: Likewise.
	* sysdeps/posix/system.c: Likewise.
	* sysdeps/posix/waitid.c: Likewise.
	* sysdeps/unix/sysv/linux/accept.S: Likewise.
	* sysdeps/unix/sysv/linux/connect.S: Likewise.
	* sysdeps/unix/sysv/linux/llseek.c: Likewise.
	* sysdeps/unix/sysv/linux/msgrcv.c: Likewise.
	* sysdeps/unix/sysv/linux/msgsnd.c: Likewise.
	* sysdeps/unix/sysv/linux/poll.c: Likewise.
	* sysdeps/unix/sysv/linux/pread.c: Likewise.
	* sysdeps/unix/sysv/linux/pread64.c: Likewise.
	* sysdeps/unix/sysv/linux/pwrite.c: Likewise.
	* sysdeps/unix/sysv/linux/pwrite64.c: Likewise.
	* sysdeps/unix/sysv/linux/readv.c: Likewise.
	* sysdeps/unix/sysv/linux/recv.S: Likewise.
	* sysdeps/unix/sysv/linux/recvfrom.S: Likewise.
	* sysdeps/unix/sysv/linux/recvmsg.S: Likewise.
	* sysdeps/unix/sysv/linux/send.S: Likewise.
	* sysdeps/unix/sysv/linux/sendmsg.S: Likewise.
	* sysdeps/unix/sysv/linux/sendto.S: Likewise.
	* sysdeps/unix/sysv/linux/sigsuspend.c: Likewise.
	* sysdeps/unix/sysv/linux/sigtimedwait.c: Likewise.
	* sysdeps/unix/sysv/linux/sigwait.c: Likewise.
	* sysdeps/unix/sysv/linux/sigwaitinfo.c: Likewise.
	* sysdeps/unix/sysv/linux/tcdrain.c: Likewise.
	* sysdeps/unix/sysv/linux/wait.c: Likewise.
	* sysdeps/unix/sysv/linux/waitpid.c: Likewise.
	* sysdeps/unix/sysv/linux/writev.c: Likewise.
	* sysdeps/unix/sysv/linux/i386/fcntl.c: Likewise.
	* sysdeps/unix/sysv/linux/i386/socket.S: Likewise.

2002-12-14  Jakub Jelinek  <jakub@redhat.com>

	* sysdeps/generic/sysdep-cancel.h: New file.
	* sysdeps/unix/make-syscalls.sh: Handle C at start of args as
	cancelable syscall.
	* sysdeps/unix/inet/syscalls.list (accept, connect, recv, recvfrom,
	recvmsg, send, sendmsg, sendto): Make cancelable.
	* sysdeps/unix/mman/syscalls.list (msync): Likewise.
	* sysdeps/unix/sysv/linux/alpha/syscalls.list (llseek, pread,
	pwrite, accept, connect, recv, recvfrom, recvmsg, send, sendmsg,
	sendto, osf_select): Likewise.
	* sysdeps/unix/sysv/linux/hppa/syscalls.list (accept, connect, recv,
	recvfrom, recvmsg, send, sendmsg, sendto): Likewise.
	* sysdeps/unix/sysv/linux/ia64/syscalls.list (llseek, pread,
	pwrite, accept, connect, recv, recvfrom, recvmsg, send, sendmsg,
	sendto): Likewise.
	* sysdeps/unix/sysv/linux/mips/syscalls.list (accept, connect, recv,
	recvfrom, recvmsg, send, sendmsg, sendto): Likewise.
	* sysdeps/unix/sysv/linux/s390/s390-64/syscalls.list (llseek, pread,
	pwrite, accept, connect, recv, recvfrom, recvmsg, send, sendmsg,
	sendto): Likewise.
	* sysdeps/unix/sysv/linux/sparc/sparc64/syscalls.list (llseek, pread,
	pwrite, accept, connect, recv, recvfrom, recvmsg, send, sendmsg,
	sendto, select): Likewise.
	* sysdeps/unix/sysv/linux/x86_64/syscalls.list (llseek, pread,
	pwrite, accept, connect, recvfrom, recvmsg, sendmsg, sendto):
	Likewise.
	* sysdeps/unix/sysv/linux/syscalls.list (creat, nanosleep, pause,
	select, fcntl): Likewise.
	* sysdeps/unix/sysv/syscalls.list (pause, poll): Likewise.
	* sysdeps/unix/syscalls.list (close, fcntl, fsync, lseek, open,
	read, readv, select, sigsuspend, write, writev): Likewise.

2002-12-14  Jakub Jelinek  <jakub@redhat.com>

	* dirent/bug-readdir1.c: Include unistd.h.

2002-12-13  Jakub Jelinek  <jakub@redhat.com>

	* locale/programs/locale.c: Include locarchive.h.
	(ARCHIVE_NAME): Define.
	(write_archive_locales): New function.
	(write_locales): Use it.  Ensure the same locale is not printed
	multiple times in verbose mode.
	Mode LC_IDENTIFICATION and LC_CTYPE printing into...
	(print_LC_IDENTIFICATION, print_LC_CTYPE): ... these helper
	functions.
	(struct nameent): New type.
	(nameentcmp): New function.

2002-12-14  Jakub Jelinek  <jakub@redhat.com>

	* posix/regex_internal.c (re_string_context_at): Guard wide char
	code with #ifdef RE_ENABLE_I18N.

2002-11-22  Paolo Bonzini  <bonzini@gnu.org>

	* posix/regcomp.c (regcomp): __re_compile_fastmap -> re_compile_fastmap

2002-12-13  Roland McGrath  <roland@redhat.com>

	* posix/bug-regex15.c: New file.
	* posix/Makefile (tests): Add it.

	* test-skeleton.c (TEST_DATA_LIMIT): New macro, default to 64MB.
	(main): Set RLIMIT_DATA limit to TEST_DATA_LIMIT (or lower if need be).

2002-12-13  Ulrich Drepper  <drepper@redhat.com>

	* elf/dl-misc.c (_dl_debug_vdprintf): Don't depend on 5-digit PIDs.

	* misc/syslog.c (log_cleanup): Don't use parameter in
	__libc_lock_unlock call, use syslog_lock directly.  Adjust callers to
	pass NULL instead of a pointer to syslog_lock.

2002-12-12  Ulrich Drepper  <drepper@redhat.com>

	* iconvdata/Makefile: iconv-rules: Add definition to use gconv.map
	linker map for all iconv modules.
	(distribute): Add gconv.map.
	* iconvdata/gconv.map: New file.

	* elf/Makefile: Also check all iconv modules for text relocations.

	* stdlib/Makefile: Remove code to automatically import GMP.

	* elf/Makefile (tests): Add rules to build and run check-textrel.
	* elf/check-textrel.c: New file.

	* sysdeps/unix/sysv/linux/i386/sysdep.h (SETUP_PIC_REG): Add .size
	directive.

2002-12-11  Jakub Jelinek  <jakub@redhat.com>

	* io/test-utime (main): If stnow.st[am]time is wrong, print it and
	not st.st[am]time.

2002-04-30  Bruno Haible  <bruno@clisp.org>

	* intl/loadmsgcat.c (_nl_init_domain_conv): Don't append //TRANSLIT to
	the encoding if it already has slashes.
	Reported by Perry Rapp <prapp@erols.com>.

2002-12-11  Roland McGrath  <roland@redhat.com>

	* csu/Makefile ($(objpfx)elf-init.oS): Remove target, braino.
	(CPPFLAGS-elf-init.oS, CFLAGS-elf-init.oS): New variables.
	Turn off PIC for compiling this file.

2002-12-11  Ulrich Drepper  <drepper@redhat.com>

	* malloc/thread-m.h: Remove thread_id type and MUTEX_INITIALIZER
	definitions.  Not needed.
	[_LIBC]: Use definitions from libc-lock.h instead of referencing
	pthread routines directly.
	* malloc/arena.c (ptmalloc_unlock_all2): Don't add (void) to
	mutex_init calls.
	(arena_get2): Don't look at return value of mutex_lock.

2002-12-11  Roland McGrath  <roland@redhat.com>

	* csu/Makefile ($(objpfx)elf-init.oS): New target, just clone
	elf-init.o instead of compiling a PIC version.

2002-12-11  Bruno Haible  <bruno@clisp.org>

	* intl/gettext.h: Renamed to ...
	* intl/gmo.h: ... here.
	* intl/Makefile (distribute): Add gmo.h, remove gettext.h.
	* intl/gettextP.h: Update.
	* intl/loadmsgcat.c: Update.

	* intl/gettextP.h (PARAMS): Make more portable.
	(attribute_hidden): Define as empty macro if not already defined.
	* intl/hash-string.h (PARAMS): Make more portable.
	* intl/loadinfo.h (PARAMS): Likewise.
	* intl/plural-exp.h (PARAMS): Likewise.
	(attribute_hidden): Move definition near the definition of
	internal_function.

	* intl/gettextP.h (_nl_locale_name) [!_LIBC]: New declaration.
	* intl/plural-exp.h (plural_eval) [!_LIBC]: New declaration.

2002-07-13  Bruno Haible  <bruno@clisp.org>

	* intl/dcigettext.c (freea): New macro.
	(FREE_BLOCKS): Free also the registered blocks.
	(DCIGETTEXT): Free the 'search' variable.
	Reported by Andreas Fischer <a.fischer@asentics.de>.

2002-04-27  Bruno Haible  <bruno@clisp.org>

	* intl/gettextP.h [! _LIBC]: Use prefix libintl_ instead of suffix __.
	* intl/dcigettext.c: Likewise.
	* intl/dcgettext.c: Likewise.
	* intl/dgettext.c: Likewise.
	* intl/gettext.c: Likewise.
	* intl/dcngettext.c: Likewise.
	* intl/dngettext.c: Likewise.
	* intl/ngettext.c: Likewise.
	* intl/textdomain.c: Likewise.
	* intl/bindtextdom.c: Likewise.
	* intl/plural-exp.h: Likewise.

2002-01-02  Bruno Haible  <bruno@clisp.org>

	* intl/loadmsgcat.c (_nl_init_domain_conv): Use PARAMS in extern decl.

2001-04-30  Bruno Haible  <bruno@clisp.org>

	* intl/dcigettext.c (getuid, getgid, geteuid, getegid): Provide
	default macro definitions.  Needed for mingw32.

2002-12-10  Ulrich Drepper  <drepper@redhat.com>

	* sysdeps/i386/bits/byteswap.h (__bswap_64): Apply
	__builtin_constant_p to macro parameter.

	* sysdeps/generic/sigpause.c: Define all functions as weak.
	* sysdeps/posix/sigpause.c: Likewise.

	* elf/tst-tls7.c (do_test): Adjustments for l_tls_modid being of
	type size_t.

2002-12-10  Jakub Jelinek  <jakub@redhat.com>

	* elf/tst-array1.c (preinit_array, init_array, fini_array):
	Explicitly align the array to sizeof (void *).
	* elf/tst-array2dep.c (init_array, fini_array): Likewise.

	* include/libc-symbols.h: Fix a comment typo.

	* sysdeps/unix/sysv/linux/alpha/select.S (__libc_select): New alias.
	* sysdeps/unix/sysv/linux/alpha/sigsuspend.S (__libc_sigsuspend):
	Likewise.
	* sysdeps/unix/sysv/linux/ia64/sigsuspend.c (__libc_sigsuspend):
	Likewise.
	* sysdeps/unix/sysv/linux/s390/s390-64/sigsuspend.c
	(__libc_sigsuspend): Likewise.
	* sysdeps/unix/sysv/linux/sparc/sparc64/sigsuspend.c
	(__libc_sigsuspend): Likewise.
	* sysdeps/generic/creat.c (__libc_creat): Renamed from creat.
	(creat): New weak alias.

2002-12-10  Roland McGrath  <roland@redhat.com>

	* manual/libc-texinfo.sh: Emit @set ADD-ON for each ADD-ON that
	contributes a manual chapter.
	* manual/signal.texi (Process Signal Mask): Use @ifset linuxthreads
	around xref to it.

	* sysdeps/unix/sysv/linux/dl-librecon.h (EXTRA_LD_ENVVARS): Refer to
	and move contents to ...
	(EXTRA_LD_ENVVARS_LINUX): ... this new macro.  Add break for nonmatch.
	* sysdeps/unix/sysv/linux/i386/dl-librecon.h (EXTRA_LD_ENVVARS): Use
	it instead of duplicating its contents.
	(EXTRA_LD_ENVVARS): Likewise.  Add break for nonmatch.

2002-12-09  Jakub Jelinek  <jakub@redhat.com>

	* elf/dl-support.c (_dl_non_dynamic_init): Add DL_OSVERSION_INIT if
	defined.
	* sysdeps/unix/sysv/linux/dl-librecon.h (_dl_osversion_init): New
	function.
	(EXTRA_LD_ENVVARS): Use it.
	(DL_OSVERSION_INIT): Define.
	* sysdeps/unix/sysv/linux/i386/dl-librecon.h: Include linux
	dl-librecon.h.
	(EXTRA_LD_ENVVARS): Undef before defining.  Use _dl_osversion_init.

2002-12-10  Ulrich Drepper  <drepper@redhat.com>

	* Versions.def: No new symbols in 2.3.1, but some new ones in 2.3.2.

	* sysdeps/unix/closedir.c (__closedir): Remove __libc_lock_lock
	call.  It is not allowed to destroy pthread mutexes which are
	still in use even though it is safe for our implementations.  If
	somebody still uses the descriptor it is a bug.

2002-12-09  Richard Henderson  <rth@redhat.com>

	* csu/abi-note.S: Use .p2align, not .align.

2002-12-09  Ulrich Drepper  <drepper@redhat.com>

	* sysdeps/unix/sysv/linux/syscalls.list: Add __libc_creat and
	__libc_select aliases.

	* sysdeps/unix/sysv/linux/sigwaitinfo.c: Define __libc_sigwaitinfo
	alias.

	* sysdeps/unix/sysv/linux/sigwait.c: Define __libc_sigwait alias.

	* sysdeps/unix/sysv/linux/sigsuspend.c: Define __libc_sigsuspend alias.

	* sysdeps/unix/sysv/linux/poll.c: Define __libc_poll alias.

	* sysdeps/unix/syscalls.list: Define __libc_select alias.

	* sysdeps/posix/waitid.c: Define __libc_waitid alias.

	* sysdeps/posix/sigpause.c: Define __libc_sigpause and
	__libc___xpg_sigpause aliases.

	* sysdeps/generic/pselect.c: Define __libc_pselect alias.

	* misc/error.c: Remove use of USE_IN_LIBIO.

2002-12-08  Roland McGrath  <roland@redhat.com>

	* elf/Makefile (tests): Uncomment tst-array[123].
	* Makeconfig (CPPFLAGS-.oS): Add -DLIBC_NONSHARED=1.
	* csu/elf-init.c: New file.
	* csu/Makefile (routines, static-only-routines): Add elf-init.
	* sysdeps/alpha/elf/start.S: Use __libc_csu_init in place of _init
	and __libc_csu_fini in place of _fini.
	* sysdeps/arm/elf/start.S: Likewise.
	* sysdeps/cris/elf/start.S: Likewise.
	* sysdeps/hppa/elf/start.S: Likewise.
	* sysdeps/i386/elf/start.S: Likewise.
	* sysdeps/ia64/elf/start.S: Likewise.
	* sysdeps/m68k/elf/start.S: Likewise.
	* sysdeps/mach/hurd/powerpc/static-start.S: Likewise.
	* sysdeps/mips/elf/start.S: Likewise.
	* sysdeps/powerpc/powerpc32/elf/start.S: Likewise.
	* sysdeps/powerpc/powerpc64/elf/start.S: Likewise.
	* sysdeps/s390/s390-32/elf/start.S: Likewise.
	* sysdeps/s390/s390-64/elf/start.S: Likewise.
	* sysdeps/sh/elf/start.S: Likewise.
	* sysdeps/sparc/sparc32/elf/start.S: Likewise.
	* sysdeps/sparc/sparc64/elf/start.S: Likewise.
	* sysdeps/x86_64/elf/start.S: Likewise.

	* sysdeps/pthread/aio_notify.c (notify_func_wrapper): Take a malloc'd
	struct containing function ptr and value, free it.
	(__aio_notify_only): Allocate that and copy values from SIGEV into it.
	It's not safe to let the new thread use the SIGEV pointer.

2001-10-20  Paul Eggert  <eggert@twinsun.com>

	* misc/error.c (strerror_r): Do not declare unless [!_LIBC].
	Do not check for HAVE_DECL_STRERROR_R missing unless STRERROR_R_CHAR_P.
	Use strerror_r that is only a macro, even if it is not a function.
	(strerror): Check for HAVE_DECL_STRERROR before declaring.
	(private_strerror): Use prototypes, not old-style function definition.
	(print_errno_message): New function.
	Support the POSIX 'int'-flavored strerror_r, as well as the traditional
	char*-flavored one.
	(error_tail, error, error_at_line): Use it.

2002-12-07  Carlos O'Donell  <carlos@baldric.uwo.ca>

	* sysdeps/unix/sysv/linux/hppa/bits/shm.h: Added SHMLBA #define.

2002-12-08  Ulrich Drepper  <drepper@redhat.com>

	* scripts/output-format.sed: Fix bug in one of the s expressions
	which used / for one too many things.

	* include/unistd.h: Declare __libc_close.

2002-12-07  Ulrich Drepper  <drepper@redhat.com>

	* sysdeps/generic/bits/stdio-lock.h (_IO_lock_trylock): New define.

2002-12-07  Roland McGrath  <roland@redhat.com>

	* sysdeps/generic/libc-tls.c (__libc_setup_tls): Reintroduce changes
	from 2002-12-06, but remove unnecessary memset call without removing
	necessary copy of initialization image.

	* Makerules ($(common-objpfx)format.lds): New target.
	(common-generated): Add it.
	($(inst_libdir)/libc.so): Depend on that, and cat it into the result.
	* scripts/output-format.sed: New file.
	* Makefile (distribute): Add it.

2002-12-07  Ulrich Drepper  <drepper@redhat.com>

	* sysdeps/generic/libc-tls.c: Include <sys/param.h>.
	Reported by Art Haas <ahaas@airmail.net>.

2002-12-07  Kenneth W. Chen  <kenneth.w.chen@intel.com>

	* sysdeps/ia64/strncpy.S (strncpy): Clear ar.ec.  Fix .recovery4.

2002-12-07  Jakub Jelinek  <jakub@redhat.com>

	* string/test-strncpy.c (do_random_tests): Improve test coverage.

2002-12-06  Ulrich Drepper  <drepper@redhat.com>

	* test-skeleton.c (timeout_handler): Allow expected signal to be
	SIGALRM.

	* wctype/wcfuncs.c: Add libc_hidden_def for iswalnum.

	* sysdeps/posix/raise.c: Add libc_hidden_def for raise.

2002-12-07  Jakub Jelinek  <jakub@redhat.com>

	* sysdeps/unix/sysv/linux/sparc/sparc64/sysdep.h [RTLD_PRIVATE_ERRNO]
	(SYSCALL_ERROR_HANDLER): Fix a pasto.
	Reported by Jeff Bailey <jbailey@nisa.net>.

2002-12-06  Ulrich Drepper  <drepper@redhat.com>

	* sysdeps/generic/libc-tls.c: Undo last patch.

	* include/wctype.h: Define iswalnum with libc_hidden_proto.

	* include/signal.h: Define raise with libc_hidden_proto.

	* sysdeps/unix/sysv/linux/fexecve.c (fexecve): Use __snprintf and
	__execve instead of snprintf and execve.

	* sysdeps/x86_64/fpu/libm-test-ulps: Relax errors for float and double
	again a bit.

2002-12-06  Jakub Jelinek  <jakub@redhat.com>

	* posix/Makefile (annexc.out): Add -I../dir for all sorted-dirs.
	* posix/annexc.c (fmt, testfmt): Remove -D_LIBC.

2002-12-06  Ulrich Drepper  <drepper@redhat.com>

	* misc/syslog.c (log_cleanup): New function.
	(openlog): Use log_cleanup instead of __libc_mutex_unlock.
	(closelog): Likewise.

	* elf/dl-close.c: Use __rtld_lock_* macros instead of __libc_lock_*.
	* elf/dl-iteratephdr.c: Likewise.
	* elf/dl-lookup.c: Likewise.
	* elf/dl-misc.c: Likewise.
	* elf/dl-open.c: Likewise.
	* elf/dl-support.c: Likewise.
	* elf/rtld.c: Likewise.
	* sysdeps/generic/ldsodefs.h: Likewise.
	* sysdeps/generic/bits/libc-lock.h: Define __rtld_lock_* macros.
	* sysdeps/mach/bits/libc-lock.h: Likewise.
	* sysdeps/mach/hurd/bits/libc-lock.h: Likewise.

2002-12-06  Roland McGrath  <roland@redhat.com>

	* sysdeps/generic/libc-tls.c (__libc_setup_tls): Cope with zero ALIGN.

	* malloc/hooks.c [_LIBC && (USE___THREAD || (USE_TLS && !SHARED))]
	(malloc_starter, memalign_starter, free_starter): Don't define these.
	* malloc/malloc.c [_LIBC && (USE___THREAD || (USE_TLS && !SHARED))]:
	Don't declare them either.
	* malloc/arena.c (ptmalloc_init) [_LIBC && USE_TLS]: Don't call
	__pthread_initialize, so no need to set hooks to *_starter.
	(ptmalloc_init_minimal): New function, broken out of ptmalloc_init.
	[_LIBC && SHARED && USE_TLS && !USE___THREAD]
	(__libc_malloc_pthread_startup): New function.
	* malloc/Versions (libc: GLIBC_PRIVATE): New set, add that function.

	* malloc/hooks.c (memalign_starter): New function.
	* malloc/malloc.c: Declare it.
	* malloc/arena.c (save_memalign_hook): New variable.
	(ptmalloc_init): Set __memalign_hook to memalign_starter.

	* elf/dl-minimal.c (free): Clear the memory.
	(calloc): Just call malloc, knowing all memory it returns is cleared.

	* sysdeps/generic/dl-tls.c (allocate_dtv): Use calloc instead of
	malloc and memset; calloc can avoid the zeroing when redundant.
	(_dl_tls_setup): Likewise.
	* elf/dl-load.c (decompose_rpath): Likewise.
	* sysdeps/generic/libc-tls.c (__libc_setup_tls): Comment out memset
	call, since memory from sbrk at startup is already zero.

	* elf/rtld.c (_dl_start, dl_main): TLS_INIT_TP macro now returns an
	error string for failure, null for success.  Update callers.
	* sysdeps/generic/libc-tls.c (__libc_setup_tls): Likewise.
	* elf/dl-load.c (_dl_map_object_from_fd): Likewise.

2002-12-05  Jakub Jelinek  <jakub@redhat.com>

	* sysdeps/unix/sysv/linux/x86_64/syscalls.list (sendfile): Change
	args to i:iipi.
	(readahead): Change args to i:iii.
	* sysdeps/unix/sysv/linux/powerpc/powerpc64/syscalls.list (readahead):
	Change args to i:iii.
	* sysdeps/unix/sysv/linux/mips/syscalls.list (readahead): Change
	args to i:iiii.

2002-12-05  Roland McGrath  <roland@redhat.com>

	* stdlib/cxa_finalize.c (__cxa_finalize): When given a null argument,
	call all functions rather than none.
	Reported by Mark P. Mitchell <mark@codesourcery.com>.

2002-12-04  Roland McGrath  <roland@redhat.com>

	* locale/localeinfo.h [NL_CURRENT_INDIRECT]: Use attribute_tls_model_ie
	on _nl_current_LC_* variables.

2002-12-05  Ulrich Drepper  <drepper@redhat.com>

	* dirent/bug-readdir1.c (main): Don't call closedir, just close
	the file descriptor.  This is testing what the bug report was about.

2002-12-04  Ulrich Drepper  <drepper@redhat.com>

	* po/be.po: New file.

	* argp/Makefile (tests): Add tst-argp1.

	* sysdeps/unix/sysv/linux/alpha/bits/siginfo.h: (struct sigevent):
	Change type of _attribute to void*.
	* sysdeps/unix/sysv/linux/ia64/bits/siginfo.h: Likewise.
	* sysdeps/unix/sysv/linux/bits/siginfo.h: Likewise.
	* sysdeps/unix/sysv/linux/mips/bits/siginfo.h: Likewise.
	* sysdeps/unix/sysv/linux/sparc/bits/siginfo.h: Likewise.
	* sysdeps/unix/sysv/linux/s390/bits/siginfo.h: Likewise.

2002-12-04  Roland McGrath  <roland@redhat.com>

	* sysdeps/generic/ldsodefs.h (struct rtld_global): Move all [USE_TLS]
	members to the end, so a libpthread compiled with !USE_TLS will still
	find other members properly.

	* sysdeps/i386/i486/bits/string.h (__strcpy_g): Add dummy output
	operand for DEST memory.  Fix dummy input operand to use SRC.
	Reported by Davin McCall <davmac@ozonline.com.au>.

	* sysdeps/generic/libc-tls.c (__libc_setup_tls): Account for TCB
	alignment when initializing the DTV entry.

	* elf/dl-load.c (_dl_map_object_from_fd): If we hit a TLS segment
	when TLS has not been set up, try to set it up if we can.
	* elf/tst-tls4.c: Revert last change.
	* elf/tst-tls5.c: Likewise.
	* elf/tst-tls6.c: Likewise.
	* elf/tst-tls7.c: Likewise.
	* elf/tst-tls8.c: Likewise.
	* elf/tst-tls9.c: Likewise.

	* sysdeps/generic/dl-tls.c [SHARED] (_dl_tls_setup): New function.
	* sysdeps/generic/ldsodefs.h: Declare it.
	* elf/Versions (ld: GLIBC_PRIVATE): Add it.
	* sysdeps/generic/libc-tls.c (init_slotinfo): New static inline
	function, broken out of __libc_setup_tls.
	(init_static_tls): Likewise.
	(__libc_setup_tls): Call them.
	(_dl_tls_setup): New function, uses new subroutines.

	* elf/dl-close.c (free_slotinfo): Make argument pointer to pointer.
	Clear the pointer when returning true.
	(libc_freeres_fn) [SHARED]: If GL(dl_initial_dtv) is null, free the
	first element of the slotinfo list too.

	* sysdeps/generic/dl-tls.c (_dl_determine_tlsoffset): Define only if
	[SHARED].

	* sysdeps/generic/ldsodefs.h (_dl_next_tls_modid): Declare as hidden.
	(_dl_determine_tlsoffset): Likewise.

	* elf/rtld.c (_dl_initial_error_catch_tsd): Renamed from
	startup_error_tsd, made global.
	(dl_main): Update initialization.
	* elf/dl-tsd.c: Likewise.
	* sysdeps/generic/ldsodefs.h: Declare it.

2002-12-03  Ulrich Drepper  <drepper@redhat.com>

	* manual/texinfo.tex: Update from latest upstream version.

2002-12-03  Roland McGrath  <roland@redhat.com>

	* sysdeps/generic/libc-tls.c (__libc_setup_tls): Include static TLS
	area surplus in calculation for sbrk call.

	* iconvdata/cp1125.c: New file.
	* iconvdata/Makefile (distribute): Add it.
	(modules): Add CP1125.
	(gen-8bit-gap-modules): Add cp1125.
	* iconvdata/gconv-modules: Add CP1125, alias RUSCII.
	* iconvdata/tst-tables.sh: Add CP1125 to the list to test.

2002-12-03  Andreas Jaeger  <aj@suse.de>

	* sysdeps/x86_64/fpu/libm-test-ulps: Regenerated.

2002-12-03  Ulrich Drepper  <drepper@redhat.com>

	* sysdeps/posix/system.c (do_system): Make signal handler
	installation thread safe.

2002-12-02  Roland McGrath  <roland@redhat.com>

	* sysdeps/unix/sysv/linux/alpha/syscalls.list (readahead): Change
	caller from EXTRA to -.
	* sysdeps/unix/sysv/linux/x86_64/syscalls.list: Likewise.
	* sysdeps/unix/sysv/linux/sparc/sparc64/syscalls.list: Likewise.
	* sysdeps/unix/sysv/linux/ia64/syscalls.list: Likewise.

2002-12-02  Carlos O'Donell  <carlos@baldric.uwo.ca>

	* sysdeps/hppa/fpu/fesetround.c (fesetround): Use ~FE_DOWNWARD so both
	bits of RM are cleared.

2002-12-02  Roland McGrath  <roland@redhat.com>

	* elf/tst-tls4.c: Define an unused TLS variable here, so that no lazy
	TLS setup is required.
	* elf/tst-tls5.c: Likewise.
	* elf/tst-tls6.c: Likewise.
	* elf/tst-tls7.c: Likewise.
	* elf/tst-tls8.c: Likewise.
	* elf/tst-tls9.c: Likewise.

	* elf/rtld.c (dl_main): Remove [! SHARED] conditional from
	`if (GL(dl_tls_max_dtv_idx) > 0)' tests for doing TLS setup.
	* elf/dl-close.c (libc_freeres_fn): Check GL(dl_tls_dtv_slotinfo_list)
	for being null before calling free_slotinfo.
	* elf/dl-load.c (_dl_map_object_from_fd) [SHARED]: For PT_TLS in
	dynamic loading, bail with error if GL(dl_tls_max_dtv_idx) is zero.

2002-11-30  Bruno Haible  <bruno@clisp.org>

	* iconv/gconv.h (__gconv_btowc_fct): New typedef.
	(struct __gconv_step): New field __btowc_fct.
	* wcsmbs/btowc.c (__btowc): Use the __btowc_fct shortcut if possible.
	* iconv/gconv_int.h (__BUILTIN_TRANSFORM): Renamed from
	__BUILTIN_TRANS.
	(__gconv_btwoc_ascii): New declaration.
	* iconv/gconv_simple.c (BUILTIN_TRANSFORMATION): Add BtowcFct argument.
	(__gconv_btwoc_ascii): New function.
	* iconv/gconv_builtin.h: Add BtowcFct argument to all
	BUILTIN_TRANSFORMATION invocations.
	* iconv/gconv_conf.c (BUILTIN_TRANSFORMATION): Add BtowcFct argument.
	* iconv/iconvconfig.c (BUILTIN_TRANSFORMATION): Likewise.
	* iconv/gconv_builtin.c (map): New field btowc_fct.
	(BUILTIN_TRANSFORMATION): Add BtowcFct argument. Use it to initialize
	btowc_fct field.
	(__gconv_get_builtin_trans): Initialize __btowc_fct field.
	* iconv/gconv_cache.c (find_module): Initialize __btowc_fct field.
	* iconv/gconv_db.c (gen_steps, increment_counter): Likewise.
	* wcsmbs/wcsmbsload.c (to_wc, to_mb): Likewise.
	* iconv/skeleton.c: Document STORE_REST and FROM_ONEBYTE.
	(gconv_init): Initialize __btowc_fct field.
	Undefine EXTRA_LOOP_ARGS and FROM_ONEBYTE at the end.
	* iconv/loop.c: Document ONEBYTE_BODY.
	(gconv_btowc, FROM_ONEBYTE): Define if ONEBYTE_BODY is defined.
	Undefine ONEBYTE_BODY at the end.
	* iconvdata/8bit-generic.c (ONEBYTE_BODY): New macro.
	* iconvdata/8bit-gap.c (NONNUL): New macro.
	(BODY for FROM_LOOP): Use it.
	(ONEBYTE_BODY): New macro.
	* iconvdata/isiri-3342.c (HAS_HOLES): Set to 1.
	(NONNUL): New macro.
	* iconvdata/ansi_x3.110.c (ONEBYTE_BODY): New macro.
	* iconvdata/armscii-8.c (ONEBYTE_BODY): New macro.
	* iconvdata/cp1255.c (ONEBYTE_BODY): New macro.
	* iconvdata/cp1258.c (ONEBYTE_BODY): New macro.
	* iconvdata/tcvn5712-1.c (ONEBYTE_BODY): New macro.
	* iconvdata/big5.c (ONEBYTE_BODY): New macro.
	* iconvdata/big5hkscs.c (ONEBYTE_BODY): New macro.
	* iconvdata/euc-cn.c (ONEBYTE_BODY): New macro.
	* iconvdata/euc-jp.c (ONEBYTE_BODY): New macro.
	* iconvdata/euc-jisx0213.c (ONEBYTE_BODY): New macro.
	* iconvdata/euc-kr.c (ONEBYTE_BODY): New macro.
	* iconvdata/euc-tw.c (ONEBYTE_BODY): New macro.
	* iconvdata/gbk.c (ONEBYTE_BODY): New macro.
	* iconvdata/gb18030.c (ONEBYTE_BODY): New macro.
	* iconvdata/ibm932.c: Include <stdbool.h>.
	(TRUE, FALSE): Remove macros.
	(BODY for FROM_LOOP): Remove unused variable rp1.
	(ONEBYTE_BODY): New macro.
	(BODY for TO_LOOP): Use bool.
	* iconvdata/ibm932.h (__ibm932sb_to_ucs4_idx): Remove array.
	* iconvdata/ibm943.c: Include <stdbool.h>.
	(TRUE, FALSE): Remove macros.
	(BODY for FROM_LOOP): Remove unused variable rp1.
	(ONEBYTE_BODY): New macro.
	(BODY for TO_LOOP): Use bool.
	* iconvdata/ibm943.h (__ibm943sb_to_ucs4_idx): Remove array.
	* iconvdata/iso8859-1.c (ONEBYTE_BODY): New macro.
	* iconvdata/iso_6937-2.c (ONEBYTE_BODY): New macro.
	* iconvdata/iso_6937.c (ONEBYTE_BODY): New macro.
	* iconvdata/johab.c (ONEBYTE_BODY): New macro.
	* iconvdata/sjis.c (ONEBYTE_BODY): New macro.
	* iconvdata/shift_jisx0213.c (ONEBYTE_BODY): New macro.
	* iconvdata/t.61.c (ONEBYTE_BODY): New macro.
	* iconvdata/uhc.c (ONEBYTE_BODY): New macro.
	* iconvdata/gbbig5.c: Tweak comment.

2002-12-02  Ulrich Drepper  <drepper@redhat.com>

	* po/fi.po: Update from translation team.

2002-12-01  Roland McGrath  <roland@redhat.com>

	* sysdeps/unix/sysv/linux/getdents.c (__GETDENTS): Fix condition
	testing getdents64 return value.

	* scripts/versions.awk: Don't pass -n flag to sort command.

	* posix/bug-regex13.c: Include <string.h>.

	* sysdeps/generic/libc-start.c (__libc_start_main): Do
	DL_SYSDEP_OSCHECK here.
	* sysdeps/unix/sysv/linux/init-first.c (init): Not here.
	* sysdeps/unix/sysv/linux/dl-osinfo.h: Include <fcntl.h>.

	* sysdeps/generic/libc-tls.c (__libc_setup_tls): Bail if
	argument TCBSIZE <= TLS_INIT_TCB_SIZE, not just if it's zero.

	* sysdeps/generic/dl-tls.c (_dl_allocate_tls_init): Check l_tls_offset
	instead of l_type to decide whether to use TLS_DTV_UNALLOCATED.

	* include/link.h: Comment typo fix.

2002-12-01  Roland McGrath  <roland@frob.com>

	* sysdeps/mach/hurd/bits/posix_opt.h (_POSIX_FSYNC): Set to 200112L.
	(_POSIX_SPAWN, _POSIX_MAPPED_FILES, _POSIX_MEMLOCK_RANGE,
	_POSIX_MEMORY_PROTECTION): Likewise.
	(_POSIX_POLL, _POSIX_SELECT): Removed.

2002-11-28  Ulrich Drepper  <drepper@redhat.com>

	* sysdeps/unix/sysv/linux/bits/posix_opt.h: Define macros which
	require it to 200112L.  Remove _POSIX_POLL and _POSIX_SELECT.

2002-11-28  Jakub Jelinek  <jakub@redhat.com>

	* sysdeps/unix/alpha/sysdep.S: Change defined(USE___THREAD) to
	USE___THREAD.
	* sysdeps/unix/sysv/linux/alpha/sysdep.h (inline_syscall*): Avoid
	"=v" constraints.

2002-11-28  Ulrich Drepper  <drepper@redhat.com>

	* sysdeps/unix/sysv/linux/x86_64/vfork.S: Don't trash the CPU's
	branch prediction buffers by using unpaired call/ret.

2002-11-27  Ulrich Drepper  <drepper@redhat.com>

	* sysdeps/unix/sysv/linux/i386/sysdep.h (ASMFMT_2): Fix typo in
	first parameters constraint string.
	(ASMFMT_3): Likewise.  Patch by stefan.lauterbach@mincom.de.

2002-11-27  Isamu Hasegawa  <isamu@yamato.ibm.com>

	* posix/regcomp.c (parse_expression): Set the bit since the back
	reference is used in the regular expression.
	* posix/regex_internal.c (re_node_set_init_1): Make it clean in case
	of malloc failure.
	(re_node_set_init_copy): Likewise.
	* posix/regex_internal.h (state_array_t): New structure.
	(re_sub_match_last_t): Likewise.
	(re_sub_match_top_t): Likewise.
	(re_match_context_t): Add new members.
	(re_dfa_t): Likewise.
	* posix/regexec.c (re_search_internal): Invoke prune_impossible_nodes
	to check the matching is really correct, and retry if failed.
	Move the routin pruning the impossible nodes from here, ...
	(prune_impossible_nodes): To this function.
	(check_matching): Invoke check_subexp_matching_top, and replace
	redundant checking with transit_state_bkref invocation.
	(proceed_next_node): Replace strncmp with memcmp.  Reported by
	Paolo Bonzini  <bonzini@gnu.org>.
	(update_cur_sifted_state): Remove search_subexp invocation.
	(search_subexp): Remove this function.
	(check_dst_limits_calc_pos): Use search_cur_bkref_entry for
	optimization.
	(sift_states_bkref): Use search_cur_bkref_entry for optimization.
	Remove unused invocation of match_ctx_add_entry.
	(transit_state): Invoke check_subexp_matching_top.
	(check_subexp_matching_top): New function.
	(transit_state_bkref): Remove unused array.
	Merge transit_state_bkref_loop.
	(transit_state_bkref_loop): Use get_subexp instead of
	sift_states_backward.  Use search_cur_bkref_entry for optimization.
	Merge this function to transit_state_bkref.
	(get_subexp): New function.
	(get_subexp_sub): Likewise.
	(find_subexp_node): Likewise.
	(check_arrival): Likewise.
	(check_arrival_expand_ecl): Likewise.
	(check_arrival_expand_ecl_sub): Likewise.
	(expand_bkref_cache): Likewise.
	(match_ctx_init): Initialize new members.
	(match_ctx_clean): New function.
	(match_ctx_free): Release new members.
	(match_ctx_free_subtops): New function.
	(match_ctx_add_entry): Fix indent.
	(search_cur_bkref_entry): New function.
	(match_ctx_add_subtop): Likewise.
	(match_ctx_add_sublast): Likewise.

2002-11-25  Ulrich Drepper  <drepper@redhat.com>

	* iconv/Makefile (tests): Remove tst-iconv4.c
	* iconv/tst-iconv4.c: Moved to...
	* iconvdata/tst-iconv4.c: ...here.  New file.
	* iconvdata/Makefile (tests): Add tst-iconv4.  Add dependencies.

2002-11-25  Roland McGrath  <roland@redhat.com>

	* inet/test-ifaddrs.c (main: addr_string): Handle null SA.
	Grok AF_LINK if defined.
	From Momchil Velikov <velco@fadata.bg>.

	* sysdeps/gnu/ifaddrs.c (getifaddrs): If ioctl fails for netmask,
	brdaddr, or dstaddr, just set those pointers to null and don't fail.
	Reported by Momchil Velikov <velco@fadata.bg>.

	* sysdeps/generic/ifreq.h (__if_nextreq) [_HAVE_SA_LEN]: If sa_len
	is > sizeof IFR->ifa_addr, advance past the whole longer length.
	(__ifreq): Count up NIFS that way too.
	Reported by Momchil Velikov <velco@fadata.bg>.

	* sysdeps/mach/hurd/lchmod.c: Include <fcntl.h>.

	* sysdeps/mach/hurd/i386/init-first.c: Include <ldsodefs.h>
	and <fpu_control.h>.

2002-11-24  Ulrich Drepper  <drepper@redhat.com>

	* elf/elf.h (EM_ST19): Fix typo.

2002-11-25  Jakub Jelinek  <jakub@redhat.com>

	* include/errno.h (__set_errno): Define as errno = val
	unconditionally.

2002-11-24  Roland McGrath  <roland@redhat.com>

	* sysdeps/posix/readv.c: Include <errno.h>, use __set_errno macro.
	* sysdeps/posix/writev.c: Likewise.
	From Momchil Velikov <velco@fadata.bg>.

	* elf/dl-error.c [! _LIBC_REENTRANT]: Use a static variable instead of
	calling *GL(dl_error_catch_tsd) for a thread-local location.
	* elf/rtld.c (startup_error_tsd): Conditionalize on [_LIBC_REENTRANT].
	(dl_main): Same for GL(dl_error_catch_tsd) initialization.
	* elf/dl-tsd.c: Conditionalize contents on [_LIBC_REENTRANT].

	* libio/iofflush.c: Add libc_hidden_def.
	* libio/iofwrite.c: Likewise.
	* sysdeps/generic/sigtimedwait.c: Likewise.
	* sysdeps/generic/sigwaitinfo.c: Likewise.
	* sysdeps/posix/sigwait.c: Likewise.
	Reported by Momchil Velikov <velco@fadata.bg>.

	* inet/inet_lnaof.c (inet_lnaof): Change return type to in_addr_t
	to match <arpa/inet.h> declaration.
	* inet/inet_netof.c (inet_netof): Likewise.
	* inet/inet_mkadr.c (inet_makeaddr): Likewise for argument types.
	Reported by Momchil Velikov <velco@fadata.bg>.

	* configure.in: Skip AUTOCONF check under --without-cvs.
	* configure: Regenerated.

	* posix/Makefile (headers): Add bits/pthreadtypes.h.
	* sysdeps/unix/sysv/linux/Makefile (sysdep_heaers): Don't add it here.
	* sysdeps/unix/sysv/linux/Dist: Remove it from the list.

2002-11-24  Andreas Schwab  <schwab@suse.de>

	* sysdeps/unix/sysv/linux/m68k/sysdep.h: Support inline syscall
	with six arguments.

2002-11-19  Jim Meyering  <jim@meyering.net>

	* time/mktime.c (__mon_yday, __mktime_internal) [!_LIBC]: Declare
	as `static'.
	* time/strptime.c (__mon_yday) [!_LIBC]: Declare as `static'.

2002-11-23  Roland McGrath  <roland@redhat.com>

	* scripts/abilist.awk: Avoid strtonum function, not there in mawk.
	Just produce hex output for datum sizes.

	* elf/Makefile ($(objpfx)librtld.mk): Tighten up regexp.
	Reported by Luca Barbieri <ldb@ldb.ods.org>.

2002-11-20  Steven Munroe  <sjmunroe@us.ibm.com>

	* sysdeps/unix/sysv/linux/powerpc/bits/msq.h (msqid_ds)
	[__WORDSIZE == 32]: Only PPC32 requires __unused1, __unused2,
	and __unused3 fields.
	* sysdeps/unix/sysv/linux/powerpc/bits/sem.h (semid_ds)
	[__WORDSIZE == 32]: Only PPC32 requires __unused1
	and __unused2 fields.
	* sysdeps/unix/sysv/linux/powerpc/bits/shm.h (shmid_ds)
	[__WORDSIZE == 32]: Only PPC32 requires __unused1, __unused2,
	__unused3, and __unused4 fields.

	* csu/gmon-start.c (__gmon_start__): Always use TEXT_START macro to
	obtain lowest address for profiling in __monstartup call.

2002-11-21  Roland McGrath  <roland@redhat.com>

	* sysdeps/ia64/fpu/Makefile (libm-sysdep_routines): Remove redunant
	$(calls) $(calls:=f) $(long-c-$(long-double-fcts)).

	* locale/localeinfo.h (struct locale_data): Revert last change.

	* sysdeps/unix/sysv/linux/ia64/syscalls.list (s_exit_group): Add it.
	From Ian Wienand <ianw@gelato.unsw.edu.au>.

	* sysdeps/unix/sysv/linux/ia64/sysdep.h (__NR_pread): Define to
	__NR_pread64 if not defined.
	(__NR_pwrite): Define to __NR_pwrite64 if not defined.
	From Ian Wienand <ianw@gelato.unsw.edu.au>.

2002-11-21  Roland McGrath  <roland@frob.com>

	* sysdeps/mach/hurd/i386/init-first.c (posixland_init): Set
	__libc_multiple_libcs here.  Call __setfpucw.

2002-11-21  Ulrich Drepper  <drepper@redhat.com>

	* elf/Makefile (tests): Don't run test-arrayX tests for now.

	* sysdeps/unix/sysv/linux/bits/sched.h: Add new CLONE_* flags.
	* sysdeps/unix/sysv/linux/i386/clone.S: Add support for
	CLONE_CHILD_*TID flags.

2002-11-20  Andreas Jaeger  <aj@suse.de>

	* sysdeps/unix/sysv/linux/x86_64/sigcontextinfo.h (SIGCONTEXT):
	We pass struct ucontext on x86-64.
	(GET_PC): Adjust.
	(GET_FRAME): Adjust.
	(GET_STACK): Adjust.

2002-11-20  Roland McGrath  <roland@redhat.com>

	* sysdeps/powerpc/powerpc32/dl-machine.c [! SHARED]: Further
	conditionalize [! DO_VERSIONING] #error.

	* scripts/abilist.awk: Grok function descriptor symbols.

	* intl/tst-gettext.c (main): Check return values from setlocale.
	Add necessary unsetenv's to make LANG=existing-locale check work.

	* intl/tst-gettext.sh: Use mkdir -p.  Copy test files unconditionally,
	so aborted prior runs don't confuse things.

	* locale/localeinfo.h (struct locale_data: union locale_data_value):
	Use uintptr_t instead of unsigned int for `word' member.
	(_NL_CURRENT_WORD): Cast to uint32_t.

	* posix/bug-regex5.c (main): Use union to extract _NL_COLLATE_NRULES
	value.

2002-11-20  Ulrich Drepper  <drepper@redhat.com>

	* elf/tls-macros.h: Add IA-64 definitions.
	Patch by Ian Wienand <ianw@gelato.unsw.edu.au>.

	* iconv/Makefile (tests): Add tst-iconv4.
	* iconv/tst-iconv4.c: New file.

	* iconv/gconv_simple.c (internal_ucs4le_loop_unaligned): Return
	__GCONV_EMPTY_INPUT only if input is really empty.  Otherwise
	__GCONV_INCOMPLETE_INPUT.
	(ucs4le_internal_loop): Likewise.
	(ucs4le_internal_loop_unaligned): Likewise.
	* iconvdata/unicode.c (PREPARE_LOOP): Likewise.
	* iconvdata/utf-16.c (PREPARE_LOOP): Likewise.
	* iconvdata/utf-32.c (PREPARE_LOOP): Likewise.

	* iconv/loop.c (LOOPFCT): First test for empty input then for full
	output buffer.

	* inet/getnameinfo.c: Use extend_alloca where appropriate.
	* sysdeps/posix/getaddrinfo.c: Likewise.

	* include/alloca.h (extend_alloca): New define.  Based on stack
	direction it'll try to append to the previouls allocated buffer.

2002-11-07  Thorsten Kukuk  <kukuk@suse.de>

	* sysdeps/posix/getaddrinfo.c (gaih_inet): If AF_UNSPEC is set,
	use the same service for AF_INET and AF_INET6.

2002-11-19  Ulrich Drepper  <drepper@redhat.com>

	* intl/localealias.c (read_alias_file): Use only about 400 bytes
	of stack space instead of 16k.

2002-11-18  Wolfram Gloger  <wg@malloc.de>

	* malloc/arena.c
	(ptmalloc_lock_all, ptmalloc_unlock_all, ptmalloc_unlock_all2): Do
	nothing if not initialized.  Bug report from Marcus Brinkmann
	<Marcus.Brinkmann@ruhr-uni-bochum.de>.

2002-11-19  Roland McGrath  <roland@redhat.com>

	* posix/Versions (libc: GLIBC_2.3.2): Add sched_getaffinity and
	sched_setaffinity.

	* configure.in (libc_cv_gcc_dwarf2_unwind_info check): Use libraries
	`-lgcc -lgcc_eh -lgcc', not just `-lgcc -lgcc_eh' in link commands for
	test leading to libc_cv_gcc_dwarf2_unwind_info=no_registry_needed.
	* configure: Regenerated.

2002-11-19  Ulrich Drepper  <drepper@redhat.com>

	* include/dlfcn.h: __libc_dlopen is now a macro calling
	__libc_dlopen_mode with the extra parameter RTLD_LAZY.
	(__libc_dlopen_mode): New prototype.
	* elf/dl-libc.c (__libc_dlopen_mode): Renamed from __libc_dlopen.  Add
	new parameter.  Store new parameter in mode field of structure passed
	to do_dlopen.
	(struct do_dlopen_args): Add new field mode.
	(do_dlopen): Pass mode from parameter structure to _dl_open.

2002-11-11  Randolf Chung  <tausq@debian.org>

	* sysdeps/unix/sysv/linux/hppa/bits/fcntl.h [__USE_FILE_OFFSET64]
	(F_GETLK, F_SETLK, F_SETLKW): Define to F_*64 versions.
	* sysdeps/unix/sysv/linux/hppa/fcntl.c: New file.

	* sysdeps/hppa/fpu/libm-test-ulps: New file (generated).

	* sysdeps/hppa/Makefile (CFLAGS-rtld.c): New variable.
	Set -mdisable-fpregs for this file.

2002-11-11  Carlos O'Donell  <carlos@baldric.uwo.ca>

	* sysdeps/unix/sysv/linux/configure.in:
	Make 2.4.19 minimum linux kernel for hppa, and add unwind symbols
	from gcc-3.0 era for backwards compatibility.
	* sysdeps/unix/sysv/linux/configure: Regenerate.

	* sysdeps/unix/sysv/linux/hppa/sys/ucontext.h:
	Define mcontext_t as a sigcontext.

2002-11-18  Roland McGrath  <roland@redhat.com>

	* dlfcn/dlerror.c (fini): New function, __attribute__ ((destructor)).
	Free memory in `last_result' if it was used.

	* resolv/nss_dns/dns-network.c (getanswer_r): In BYNAME case, search
	all aliases for one that matches the "<dotted-quad>.IN-ADDR.ARPA" form.
	Do the parsing inline instead of copying strings and calling
	inet_network, and properly skip all alias names not matching the form.

	* manual/pattern.texi (Variable Substitution): Fix # and ## examples.

2002-11-17  Ulrich Drepper  <drepper@redhat.com>

	* manual/pattern.texi (Wordexp Example): Fix sample code.

	* sysdeps/unix/sysv/linux/i386/clone.S: Initialize word in the
	childs stack which will be loaded into the %esi register.

2002-11-14  Paul Eggert  <eggert@twinsun.com>

	* resolv/nss_dns/dns-network.c (getanswer_r): Check for buffer
	overflow when skipping the question part and when unpacking aliases.

2002-11-15  Roland McGrath  <roland@redhat.com>

	* math/Makefile (libm-calls): Remove s_copysign, s_isinf, s_isnan,
	s_finite, s_modf, s_scalbn, s_frexp, m_ldexp, s_signbit.
	Instead add $(calls:s_%=m_%) to get m_* versions of them all.

2002-11-15  Jakub Jelinek  <jakub@redhat.com>

	* sysdeps/i386/dl-machine.h (elf_machine_rela): Handle R_386_COPY.
	* sysdeps/arm/dl-machine.h (elf_machine_rela): Handle R_ARM_COPY.

2002-11-15  Roland McGrath  <roland@redhat.com>

	* math/Makefile (libm-calls): Change s_ldexp to m_ldexp.
	* Makerules ($(+sysdir_pfx)sysd-rules): Emit pattern rules for m_%.[Sc]
	from sysdeps/.../s_%.[Sc] with commands $(+make-include-of-dep).
	(+make-include-of-dep): New canned sequence.

	* stdlib/canonicalize.c (__realpath): Check for malloc failure.
	From Dmitry V. Levin <ldv@altlinux.org>.

2002-11-14  Roland McGrath  <roland@redhat.com>

	* sysdeps/generic/errno.c (__libc_errno): Remove alias.
	* inet/herrno.c (__libc_h_errno): Likewise.
	* resolv/res_libc.c (__libc_res): Likewise.
	[USE___THREAD]: Use this in place of [USE_TLS && HAVE___THREAD].
	(__res_state) [! USE___THREAD]: Don't define as weak.
	* csu/Versions: Revert last change.
	* resolv/Versions: Revert last change.

	* Makerules ($(common-objpfx)%.make): New pattern rule.
	* tls.make.c: New file.
	* Makefile (distribute): Add it.

	* sysdeps/generic/errno.c [! USE___THREAD]
	[HAVE_ELF && SHARED && DO_VERSIONING] (errno, _errno): Declare these
	with compat_symbol so they are not link-time visible.
	[! USE___THREAD] (__libc_errno): New alias for errno.
	* csu/Versions [!(USE_TLS && HAVE___THREAD)] (libc: GLIBC_PRIVATE):
	Add __libc_errno here.
	* inet/herrno.c [USE___THREAD]: Use this conditional
	in place of [USE_TLS && HAVE___THREAD].
	[! USE___THREAD] [HAVE_ELF && SHARED && DO_VERSIONING]
	(h_errno, _h_errno): Declare these with compat_symbol so they are not
	link-time visible.
	[! USE___THREAD] (__libc_h_errno): New alias for h_errno.
	* resolv/res_libc.c [! USE___THREAD]
	[HAVE_ELF && SHARED && DO_VERSIONING] (_res): Likewise.
	(_res): Use __attribute__ ((section (".bss"))) so we can have an alias.
	(__libc_res): Define as alias for _res.
	* resolv/Versions [!(USE_TLS && HAVE___THREAD)] (libc: GLIBC_PRIVATE):
	Add __libc_h_errno and __libc_res here.

2002-11-14  Jakub Jelinek  <jakub@redhat.com>

	* csu/Versions (errno): Move STT_TLS symbol to GLIBC_PRIVATE for now.
	* resolv/Versions (h_errno, _res): Likewise.

2002-11-14  Roland McGrath  <roland@redhat.com>

	* Makerules (%.dynsym): Remove $(objpfx) from target and dep.
	(%.symlist): Likewise.

2002-11-13  Roland McGrath  <roland@redhat.com>

	* scripts/abilist.awk: New file.
	* Makefile (distribute): Add it.
	* Makerules ($(objpfx)%.dynsym, $(objpfx)%.symlist): New rules.
	(tests): Depend on .symlist file for each $(install-lib.so-versioned).
	[$(subdir) = elf] (tests): Depend on libc.symlist.
	(generated, common-generated): Add those files.

	* aclocal.m4 (LIBC_PROG_BINUTILS): Check for objdump, set OBJDUMP.
	* configure: Regenerated.
	* config.make.in (OBJDUMP): New variable, substituted by configure.

	* malloc/mcheck.c (struct hdr): New members `block' and `magic2'.
	(mallochook, reallochook): Set them up.
	(checkhdr): Check HDR->magic2 value.
	(freehook): Reset HDR->magic2.
	(memalignhook): New static function.
	(old_memalign_hook): New static variable.
	(mcheck, reallochook): Set __memalign_hook to memalignhook.

	* sysdeps/generic/dl-tls.c (_dl_allocate_tls_storage): Zero the space
	for the new TCB.

2002-11-13  Andreas Jaeger  <aj@suse.de>

	* sysdeps/unix/sysv/linux/x86_64/sigaction.c: Check for visibility
	attribute.
	* sysdeps/unix/sysv/linux/i386/sigaction.c: Likewise.

2002-11-11  Paul Eggert  <eggert@twinsun.com>

	* manual/crypt.texi (Cryptographic Functions): Mention that
	the MD5 one-way algorithm is compatible with BSD's.

2002-11-11  Isamu Hasegawa  <isamu@yamato.ibm.com>

	* posix/regex_internal.c (re_string_skip_chars): Also return the last
	wide character.
	(re_string_reconstruct): Calculate the context by itself when the
	offset points out of the valid range.
	(re_string_context_at): Use wide character when MB_CUR_MAX > 1.
	* posix/regex_internal.h (WIDE_NEWLINE_CHAR): New macro.
	(IS_WIDE_WORD_CHAR): New macro.
	(IS_WIDE_NEWLINE): New macro.

2002-11-12  Andreas Jaeger  <aj@suse.de>

	* sysdeps/x86_64/strchr.S: Don't use one register for two
	purposes, this fixes a bug noticed by test-strchr.c.

	* sysdeps/x86_64/strcat.S: Fix algorithm to align source pointer
	correctly.

2002-11-12  Roland McGrath  <roland@redhat.com>

	* libio/libioP.h [_LIBC && !SHLIB_COMPAT (libc, GLIBC_2_0, GLIBC_2_1)]
	(_G_IO_NO_BACKWARD_COMPAT): Define it.

	* sysdeps/ia64/dl-fptr.c [_LIBC_REENTRANT]: Include <ia64intrin.h>
	instead of <pt-machine.h>.
	[_LIBC_REENTRANT] (lock, unlock): Use __sync_lock_* macros instead of
	testandset.
	From Ian Wienand <ianw@gelato.unsw.edu.au>.

2002-11-10  Roland McGrath  <roland@redhat.com>

	* libio/bug-wfflush.c (do_test): Call rewind instead of fsetpos.
	Call fputs instead of fwprintf (simpler to follow in debugger).

	* crypt/md5-crypt.c: Doc fix.

	* sysdeps/unix/make-syscalls.sh: Insert $(make-target-directory) at
	the beginning of generated target commands.

	* csu/Makefile ($(objpfx)crti.o, $(objpfx)crtn.o): Add explicit
	dependencies for these in case implicit rule search skipped the
	nonexistent source directory.
	* sysdeps/gnu/Makefile ($(objpfx)errlist.d): Give this rule all the
	files with $(object-suffixes) as targets too.
	* Makerules [no_deps && objpfx] (before-compile): Add $(objpfx).
	and a target for it using $(make-target-directory).

	* Rules (before-compile): Add $(common-objpfx)bits/stdio-lim.h.

2002-11-10  Roland McGrath  <roland@frob.com>

	* sysdeps/unix/sysv/linux/bits/pthreadtypes.h: Moved to ...
	* sysdeps/generic/bits/pthreadtypes.h: ... here.

	* sysdeps/mach/hurd/fcntl.c (__libc_fcntl): Treat a struct flock with
	l_start == 0 and l_len == 1 as we do l_len == 0.

2002-11-10  Ulrich Drepper  <drepper@redhat.com>

	* po/da.po: Update from translation team.

2002-11-10  Roland McGrath  <roland@redhat.com>

	* config.make.in (includedir): New variable, substituted by configure.
	Reported missing by Jocelyn Fournier <joc@presence-pc.com>.
	* Makeconfig (includedir): Use $(prefix), not $(exec_prefix).

2002-11-10  Andreas Jaeger  <aj@suse.de>

	* sysdeps/unix/sysv/linux/x86_64/sys/ucontext.h (enum): Add
	REG_OLDMASK and REG_CR2 to synch with kernel header.
	(NGREG): Increase.

	* nss/getXXent.c (GETFUNC_NAME): Use union type to avoid strict
	aliasing problem.
	* nss/getXXbyYY_r.c (INTERNAL): Likewise.
	* nss/getnssent_r.c (__nss_getent_r): Likewise.
	(__nss_setent): Likewise.
	(__nss_getent_r): Likewise.
	* inet/getnetgrent_r.c (innetgr): Likewise.
	(__internal_setnetgrent_reuse): Likewise.
	(internal_getnetgrent_r): Likewise.
	* inet/ether_hton.c (ether_hostton): Likewise.
	* inet/ether_ntoh.c (ether_ntohost): Likewise.
	* sunrpc/netname.c (netname2user): Likewise.
	* sunrpc/publickey.c (getpublickey): Likewise.
	(getsecretkey): Likewise.

2002-11-09  Marcus Brinkmann  <marcus@gnu.org>

	* sysdeps/mach/hurd/i386/ioperm.c (ioperm): Correct off by one
	error in range calculation.

2002-10-09  Jakub Jelinek  <jakub@redhat.com>

	* string/test-strspn.c (do_test): Ensure zero termination.
	* string/test-strpbrk.c (do_test): Likewise.
	* string/test-strncmp.c (stupid_strncmp): Use strnlen, not strlen.
	* string/test-strncpy.c (stupid_strncpy): Likewise.
	* string/test-stpncpy.c (stupid_stpncpy): Likewise.

2002-10-08  Roland McGrath  <roland@redhat.com>

	* string/test-string.h (test_init): Fill BUF1 and BUF2 with
	nonzero characters.

2002-09-22  H.J. Lu  <hjl@gnu.org>

	* sysdeps/unix/sysv/linux/mmap64.c (MMAP2_PAGE_SHIFT): Renamed
	from PAGE_SHIFT.  Define if not defined.  Check MMAP2_PAGE_SHIFT
	only if __NR_mmap2 is defined.

	* sysdeps/unix/sysv/linux/powerpc/mmap64.c: Moved to ...
	* sysdeps/unix/sysv/linux/mmap64.c: ... here.
	* sysdeps/unix/sysv/linux/hppa/mmap64.c: File removed.
	* sysdeps/unix/sysv/linux/sparc/sparc32/mmap64.c: FIle removed,

2002-11-08  Jakub Jelinek  <jakub@redhat.com>

	* posix/bug-regex13.c (tests): Add new test.

	* string/test-strchr.c (stupid_strchr): New function.
	(do_random_tests): Make sure the string is zero terminated.
	* string/test-strpbrk.c (stupid_strpbrk): New function.
	(do_random_tests): Make sure the string is zero terminated.
	* string/test-strcmp.c (stupid_strcmp): New function.
	(do_random_tests): Make sure the strings are zero terminated.
	* string/test-strspn.c (stupid_strspn): New function.
	(simple_strspn): Rename rej argument to acc.
	(do_random_tests): Make sure the string is zero terminated.
	* string/test-strcspn.c (stupid_strcspn): New function.
	* string/test-strncpy.c (stupid_strncpy): New function.
	* string/test-stpncpy.c (stupid_stpncpy): New function.
	* string/test-strncmp.c (stupid_strncmp): New function.
	(do_random_tests): Make sure the strings are zero terminated.
	* string/test-string.h (impl_t): Change test into long.
	(IMPL): Add __attribute__((aligned (sizeof (void *)))).

2002-11-08  Roland McGrath  <roland@redhat.com>

	* sysdeps/ia64/elf/configure.in: Add TLS check.
	From Ian Wienand <ianw@cse.unsw.edu.au>.
	* sysdeps/ia64/elf/configure: Regenerated.

2002-11-07  Roland McGrath  <roland@redhat.com>

	* libio/fileops.c (_IO_new_file_overflow): Use INTUSE(_IO_do_write) in
	place of _IO_new_do_write.
	[_LIBC] (_IO_do_write): Define as macro for _IO_new_do_write and
	#undef before versioned_symbol use.

2002-11-07  Richard Henderson  <rth@redhat.com>

	* configure.in (ASM_ALPHA_NG_SYMBOL_PREFIX): Remove test.
	* configure: Regenerated.
	* config.h.in (ASM_ALPHA_NG_SYMBOL_PREFIX): Remove #undef.
	* sysdeps/alpha/dl-machine.h (TRAMPOLINE_TEMPLATE): Use !samegp.
	(RTLD_START): Likewise.  Access _dl_skip_args, _rtld_local, and
	_dl_fini via gp-relative relocations.
	* sysdeps/alpha/fpu/e_sqrt.c: Use !samegp.

	* elf/tls-macros.h: Add alpha versions.
	* sysdeps/alpha/dl-machine.h (elf_machine_rela): Handle TLS relocs.
	* sysdeps/unix/alpha/sysdep.S: Support USE___THREAD.
	* sysdeps/unix/alpha/sysdep.h: Likewise.  Add SYSCALL_ERROR_HANDLER.
	* sysdeps/unix/sysv/linux/alpha/brk.S: Use it.
	* sysdeps/unix/sysv/linux/alpha/clone.S: Likewise.
	* sysdeps/unix/sysv/linux/alpha/getitimer.S: Likewise.
	* sysdeps/unix/sysv/linux/alpha/getrusage.S: Likewise.
	* sysdeps/unix/sysv/linux/alpha/gettimeofday.S: Likewise.
	* sysdeps/unix/sysv/linux/alpha/ieee_get_fp_control.S: Likewise.
	* sysdeps/unix/sysv/linux/alpha/ieee_set_fp_control.S: Likewise.
	* sysdeps/unix/sysv/linux/alpha/rt_sigaction.S: Likewise.
	* sysdeps/unix/sysv/linux/alpha/select.S: Likewise.
	* sysdeps/unix/sysv/linux/alpha/setitimer.S: Likewise.
	* sysdeps/unix/sysv/linux/alpha/settimeofday.S: Likewise.
	* sysdeps/unix/sysv/linux/alpha/sigsuspend.S: Likewise.
	* sysdeps/unix/sysv/linux/alpha/syscall.S: Likewise.
	* sysdeps/unix/sysv/linux/alpha/utimes.S: Likewise.
	* sysdeps/unix/sysv/linux/alpha/wait4.S: Likewise.

	* sysdeps/unix/sysv/linux/alpha/sysdep.h: Re-include protect.
	Kill argument registers across the inline syscall.

	* sysdeps/unix/sysv/linux/alpha/clone.S: Add user_tid and tls args.

	* linuxthreads/sysdeps/alpha/tls.h: New file.
	* sysdeps/alpha/dl-tls.h: New file.

2002-10-29  David Mosberger  <davidm@hpl.hp.com>

	* sysdeps/ia64/elf/initfini.c [HAVE_INITFINI_ARRAY]
	(gmon_initializer): New function.
	(.init prologue): If HAVE_INITFINI_ARRAY is true, don't call
	__gmon_start__ here.  Call it from gmon_initializer() instead.

2002-03-12  H.J. Lu  <hjl@gnu.org>

	* elf/Makefile [$(have-initfini-array) = yes] (tests): Add tst-array1,
	tst-array2, and tst-array3.
	[$(have-initfini-array) = yes] (tests-static): Add tst-array3.
	[$(have-initfini-array) = yes] (modules-names): Add tst-array2dep.
	($(objpfx)tst-array1.out): New target.
	($(objpfx)tst-array2): Likewise.
	($(objpfx)tst-array2.out): Likewise.
	($(objpfx)tst-array3.out): Likewise.
	* elf/tst-array1.c: New file.
	* elf/tst-array1.exp: Likewise.
	* elf/tst-array2.c: Likewise.
	* elf/tst-array2dep.c: Likewise.
	* elf/tst-array2.exp: Likewise.
	* elf/tst-array3.c: Likewise.

2002-10-28  David Mosberger  <davidm@hpl.hp.com>

	* elf/dl-fini.c (_dl_fini): Invoke fini_array in _reverse_ order.
	Don't add L->l_addr to array entry values.

2002-11-07  Jakub Jelinek  <jakub@redhat.com>

	* string/test-string.h: New file.
	* string/test-strlen.c: New file.
	* string/test-string.h: New file.
	* string/test-strcmp.c: New file.
	* string/test-strchr.c: New file.
	* string/test-strrchr.c: New file.
	* string/test-strcpy.c: New file.
	* string/test-stpcpy.c: New file.
	* string/test-strncpy.c: New file.
	* string/test-stpncpy.c: New file.
	* string/test-strpbrk.c: New file.
	* string/test-strcspn.c: New file.
	* string/test-strspn.c: New file.
	* string/test-strcat.c: New file.
	* string/test-strncmp.c: New file.
	* string/test-memchr.c: New file.
	* string/test-memcmp.c: New file.
	* string/test-memset.c: New file.
	* string/test-memcpy.c: New file.
	* string/test-mempcpy.c: New file.
	* string/test-memmove.c: New file.
	* string/Makefile (strop-tests): New variable.
	(tests): Add strop-tests.
	(distribute): Add test-string.h.

2002-11-06  Ulrich Drepper  <drepper@redhat.com>

	* posix/regcomp.c: Use tabs instead of spaces.
	* posix/regexec.c: Likewise.
	* posix/regex_internal.h: Likewise.

	* posix/regcomp.c (re_compile_fastmap_iter): Use __wcrtomb not wctomb.

2002-11-06  Jakub Jelinek  <jakub@redhat.com>

	* posix/regcomp.c (re_compile_pattern): Don't set regs_allocated
	here.
	(regcomp): Don't set can_be_null here.
	(re_comp): Clear whole re_comp_buf with the exception of fastmap.
	(re_compile_internal): Clear can_be_null, set regs_allocated.

	* posix/regcomp.c (re_set_fastmap): New function.
	(re_compile_fastmap_iter): Use it.  Remove redundant type ==
	COMPLEX_BRACKET check.
	* posix/regexec.c (re_search_internal): Optimize searching with
	fastmap.  Call re_string_reconstruct even if match_first is
	smaller than raw_mbs_idx.

2002-11-06  Isamu Hasegawa  <isamu@yamato.ibm.com>

	* posix/regcomp (free_dfa_content): Use free_state.
	* posix/regex_internal.c (re_string_realloc_buffers): Don't edit
	pointers in case that realloc failed.
	(re_node_set_merge): Likewise.
	(register_state): Likewise.
	(create_newstate_common): Invoke memory release functions in case of
	error conditions.
	(create_ci_newstate): Likewise.
	(create_cd_newstate): Likewise.
	(free_state): New function.
	* posix/regexec.c (re_search_internal): Invoke memory release
	functions in case of error conditions.
	(sift_states_backward): Likewise.
	(merge_state_array): Likewise.
	(add_epsilon_src_nodes): Likewise.
	(sub_epsilon_src_nodes): Likewise.
	(search_subexp): Likewise.
	(sift_states_bkref): Likewise.
	(transit_state_sb): Likewise.
	(transit_state_mb): Likewise.
	(transit_state_bkref_loop): Likewise.
	(group_nodes_into_DFAstates): Likewise.
	(push_fail_stack): Don't edit pointers in case that realloc failed.
	(extend_buffers): Likewise.
	(match_ctx_add_entry): Likewise.

2002-11-06  Roland McGrath  <roland@redhat.com>

	* sysdeps/unix/sysv/linux/mips/configure.in: File removed.
	* sysdeps/unix/sysv/linux/mips/configure: Likewise.

	* configure.in: Add checks on as and ld for binutils 2.13 or later.
	* configure: Regenerated.

2002-11-06  Ulrich Drepper  <drepper@redhat.com>

	* posix/regcomp.c (regcomp): __re_compile_fastmap can never fail.
	If re_compile_internal failed free fastmap buffer.
	(free_dfa_content): Broken out of regfree function.  Frees all dfa
	related data.
	(regfree): Add free_dfa_content.
	(re_compile_internal): If any of the called functions fails free
	all dfa related memory.

2002-11-05  Ulrich Drepper  <drepper@redhat.com>

	* sysdeps/unix/sysv/linux/sys/sysctl.h: Add ugly hacks to prevent
	warnings from the kernel headers.

2002-11-05  Roland McGrath  <roland@redhat.com>

	* sysdeps/unix/mips/sysdep.h [! __PIC__] (PSEUDO): Add nop after jump.
	From Johannes Stezenbach <js@convergence.de>.

	* sysdeps/unix/sysv/linux/mips/Versions (libc: GLIBC_2.0): Change
	#errlist-compat magic comment to give 123 as size.
	(libc: GLIBC_2.1): Remove this set, moving #errlist-compat magic to ...
	(libc: GLIBC_2.2): ... here.
	(libc: GLIBC_2.3): Likewise.

2002-11-05  Ulrich Drepper  <drepper@redhat.com>

	* elf/dl-fini.c (_dl_fini): Correct the increment of l_opencount
	which happens at the beginning so that we can unload modules in
	__libc_freeres.

2002-11-06  Kaz Kojima  <kkojima@rr.iij4u.or.jp>

	* sysdeps/sh/bits/setjmp.h (JB_SIZE): Define only
	under [__USE_MISC || _ASM].

	* elf/elf.h: Remove the obsolete SH TLS relocations.

2002-11-05  Ulrich Drepper  <drepper@redhat.com>

	* posix/regcomp.c (regcomp): Initialize preg->can_be_null to zero.

2002-11-05  Franz Sirl  <Franz.Sirl-kernel@lauterbach.com>

	* sysdeps/unix/sysv/linux/powerpc/powerpc32/sysdep.h: Handle
	__NR_pread64 and __NR_pwrite64.
	* sysdeps/unix/sysv/linux/powerpc/powerpc64/sysdep.h: Likewise.
	* sysdeps/unix/sysv/linux/powerpc/pread.c: Remove __NR_pread64
	and __NR_pwrite64.
	Revert change to use INLINE_SYSCALL.
	* sysdeps/unix/sysv/linux/powerpc/pread64.c: Likewise.
	* sysdeps/unix/sysv/linux/powerpc/pwrite.c: Likewise.
	* sysdeps/unix/sysv/linux/powerpc/pwrite64.c: Likewise.
	* sysdeps/unix/sysv/linux/powerpc/ftruncate64.c: Revert change to use
	INLINE_SYSCALL.
	* sysdeps/unix/sysv/linux/powerpc/truncate64.c: Likewise.

	* sysdeps/unix/sysv/linux/powerpc/powerpc32/sysdep.h (INLINE_SYSCALL):
	Update clobber list and add a comment about the syscall ABI.

	* sysdeps/unix/sysv/linux/powerpc/powerpc32/syscalls.list (s_pread64,
	s_pwrite64, s_ftruncate, s_truncate): Re-add.

2002-11-05  Jakub Jelinek  <jakub@redhat.com>

	* iconv/gconv_dl.c (free_mem): Clear loaded.
	* locale/loadarchive.c (_nl_archive_subfreeres): Call locale_data's
	cleanup if any.

2002-11-05  Ulrich Drepper  <drepper@redhat.com>

	* sysdeps/unix/sysv/linux/fexecve.c: Include <stdio.h>.

	* libio/ioseekoff.c: Remove INTDEF.  Define _IO_seekoff_unlocked.  Same
	as old code without locking.  _IO_seekoff calls this function after
	locking the stream.
	* libio/ioseekpos.c: Likewise for _IO_seekpos.
	* libio/libioP.h: Replace _IO_seekoff_internal and _IO_seekpos_internal
	prototypes with _IO_seekoff_unlocked and _IO_seekpos_unlocked
	prototypes.
	* libio/iolibio.h (_IO_fseek): Call _IO_seekoff_unlocked instead
	of _IO_seekoff_internal.
	(_IO_rewind): Likewise.
	* libio/ioftell.c: Likewise.
	* libio/ftello.c: Likewise.
	* libio/ftello64.c: Likewise.
	* libio/iofgetpos.c: Likewise.
	* libio/iofgetpos64.c: Likewise.
	* libio/oldiofgetpos.c: Likewise.
	* libio/oldiofgetpos64.c: Likewise.
	* libio/iofsetpos.c: Call _IO_seekpos_unlocked instead of
	_IO_seekpos_internal.
	* libio/iofsetpos64.c: Likewise.
	* libio/oldiofsetpos.c: Likewise.
	* libio/oldiofsetpos64.c: Likewise.

2002-11-04  Roland McGrath  <roland@redhat.com>

	* sysdeps/unix/sysv/linux/powerpc/chown.c: Use INLINE_SYSCALL macro.
	* sysdeps/unix/sysv/linux/powerpc/ftruncate64.c: Likewise.
	* sysdeps/unix/sysv/linux/powerpc/ioctl.c: Likewise.
	* sysdeps/unix/sysv/linux/powerpc/pread.c: Likewise.
	* sysdeps/unix/sysv/linux/powerpc/pread64.c: Likewise.
	* sysdeps/unix/sysv/linux/powerpc/pwrite.c: Likewise.
	* sysdeps/unix/sysv/linux/powerpc/pwrite64.c: Likewise.
	* sysdeps/unix/sysv/linux/powerpc/tcgetattr.c: Likewise.
	* sysdeps/unix/sysv/linux/powerpc/tcsetattr.c: Likewise.
	* sysdeps/unix/sysv/linux/powerpc/truncate64.c: Likewise.
	* sysdeps/unix/sysv/linux/powerpc/powerpc32/syscalls.list (s_ioctl,
	s_chown, s_ftruncate64, s_mmap2, s_pread64, s_pwrite64, s_truncate64,
	sys_fstat, sys_lstat, sys_mknod, sys_readv, sys_stat, sys_writev):
	Remove these, no longer used.

2002-11-04  Franz Sirl  <Franz.Sirl-kernel@lauterbach.com>

	* sysdeps/unix/sysv/linux/powerpc/powerpc32/syscalls.list (s_ipc,
	s_llseek, s_readahead, s_execve, s_fcntl, s_fcntl64, s_fstat64,
	s_getcwd, s_getdents, s_getdents64, s_getpmsg, s_getpriority,
	s_getrlimit, s_lstat64, s_poll, s_ptrace, s_putpmsg, s_reboot,
	s_setrlimit, s_sigaction, s_sigpending, s_sigprocmask, s_sigsuspend,
	s_stat64, s_sysctl, s_ugetrlimit, s_ustat, s_vfork): Remove now unused
	syscall stubs.

	* sysdeps/unix/sysv/linux/pwrite.c: Fix typo.
	* sysdeps/unix/sysv/linux/pwrite64.c: Likewise.
	* sysdeps/unix/sysv/linux/powerpc/pread.c: Handle both __NR_pread64
	and __NR_pread.
	* sysdeps/unix/sysv/linux/powerpc/pread64.c: Likewise.
	* sysdeps/unix/sysv/linux/powerpc/pwrite.c: Handle both __NR_pwrite64
	and __NR_pwrite.
	* sysdeps/unix/sysv/linux/powerpc/pwrite64.c: Likewise.

2002-11-03  Roland McGrath  <roland@redhat.com>

	* sysdeps/generic/ldsodefs.h (struct rtld_global): New member
	`_dl_tls_static_used'.
	* sysdeps/generic/libc-tls.c (_dl_tls_static_used): New variable.
	(__libc_setup_tls): Initialize it.  Let the initial value of
	_dl_tls_static_size indicate some surplus space in the computed value.
	* elf/dl-open.c (_dl_tls_static_size): New variable.
	* sysdeps/generic/dl-tls.c (_dl_determine_tlsoffset): Initialize
	_dl_tls_static_used.  Add some surplus space into _dl_tls_static_size.
	* elf/dl-reloc.c [USE_TLS] (allocate_static_tls): New function.
	(CHECK_STATIC_TLS): Use it.
	* elf/dl-close.c (_dl_close): Adjust _dl_tls_static_used when the
	closed objects occupied a trailing contiguous chunk of static TLS area.

2002-10-18  Bruno Haible  <bruno@clisp.org>

	* charmaps/ISO_5428: Use Greek characters introduced in Unicode 3.0.

2002-11-04  Ulrich Drepper  <drepper@redhat.com>

	* libio/wfileops.c (_IO_wfile_seekoff): Don't modify _offset and
	_wide_data->_IO_read_end if adjustment can be made in the current
	buffer.

	* sysdeps/unix/sysv/linux/fexecve.c: New file.

	* libio/bug-wfflush.c (do_test): Using fseek is not allowed when
	wide oriented streams are used.

	* nss/getXXent_r.c (ENDFUNC_NAME): Don't do anything if the
	service hasn't been used [PR libc/4744].

	* include/features.h: Use __STDC_VERSION__ not __STDC_VERSION.
	Reported by Miloslav Trmac <mitr@volny.cz> [PR libc/4766].

	* manual/examples/dir.c: Don't include <stddef.h>.
	* manual/examples/select.c: Include <errno.h> for TEMP_FAILURE_RETRY.
	Reported by Frdric Delanoy <delanoy_f@yahoo.com>.

2002-11-02  H.J. Lu  <hjl@gnu.org>

	* stdio-common/reg-printf.c: Include <stddef.h>.

2002-11-03  Ulrich Drepper  <drepper@redhat.com>

	* sysdeps/generic/libc-tls.c: Define _dl_tls_static_used.

	* po/ca.po: Update from translation team.
	* po/es.po: Likewise.

	* sysdeps/generic/segfault.c (catch_segfault): If HAVE_PROC_SELF
	is defined write out memory map.
	* sysdeps/unix/sysv/linux/segfault.c: New file.

2002-11-02  Roland McGrath  <roland@redhat.com>

	* sysdeps/unix/sysv/linux/getdents.c (__GETDENTS): Use union type for
	pointers that can alias.
	Reported by Daniel Jacobowitz <drow@mvista.com>.

	* sysdeps/unix/bsd/bsd4.4/freebsd/bits/typesizes.h: New file.

2002-11-02  Roland McGrath  <roland@redhat.com>

	* manual/filesys.texi (Reading/Closing Directory): Rewrite readdir_r
	description to be clearer and to say that *RESULT is set to ENTRY.

2002-10-30  Jakub Jelinek  <jakub@redhat.com>

	* posix/regexec.c (build_trtable): Alloca or malloc dests_node and
	dests_ch arrays together.  Alloca or malloc dest_states,
	dest_states_word and dest_states_nl arrays together.  Free memory on
	error exit.

2002-10-29  Daniel Jacobowitz  <drow@mvista.com>

	* crypt/crypt_util.c (__init_des_r): Initialize current_salt
	and current_saltbits.

2002-11-02  Roland McGrath  <roland@redhat.com>

	* stdio-common/reg-printf.c: Include <stdlib.h>.

2002-11-02  H.J. Lu  <hjl@gnu.org>

	* sysdeps/unix/sysv/linux/mips/syscalls.list (s_execve): Set
	caller to EXTRA instead of execve.

2002-11-01  Roland McGrath  <roland@redhat.com>

	* sysdeps/generic/errno-loc.c [! USE___THREAD]: Use this conditional
	in place of [!(USE_TLS && HAVE___THREAD)].
	(__errno_location) [! USE___THREAD]: Define as strong, not weak.

2002-10-31  Roger Sayle  <roger@eyesopen.com>

	* sysdeps/i386/soft-fp/sfp-machine.h (_FP_NANFRAC_Q, _FP_NANSIGN_Q):
	New macros.
	* sysdeps/x86_64/soft-fp/sfp-machine.h: Likewise.

	* soft-fp/soft-fp.h: Allow sfp-machine.h to define FP_RND_NEAREST
	without defining FP_ROUNDMODE.

2002-10-29  Jakub Jelinek  <jakub@redhat.com>

	* sysdeps/gnu/siglist.c (PTR_SIZE_STR): Remove.
	(__old_sys_siglist, __old_sys_sigabbrev): Use strong_alias and
	declare_symbol.
	* sysdeps/mach/hurd/siglist.h (OLD_SIGLIST_SIZE_STR): Remove.
	(OLD_SIGLIST_SIZE): Define.
	* sysdeps/unix/sysv/linux/siglist.h (OLD_SIGLIST_SIZE_STR): Remove.
	(OLD_SIGLIST_SIZE): Define.
	* sysdeps/unix/sysv/linux/arm/siglist.c: Remove.

2002-11-01  Jakub Jelinek  <jakub@redhat.com>

	* sysdeps/ia64/strncpy.S: Fix recovery code.

2002-10-30  Jakub Jelinek  <jakub@redhat.com>

	* include/libc-symbols.h (__libc_freeres_fn_section, libc_freeres_fn):
	New macros.
	* elf/dl-close.c (free_mem): Use libc_freeres_fn macro, remove
	text_set_element.
	* elf/dl-libc.c (free_mem): Likewise.
	* iconv/gconv_conf.c (free_mem): Likewise.
	* iconv/gconv_db.c (free_mem): Likewise.
	* iconv/gconv_dl.c (free_mem): Likewise.
	* iconv/gconv_cache.c (free_mem): Likewise.
	* intl/finddomain.c (free_mem): Likewise.
	* intl/dcigettext.c (free_mem): Likewise.
	* locale/setlocale.c (free_mem): Likewise.
	* misc/fstab.c (fstab_free): Likewise.
	* nss/nsswitch.c (free_mem): Likewise.
	* posix/regcomp.c (free_mem): Likewise.
	* resolv/gai_misc.c (free_res): Likewise.
	* stdlib/fmtmsg.c (free_mem): Likewise.
	* sunrpc/clnt_perr.c (free_mem): Likewise.
	* sysdeps/generic/setenv.c (free_mem): Likewise.
	* sysdeps/unix/sysv/linux/shm_open.c (freeit): Likewise.
	* sysdeps/pthread/aio_misc.c (free_res): Likewise.
	* time/tzset.c (free_mem): Likewise.
	* malloc/mtrace.c (release_libc_mem): Add __libc_freeres_fn_section.
	* locale/loadarchive.c (_nl_archive_subfreeres): Likewise.
	* malloc/set-freeres.c (__libc_freeres): Likewise.

	* login/getutent.c: Include stdlib.h instead of stddef.h.
	(buffer): Change into pointer to utmp, add libc_freeres_ptr.
	(__getutent): Allocate buffer the first time it is run.
	* login/getutid.c: Include stdlib.h instead of stddef.h.
	(buffer): Change into pointer to utmp, add libc_freeres_ptr.
	(__getutid): Allocate buffer the first time it is run.
	* login/getutline.c: Include stdlib.h instead of stddef.h.
	(buffer): Change into pointer to utmp, add libc_freeres_ptr.
	(__getutline): Allocate buffer the first time it is run.
	* malloc/mtrace.c (malloc_trace_buffer): Change into char *.
	(mtrace): Allocate malloc_trace_buffer.
	* resolv/nsap_addr.c (inet_nsap_ntoa): Decrease size of tmpbuf.
	* resolv/ns_print.c (ns_sprintrrf): Decrease size of t.
	* string/strerror.c: Include libintl.h and errno.h.
	(buf): New variable.
	(strerror): Only allocate buffer if actually needed (unknown error).
	* time/tzfile.c (transitions): Add libc_freeres_ptr.
	(freeres): Remove.

2002-10-25  Jakub Jelinek  <jakub@redhat.com>

	* include/libc-symbols.h (libc_freeres_ptr): New macro.
	* malloc/set-freeres.c (__libc_freeres_ptrs): Define using
	symbol_set_define.
	(__libc_freeres): Free all pointers in that section.
	* Makerules (build-shlib): Add $(LDSEDCMD-$(@F:lib%.so=%).so) to sed
	commands when creating .lds script.
	(LDSEDCMD-c.so): New variable.
	* inet/rcmd.c (ahostbuf): Change into char *.  Add libc_freeres_ptr.
	(rcmd_af): Use strdup to allocate ahostbuf.
	* inet/rexec.c (ahostbuf): Change into char *.  Add libc_freeres_ptr.
	(rexec_af): Use strdup to allocate ahostbuf.
	* stdio-common/reg-printf.c (printf_funcs): Remove.
	(__printf_arginfo_table): Change into printf_arginfo_function **.
	Add libc_freeres_ptr.
	(__register_printf_function): Allocate __printf_arginfo_table
	and __printf_function_table the first time it is called.
	* stdio-common/printf-parse.h (__printf_arginfo_table): Change into
	printf_arginfo_function **.
	(parse_one_spec): Add __builtin_expect.
	* grp/fgetgrent.c (buffer): Add libc_freeres_ptr.
	(free_mem): Remove.
	* inet/getnetgrent.c (buffer): Add libc_freeres_ptr.
	(free_mem): Remove.
	* intl/localealias.c (libc_freeres_ptr): Define if !_LIBC.
	(string_space, map): Add libc_freeres_ptr.
	(free_mem): Remove.
	* misc/efgcvt.c (FCVT_BUFPTR): Add libc_freeres_ptr.
	(free_mem): Remove.
	* misc/mntent.c (getmntent_buffer): Add libc_freeres_ptr.
	(free_mem): Remove.
	* crypt/md5-crypt.c (libc_freeres_ptr): Define if !_LIBC.
	(buffer): Add libc_freeres_ptr.
	(free_mem): Remove for _LIBC.
	* nss/getXXbyYY.c (buffer): Add libc_freeres_ptr.
	(free_mem): Remove.
	* nss/getXXent.c (buffer): Add libc_freeres_ptr.
	(free_mem): Remove.
	* pwd/fgetpwent.c (buffer): Add libc_freeres_ptr.
	(free_mem): Remove.
	* resolv/res_hconf.c (ifaddrs): Add libc_freeres_ptr.
	(free_mem): Remove.
	* shadow/fgetspent.c (buffer): Add libc_freeres_ptr.
	(free_mem): Remove.
	* sysdeps/posix/ttyname.c (getttyname_name): Add libc_freeres_ptr.
	(free_mem): Remove.
	* sysdeps/unix/sysv/linux/getsysstats.c (mount_proc): Add
	libc_freeres_ptr.
	(free_mem): Remove.
	* sysdeps/unix/sysv/linux/ttyname.c (getttyname_name, ttyname_buf): Add
	libc_freeres_ptr.
	(free_mem): Remove.

2002-10-30  Jakub Jelinek  <jakub@redhat.com>

	* malloc/obstack.c [_LIBC] (obstack_free): Change into strong_alias
	instead of duplicating the whole function in libc.

2002-10-31  Roland McGrath  <roland@redhat.com>

	* sysdeps/i386/bits/byteswap.h [__GNUC__ < 2] (__bswap_32):
	Renamed from __bswap_16 (typo fix).  Reported by <dens@stl.sarov.ru>.

2002-10-30  Jakub Jelinek  <jakub@redhat.com>

	* sysdeps/unix/sysv/linux/Makefile (syscall-%.h): Add -D for each
	32bit-predefine when creating .new32 list and -U for each
	32bit-predefine when creating .new64 list.
	* sysdeps/unix/sysv/linux/x86_64/Makefile (32bit-predefine): New.

2002-10-29  Andreas Schwab  <schwab@suse.de>

	* sysdeps/generic/allocrtsig.c: Include <testrtsig.h>, not
	"testrtsig.h".  Reported by Daniel Jacobowitz <dan@debian.org>.

2002-10-25  Roland McGrath  <roland@redhat.com>

	* sysdeps/unix/sysv/linux/configure.in: Fix typo in last change.
	* sysdeps/unix/sysv/linux/configure: Regenerated.

	* sysdeps/generic/ldsodefs.h: Remove [! SHARED] conditional from
	_dl_starting_up decl.

2002-10-20  H.J. Lu  <hjl@gnu.org>

	* sysdeps/unix/sysv/linux/configure.in: Don't check
	/lib/modules/`uname -r`/build/include for kernel headers if
	cross compiling.
	* sysdeps/unix/sysv/linux/configure: Regenerated.

2002-10-25  Roland McGrath  <roland@redhat.com>

	* math/math.h (M_LOG2El): Correct the value.
	From Stephen L Moshier <steve@moshier.net>.

	* sysdeps/unix/sysv/linux/init-first.c (init): Remove [! SHARED]
	conditional from __libc_multiple_libcs access.  Remove kludge for weak
	symbol access with old compilers we no longer support.
	* sysdeps/unix/sysv/aix/init-first.c (init): Likewise.
	* sysdeps/generic/libc-start.c (__libc_start_main): Likewise.

2002-10-25  Roland McGrath  <roland@redhat.com>

	* sysdeps/posix/sigvec.c [SA_RESETHAND]: Disable wrapper hacks and
	implement SV_RESETHAND by translating it to SA_RESETHAND.

2002-10-23  Alexandre Oliva  <aoliva@redhat.com>

	* elf/dl-reloc.c (_dl_reloc_bad_use): Print the full 32-bit relocation
	type on ELF64 platforms.

2002-10-24  Ulrich Drepper  <drepper@redhat.com>

	* elf/elf.h (R_X86_64_GOTTPOFF): Renamed from r_x86_64_GOTTPOFF.

	* elf/elf.h: Define ELF_NOTE_OS_FREEBSD and NT_TASKSTRUCT.

2002-10-24  Jakub Jelinek  <jakub@redhat.com>

	* elf/dl-misc.c: Include <sysdep.h>.
	(_dl_debug_vdprintf): Only take dl_load_lock if not _dl_starting_up.

	* sysdeps/unix/sysv/linux/s390/s390-32/sysdep.h (INTERNAL_SYSCALL,
	INTERNAL_SYSCALL_ERROR_P, INTERNAL_SYSCALL_ERRNO): New macros.
	(INLINE_SYSCALL): Use that.
	* sysdeps/unix/sysv/linux/s390/s390-64/sysdep.h (INTERNAL_SYSCALL,
	INTERNAL_SYSCALL_ERROR_P, INTERNAL_SYSCALL_ERRNO): New macros.
	(INLINE_SYSCALL): Use that.
	* sysdeps/unix/sysv/linux/x86_64/sysdep.h (INTERNAL_SYSCALL,
	INTERNAL_SYSCALL_ERROR_P, INTERNAL_SYSCALL_ERRNO): New macros.
	(INLINE_SYSCALL): Use that.
	* sysdeps/unix/sysv/linux/sparc/sparc32/sysdep.h: Include
	dl-sysdep.h.
	(SYSCALL_ERROR_HANDLER): Define RTLD_PRIVATE_ERRNO variant.
	(__INTERNAL_SYSCALL_STRING): Define.
	* sysdeps/unix/sysv/linux/sparc/sparc64/sysdep.h: Include
	dl-sysdep.h.
	(SYSCALL_ERROR_HANDLER): Define RTLD_PRIVATE_ERRNO variant.
	(__INTERNAL_SYSCALL_STRING): Define.
	* sysdeps/unix/sysv/linux/sparc/sysdep.h (INLINE_SYSCALL): Pass
	__SYSCALL_STRING to inline_syscall*.
	(INTERNAL_SYSCALL, INTERNAL_SYSCALL_ERROR_P, INTERNAL_SYSCALL_ERRNO):
	New macros.
	(inline_syscall0, inline_syscall1, inline_syscall2, inline_syscall3,
	inline_syscall4, inline_syscall5, inline_syscall6): Add string
	argument.

2002-10-24  Roland McGrath  <roland@redhat.com>

	* sysdeps/generic/ldsodefs.h (_dl_starting_up): Declare it here.
	* sysdeps/unix/sysv/linux/init-first.c: Not here.
	* sysdeps/powerpc/elf/libc-start.c: Or here.
	* sysdeps/unix/sysv/aix/libc-start.c: Or here.
	* sysdeps/unix/sysv/aix/start-libc.c: Or here.
	* sysdeps/unix/sysv/aix/init-first.c: Or here.
	* sysdeps/generic/libc-start.c: Or here.
	* sysdeps/unix/sysv/linux/init-first.c (init): Protect _dl_starting_up
	access with [! SHARED].
	* sysdeps/unix/sysv/aix/init-first.c (init): Likewise.

	* libio/bug-wfflush.c: New file.
	* libio/Makefile (tests): Add bug-wfflush.

2002-10-23  Roland McGrath  <roland@redhat.com>

	* stdio-common/tst-fphex.c: New file.
	* stdio-common/Makefile (tests): Add tst-fphex.
	* sysdeps/generic/printf_fphex.c (__printf_fphex): Fix initialization
	of WNUMEND.  Fix counting of decimal point in WIDTH.  Print '0' pad
	chars always before the value digits.
	Reported by James Antill <james.antill@redhat.com>.

2002-10-24  Jakub Jelinek  <jakub@redhat.com>

	* posix/regcomp.c (re_comp): Call __regfree on re_comp_buf.
	(free_mem): New function.
	* posix/Makefile (tests): Add bug-regex14.  Add bug-regex14-mem
	if not cross compiling.
	(generated): Add bug-regex14-mem and bug-regex14.mtrace.
	(bug-regex14-ENV): Set.
	(bug-regex14-mem): New target.
	* posix/bug-regex14.c: New file.

2002-10-23  Roland McGrath  <roland@redhat.com>

	* elf/Makefile ($(objpfx)librtld.map): Use temporary file for output
	target, so we don't touch it when the link fails.

	* libio/ftello.c (ftello): Use _IO_off64_t for type of POS.
	Check for the result overflowing off_t and fail with EOVERFLOW.
	* libio/ioftell.c (_IO_ftell): Likewise.
	* libio/iofgetpos.c (_IO_new_fgetpos): Likewise.

	* login/logwtmp.c (logwtmp): If sizeof ut_tv != sizeof struct timeval,
	use a temporary timeval on the stack for gettimeofday and copy it.
	* login/logout.c (logout): Likewise.
	Reported by Steven Munroe <sjmunroe@us.ibm.com>.

	* sysdeps/unix/sysv/linux/bits/statfs.h (struct statfs):
	Use __SWORD_TYPE instead of int for member types.
	(struct statfs64): Likewise.
	* sysdeps/unix/sysv/linux/alpha/bits/statfs.h: New file.
	* sysdeps/unix/sysv/linux/s390/bits/statfs.h: New file.
	* sysdeps/unix/sysv/linux/ia64/bits/statfs.h: File removed.
	* sysdeps/unix/sysv/linux/sparc/bits/statfs.h: File removed.
	* sysdeps/unix/sysv/linux/x86_64/bits/statfs.h: File removed.

	* sysdeps/unix/sysv/linux/sparc/bits/statvfs.h: Moved to ...
	* sysdeps/unix/sysv/linux/bits/statvfs.h: ... here.
	(ST_NODIRATIME): Restore fixed value of 2048.
	* sysdeps/unix/sysv/linux/alpha/bits/statvfs.h: File removed.
	* sysdeps/unix/sysv/linux/ia64/bits/statvfs.h: File removed.

	Rearranged <bits/types.h> definitions to reduce duplication.
	* sysdeps/generic/bits/types.h: Rewritten, using macros from
	<bits/wordsize.h> and new header <bits/typesizes.h>.
	* posix/Makefile (headers): Add bits/typesizes.h here.
	* sysdeps/generic/bits/typesizes.h: New file.
	* sysdeps/unix/sysv/linux/alpha/bits/typesizes.h: New file.
	* sysdeps/unix/sysv/linux/sparc/bits/typesizes.h: New file.
	* sysdeps/mach/hurd/bits/typesizes.h: New file.
	* sysdeps/unix/sysv/linux/alpha/bits/types.h: File removed.
	* sysdeps/unix/sysv/linux/bits/types.h: File removed.
	* sysdeps/unix/sysv/linux/ia64/bits/types.h: File removed.
	* sysdeps/unix/sysv/linux/mips/bits/types.h: File removed.
	* sysdeps/unix/sysv/linux/s390/bits/types.h: File removed.
	* sysdeps/unix/sysv/linux/sparc/bits/types.h: File removed.
	* sysdeps/unix/sysv/linux/x86_64/bits/types.h: File removed.
	* posix/sys/types.h [__USE_POSIX199506 || __USE_UNIX98]: Include
	<bits/pthreadtypes.h> here, not in <bits/types.h>.
	* signal/signal.h: Likewise.

	* streams/stropts.h: Include <bits/xtitypes.h>.
	* streams/Makefile (headers): Add bits/xtitypes.h here.
	* sysdeps/generic/bits/xtitypes.h: New file.
	* sysdeps/s390/bits/xtitypes.h: New file.
	* sysdeps/ia64/bits/xtitypes.h: New file.
	* sysdeps/x86_64/bits/xtitypes.h: New file.

	* sysvipc/Makefile (headers): Add bits/ipctypes.h here.
	* sysdeps/generic/bits/ipctypes.h: New file.
	* sysdeps/mips/bits/ipctypes.h: New file.
	* sysdeps/gnu/bits/shm.h: Include <bits/ipctypes.h>.
	* sysdeps/gnu/bits/msq.h: Likewise.
	* sysvipc/sys/ipc.h: Likewise.

2002-10-22  Ulrich Drepper  <drepper@redhat.com>

	* elf/dl-load.c (struct filebuf): For buf element to have the
	alignment of ElfXX_Ehdr since this is what will be stored in it.

2002-10-22  Jakub Jelinek  <jakub@redhat.com>

	* locale/programs/locarchive.c (add_alias): Change locrec_offset arg
	into pointer to locrec_offset.
	(add_locale_to_archive): Adjust callers.  Free normalized_name right
	before returning, not immediately after add_locale, pass it to
	add_alias if not NULL instead of name.  Rename second normalized_name
	occurence to nnormalized_codeset_name.

	* locale/programs/locarchive.c (enlarge_archive): Make sure
	string_size is always a multiple of 4.
	Reported by Andreas Schwab <schwab@suse.de>.

2002-10-21  Andreas Schwab  <schwab@suse.de>

	* sysdeps/unix/sysv/linux/ia64/syscalls.list (s_execve): Set
	caller to EXTRA instead of execve, since the latter has a
	higher-priority implementation in linuxthreads.

2002-10-21  Roland McGrath  <roland@redhat.com>

	* sysdeps/generic/libc-tls.c (__libc_setup_tls): Initialize the static
	slotinfo list's len member to the proper size, not just 1.
	Initialize static_map.l_tls_initimage.

	* elf/dl-open.c (dl_open_worker): Fix loop searching for
	dtv_slotinfo_list element containing new modules' l_tls_modid.

	* elf/tst-tls9.c, elf/tst-tls9-static.c: New files.
	* elf/tst-tlsmod5.c, elf/tst-tlsmod6.c: New files.
	* elf/Makefile (tests): Add tst-tls9.
	(tests-static): Add tst-tls9-static.
	(tst-tls9-static-ENV): New variable.
	($(objpfx)tst-tls9-static, $(objpfx)tst-tls9-static.out): New targets.

	* elf/dl-close.c (remove_slotinfo): Remove an assert; the number of
	modids used by partially loaded modules being closed can't be known.

2002-10-21  Isamu Hasegawa  <isamu@yamato.ibm.com>

	* posix/Makefile: Add a test case for the bug reported by Aharon
	Robbins <arnold@skeeve.com>.
	* posix/bug-regex13.c: New file.
	* posix/regcomp.c (peek_token_bracket): Skip the byte already read.

2002-10-21  Ulrich Drepper  <drepper@redhat.com>

	* csu/gmon-start.c: Pretty printing.

2002-10-19  Art Haas  <ahaas@neosoft.com>

	* configure.in: Replace AC_CONFIG_HEADER with AC_CONFIG_HEADERS,
	add AC_HELP_STRING to all AC_ARG_WITH and AC_ARG_ENABLE macros,
	add autoconf quotes to the AC_CONFIG_AUX_DIR macro.
	* configure: Regenerated.

2002-10-19  Roland McGrath  <roland@redhat.com>

	* configure.in: Call AC_CONFIG_SUBDIRS with empty argument
	and then set $subdirs directly, because the new Autoconf breaks
	compatibility in every way imaginable and insists on whining
	about usage that worked since the dawn of time.
	* configure: Regenerated.

	* configure: Regenerated (using Autoconf 2.54).
	* sysdeps/alpha/elf/configure: Likewise.
	* sysdeps/generic/configure: Likewise.
	* sysdeps/i386/elf/configure: Likewise.
	* sysdeps/ia64/elf/configure: Likewise.
	* sysdeps/mach/hurd/configure: Likewise.
	* sysdeps/mach/configure: Likewise.
	* sysdeps/unix/configure: Likewise.
	* sysdeps/unix/common/configure: Likewise.
	* sysdeps/unix/sysv/aix/configure: Likewise.
	* sysdeps/unix/sysv/linux/configure: Likewise.
	* sysdeps/unix/sysv/linux/mips/configure: Likewise.
	* sysdeps/x86_64/elf/configure: Likewise.

	* config.make.in: Nix completely-soft nonsense.
	* configure.in: Likewise.  Under --without-fp, use nofpu subdirectory
	of machine directories instead of fpu subdirectory.
	* sysdeps/powerpc/soft-fp/Makefile: Remove cruft added in last change.
	* sysdeps/powerpc/nofpu/Makefile: Put it in this new file instead.
	* sysdeps/powerpc/soft-fp/sim-full.c: Moved to ...
	* sysdeps/powerpc/nofpu/sim-full.c: ... here.
	* sysdeps/powerpc/soft-fp/fraiseexcpt.c: Moved to ...
	* sysdeps/powerpc/nofpu/fraiseexcpt.c: ... here.
	* sysdeps/powerpc/soft-fp/fegetexcept.c: Moved to ...
	* sysdeps/powerpc/nofpu/fegetexcept.c: ... here.
	* sysdeps/powerpc/soft-fp/fclrexcpt.c: Moved to ...
	* sysdeps/powerpc/nofpu/fclrexcpt.c: ... here.
	* sysdeps/powerpc/soft-fp/ftestexcept.c: Moved to ...
	* sysdeps/powerpc/nofpu/ftestexcept.c: ... here.
	* sysdeps/powerpc/soft-fp/fgetexcptflg.c: Moved to ...
	* sysdeps/powerpc/nofpu/fgetexcptflg.c: ... here.
	* sysdeps/powerpc/soft-fp/fsetexcptflg.c: Moved to ...
	* sysdeps/powerpc/nofpu/fsetexcptflg.c: ... here.
	* sysdeps/powerpc/soft-fp/fedisblxcpt.c: Moved to ...
	* sysdeps/powerpc/nofpu/fedisblxcpt.c: ... here.
	* sysdeps/powerpc/soft-fp/feenablxcpt.c: Moved to ...
	* sysdeps/powerpc/nofpu/feenablxcpt.c: ... here.
	* sysdeps/powerpc/soft-fp/fegetenv.c: Moved to ...
	* sysdeps/powerpc/nofpu/fegetenv.c: ... here.
	* sysdeps/powerpc/soft-fp/fesetenv.c: Moved to ...
	* sysdeps/powerpc/nofpu/fesetenv.c: ... here.
	* sysdeps/powerpc/soft-fp/fegetround.c: Moved to ...
	* sysdeps/powerpc/nofpu/fegetround.c: ... here.
	* sysdeps/powerpc/soft-fp/fesetround.c: Moved to ...
	* sysdeps/powerpc/nofpu/fesetround.c: ... here.
	* sysdeps/powerpc/soft-fp/feupdateenv.c: Moved to ...
	* sysdeps/powerpc/nofpu/feupdateenv.c: ... here.
	* sysdeps/powerpc/soft-fp/feholdexcpt.c: Moved to ...
	* sysdeps/powerpc/nofpu/feholdexcpt.c: ... here.
	* sysdeps/powerpc/soft-fp/fenv_const.c: Moved to ...
	* sysdeps/powerpc/nofpu/fenv_const.c: ... here.
	* sysdeps/powerpc/soft-fp/libm-test-ulps: Moved to ...
	* sysdeps/powerpc/nofpu/libm-test-ulps: ... here.
	* sysdeps/powerpc/soft-fp/soft-supp.h: Moved to ...
	* sysdeps/powerpc/nofpu/soft-supp.h: ... here.
	* sysdeps/powerpc/soft-fp/Versions (libc: GLIBC_2.3.2): Moved to ...
	* sysdeps/powerpc/nofpu/Versions: ... here, new file.

2002-10-19  Bruno Haible  <bruno@clisp.org>

	* sysdeps/unix/bsd/bsd4.4/freebsd/sys/sysmacros.h: New file.

2002-10-18  Roland McGrath  <roland@redhat.com>

	* io/Makefile (routines): Add lchmod.
	* io/sys/stat.h [__USE_BSD] (lchmod): Declare it.
	* sysdeps/generic/lchmod.c: New file.
	* sysdeps/mach/hurd/lchmod.c: New file.
	* io/Versions (libc: GLIBC_2.3.2): New set, add lchmod.

2002-10-18  Art Haas  <ahaas@neosoft.com>

	* configure.in: Remove remaining AC_FD_CC macros, and replace
	AC_FD_MSG with AS_MESSAGE_FD.

2002-10-18  Roland McGrath  <roland@redhat.com>

	* sysdeps/powerpc/powerpc32/dl-machine.c (__process_machine_rela): Fix
	typos: VALUE -> FINALADDR.

	* sysdeps/unix/alpha/sysdep.h (INLINE_SYSCALL, INLINE_SYSCALL1)
	(inline_syscall_clobbers, inline_syscall0, inline_syscall1)
	(inline_syscall2, inline_syscall3, inline_syscall4, inline_syscall5)
	(inline_syscall6): Move these macros ...
	* sysdeps/unix/sysv/linux/alpha/sysdep.h: ... to here.

	* configure.in (libc_link_dests, libc_link_sources): Remove these
	variables and the AC_LINK_FILES call.

	* sysdeps/powerpc/soft-fp/Versions (libc: GLIBC_2.3.2): Fix last
	change to put new symbols here instead of in GLIBC_2.2.
	* sysdeps/powerpc/Subdirs: Move this file ...
	* sysdeps/powerpc/soft-fp/Subdirs: ... here.

2002-10-07  Roland McGrath  <roland@redhat.com>

	* sysdeps/generic/bits/time.h: Replaced with contents of the
	sysdeps/unix/sysv/linux/i386/bits/time.h file.  All the following
	files were identical except for the absence of CLOCK_THREAD_CPUTIME_ID
	and CLOCK_PROCESS_CPUTIME_ID in .../linux/bits/time.h; adding these
	macros is ok even for architectures that don't now implement them.
	* sysdeps/mach/hurd/bits/time.h: File removed.
	* sysdeps/unix/sysv/linux/bits/time.h: File removed.
	* sysdeps/unix/sysv/linux/i386/bits/time.h: File removed.
	* sysdeps/unix/sysv/linux/ia64/bits/time.h: File removed.
	* sysdeps/unix/sysv/linux/sparc/bits/time.h: File removed.
	* sysdeps/unix/sysv/linux/x86_64/bits/time.h: File removed.

2002-10-18  Jeff Bailey  <jbailey@gnu.org>

	* configure.in: Replace obsolete AC_OUTPUT syntax with
	AC_CONFIG_FILES, AC_CONFIG_COMMANDS, and new-type AC_OUTPUT trio.

	* aclocal.m4 (GLIBC_PROVIDES): Add AC_PROVIDEs for
	_AS_PATH_SEPARATOR_PREPARE and _AS_TEST_PREPARE.

	* configure.in: Replace AC_FD_CC with AS_MESSAGE_LOG_FD.
	* sysdeps/alpha/elf/configure.in: Likewise.
	* sysdeps/i386/elf/configure.in: Likewise.
	* sysdeps/mach/hurd/configure.in: Likewise.
	* sysdeps/x86_64/elf/configure.in: Likewise.

	* configure.in: Use AC_CONFIG_SRCDIR and new AC_INIT syntax.

	* sysdeps/alpha/elf/configure.in: Remove unneeded sinclude statement.
	* sysdeps/generic/configure.in: Likewise.
	* sysdeps/i386/elf/configure.in: Likewise.
	* sysdeps/ia64/elf/configure.in: Likewise.
	* sysdeps/mach/configure.in: Likewise.
	* sysdeps/mach/hurd/configure.in: Likewise.
	* sysdeps/unix/configure.in: Likewise.
	* sysdeps/unix/common/configure.in: Likewise.
	* sysdeps/unix/sysv/aix/configure.in: Likewise.
	* sysdeps/unix/sysv/linux/configure.in: Likewise.
	* sysdeps/unix/sysv/linux/mips/configure.in: Likewise.
	* sysdeps/x86_64/elf/configure.in: Likewise.

	* aclocal.m4: Use just the bits from AS_INIT that are needed for the
	GLIBC_PROVIDES.  Use plain comment instead of HEADER-COMMENT so
	that it's obvious when extra autoconf machinery is being dragged in.

2002-10-18  Roland McGrath  <roland@redhat.com>

	* configure.in: Remove bogus echo included in
	2002-10-08  Aldy Hernandez  <aldyh@redhat.com> change.
	* configure: Regenerated.

2002-10-18  Jakub Jelinek  <jakub@redhat.com>

	* sysdeps/unix/sysv/linux/pathconf.h (statfs_link_max): Add inline.
	(statfs_filesize_max): New function.
	* sysdeps/unix/sysv/linux/linux_fsinfo.h (JFFS_SUPER_MAGIC,
	JFFS2_SUPER_MAGIC, JFS_SUPER_MAGIC, NTFS_SUPER_MAGIC,
	ROMFS_SUPER_MAGIC, UDF_SUPER_MAGIC): Define.
	* sysdeps/unix/sysv/linux/fpathconf.c (__fpathconf): Use
	statfs_filesize_max.
	* sysdeps/unix/sysv/linux/pathconf.c (__pathconf): Likewise.
	* sysdeps/unix/sysv/linux/alpha/fpathconf.c: Removed.
	* sysdeps/unix/sysv/linux/alpha/pathconf.c: Removed.

2002-10-17  Roland McGrath  <roland@redhat.com>

	* configure.in (MIG): Just AC_SUBST it here.
	* configure: Regenerated.
	* sysdeps/mach/configure.in (MIG): Do the AC_CHECK_TOOL here.
	Adding final - argument to all AC_CHECK_HEADER uses for .defs files.
	* sysdeps/mach/configure: Regenerated.

	* aclocal.m4 (GLIBC_PROVIDES): Add AC_PROVIDE([_AS_TR_SH_PREPARE])
	and AC_PROVIDE([_AS_CR_PREPARE]).

	* aclocal.m4 (GLIBC_PROVIDES): Add AC_PROVIDE([_AS_ECHO_N_PREPARE]).
	Remove AC_LANG(C) call, instead just define([_AC_LANG], [C]).

	* elf/dl-support.c: Move _dl_tls_* variables to ...
	* sysdeps/generic/libc-tls.c: ... here.

	* elf/dl-close.c (remove_slotinfo): Take new argument.  If false,
	allow IDX to be one past the current last slotinfo entry.
	(_dl_close): Pass IMAP->l_init_called for that parameter.

2002-10-07  Andreas Schwab  <schwab@suse.de>

	* aclocal.m4: Fix for autoconf 2.53.
	* configure.in: Likewise.  Require autoconf 2.53.

2002-10-08  Richard Henderson  <rth@redhat.com>

	* soft-fp/op-4.h: Handle carry correctly in
	__FP_FRAC_ADD_3, __FP_FRAC_ADD_4, __FP_FRAC_SUB_3,
	__FP_FRAC_SUB_4, __FP_FRAC_DEC_3, __FP_FRAC_DEC_4.
	* soft-fp/op-common.h: New macros _FP_DIV_MEAT_N_loop.

2002-10-08  Aldy Hernandez  <aldyh@redhat.com>

	* configure.in: Compute completely-soft.
	* config.make.in: Make completely-soft available to sub-makes.
	* sysdeps/powerpc/soft-fp/Makefile: Add gcc-single-routines and
	gcc-double-routines.  Add sim-full.c.  Add fenv_const and
	fe_nomask to libm-support.
	* sysdeps/powerpc/soft-fp/sim-full.c: New file.
	* sysdeps/powerpc/soft-fp/fraiseexcpt.c: New file.
	* sysdeps/powerpc/soft-fp/fegetexcept.c: New file.
	* sysdeps/powerpc/soft-fp/fclrexcpt.c: New file.
	* sysdeps/powerpc/soft-fp/ftestexcept.c: New file.
	* sysdeps/powerpc/soft-fp/fgetexcptflg.c: New file.
	* sysdeps/powerpc/soft-fp/fsetexcptflg.c: New file.
	* sysdeps/powerpc/soft-fp/fedisblxcpt.c: New file.
	* sysdeps/powerpc/soft-fp/feenablxcpt.c: New file.
	* sysdeps/powerpc/soft-fp/fegetenv.c: New file.
	* sysdeps/powerpc/soft-fp/fesetenv.c: New file.
	* sysdeps/powerpc/soft-fp/fegetround.c: New file.
	* sysdeps/powerpc/soft-fp/fesetround.c: New file.
	* sysdeps/powerpc/soft-fp/feupdateenv.c: New file.
	* sysdeps/powerpc/soft-fp/feholdexcpt.c: New file.
	* sysdeps/powerpc/soft-fp/fenv_const.c: New file.
	* sysdeps/powerpc/soft-fp/libm-test-ulps: New file.
	* sysdeps/powerpc/soft-fp/soft-supp.h: New file.
	* sysdeps/powerpc/soft-fp/Versions: Add libgcc soft-float
	symbols.  Add __sim_disabled_exceptions, __sim_exceptions,
	__sim_round_mode.
	* sysdeps/powerpc/soft-float/Dist: Add sim-full.c, fenv_const.c.
	* sysdeps/powerpc/soft-float/sfp-machine.h: Define
	FP_HANDLE_EXCEPTIONS.
	Define FP_ROUNDMODE.
	Redefine FP_* macros to correspond to the FE_* bit positions.
	Define FP_DIV_MEAT_S to _FP_DIV_MEAT_1_loop.
	Define externs for __sim_exceptions, __sim_disabled_exceptions,
	__sim_round_mode, __simulate_exceptions.
	* sysdeps/powerpc/fpu/bits/fenv.h: Move file from here...
	* sysdeps/powerpc/bits/fenv.h: ...to here.

2002-10-06  Jakub Jelinek  <jakub@redhat.com>

	* sysdeps/powerpc/powerpc32/dl-machine.c (__process_machine_rela):
	Store R_PPC_UADDR32 and R_PPC_UADDR16 one byte at a time.
	Use __builtin_expect for R_PPC_ADDR24 overflow check.  Fix
	R_PPC_ADDR16, R_PPC_UADDR16 and R_PPC_ADDR14* overflow check, use
	__builtin_expect.

2002-10-15  Jakub Jelinek  <jakub@redhat.com>

	* include/resolv.h (__libc_res_nquery, __libc_res_nsearch,
	__libc_res_nsend): New prototypes.
	* resolv/res_query.c (QUERYSIZE): Define.
	(__libc_res_nquery): Renamed from res_nquery.  Added answerp
	argument.  Allocate only QUERYSIZE bytes first, if res_nmkquery
	fails use MAXPACKET buffer.  Call __libc_res_nsend instead of
	res_nsend, pass answerp.
	(res_nquery): Changed into wrapper around __libc_res_nquery.
	(__libc_res_nsearch): Renamed from res_nsearch.  Added answerp
	argument.  Call __libc_res_nquerydomain and __libc_res_nquery
	instead of the non-__libc_ variants, pass them answerp.
	(res_nsearch): Changed into wrapper around __libc_res_nsearch.
	(__libc_res_nquerydomain): Renamed from res_nquerydomain.
	Added answerp argument.  Call __libc_res_nquery instead of
	res_nquery, pass answerp.
	(res_nquerydomain): Changed into wrapper around
	__libc_res_nquerydomain.
	* resolv/res_send.c: Include sys/ioctl.h.
	(MAXPACKET): Define.
	(send_vc): Change arguments.  Reallocate answer buffer if it is
	too small.
	(send_dg): Likewise.
	(__libc_res_nsend): Renamed from res_nsend.  Added ansp argument.
	Reallocate answer buffer if it is too small and hooks are in use.
	Adjust calls to send_vc and send_dg.
	(res_nsend): Changed into wrapper around __libc_res_nsend.
	* resolv/nss_dns/dns-host.c (_nss_dns_gethostbyname2_r): Allocate
	just 1K answer buffer on the stack, use __libc_res_nsearch instead
	of res_nsearch.
	(_nss_dns_gethostbyaddr_r): Similarly with __libc_res_nquery.
	* resolv/nss_dns/dns-network.c (_nss_dns_getnetbyaddr_r): Likewise.
	(_nss_dns_getnetbyname_r): Similarly with __libc_res_nsearch.
	* resolv/gethnamaddr.c (gethostbyname2): Likewise.
	(gethostbyaddr): Similarly with __libc_res_nquery.
	* resolv/Versions (libresolv): Export __libc_res_nquery and
	__libc_res_nsearch at GLIBC_PRIVATE.

2002-10-17  Roland McGrath  <roland@redhat.com>

	* configure.in: Grok --without-__thread and disable HAVE___THREAD.
	* configure: Regenerated.

	* sysdeps/x86_64/dl-machine.h (elf_machine_rela): Do CHECK_STATIC_TLS
	before performing the reloc, not after.
	* sysdeps/i386/dl-machine.h (elf_machine_rel): Likewise.

2002-10-17  Ulrich Drepper  <drepper@redhat.com>

	* locale/programs/locale.c (write_locales): Use 'm' flag in fopen call.
	* locale/programs/linereader.c (lr_open): Likewise.
	* locale/programs/charmap-dir.c (charmap_open): Likewise.
	* locale/programs/locarchive.c (add_locale_to_archive): Likewise.

2002-10-17  Isamu Hasegawa  <isamu@yamato.ibm.com>

	* posix/bug-regex11.c: Add a test case for the bug reported by
	Paolo Bonzini <bonzini@gnu.org>.
	* posix/regexec.c (sift_states_bkref): Use correct destination of
	the back reference.

2002-10-17  Roland McGrath  <roland@redhat.com>

	* elf/dl-load.c (_dl_map_object_from_fd): Don't check DF_STATIC_TLS.
	* elf/dl-reloc.c (_dl_relocate_object: CHECK_STATIC_TLS): New macro
	to signal error if an IE-model TLS reloc resolved to a dlopen'd module.
	* sysdeps/i386/dl-machine.h (elf_machine_rel, elf_machine_rela):
	Call it after performing TPOFF relocs.
	* sysdeps/x86_64/dl-machine.h (elf_machine_rela): Likewise.
	* sysdeps/sh/dl-machine.h (elf_machine_rela): Likewise.
	* elf/dl-conflict.c (CHECK_STATIC_TLS): New macro (no-op).

	* elf/dl-close.c (remove_slotinfo): Change asserts so as not to crash
	when closing a partially-initialized object.

	* elf/dl-load.c (_dl_map_object_from_fd) [! USE_TLS]: Call lose
	instead of _dl_fatal_printf when we see PT_TLS.

	* Makeconfig (CPPFLAGS): Fix last change to use $(libof-$(<F))
	instead of $(libof-$<).

2002-10-16  Roland McGrath  <roland@redhat.com>

	* cppflags-iterator.mk (CPPFLAGS-$(cpp-src)): Variable removed.
	instead of += to append, to be sure $(lib) gets expanded at defn time.
	(libof-$(cpp-src)): New variable, define this instead.
	* extra-lib.mk (cpp-srcs-left): Reduce duplication in include setup.
	(lib): Don't use override.
	(CPPFLAGS-$(lib)): New variable, put -D's here.
	* Makeconfig (CPPFLAGS): Use basename fn for CPPFLAGS-basename.
	Also add $(CPPFLAGS-LIB) before the file-specific flags, for each
	LIB found by $(libof-*) for basename, target, or source.
	* Makerules (CPPFLAGS-nonlib): New variable.
	* nscd/Makefile (lib): Set to nonlib when using cppflags-iterator.mk.
	* locale/Makefile (lib): Likewise.
	* sunrpc/Makefile (lib): Likewise.

	* sysdeps/unix/sysv/linux/fpathconf.c (LINUX_LINK_MAX): Move macro ...
	* sysdeps/unix/sysv/linux/linux_fsinfo.h (LINUX_LINK_MAX): ... here.
	* sysdeps/unix/sysv/linux/pathconf.h: New file.
	(statfs_link_max): New function, guts from fpathconf.c.
	* sysdeps/unix/sysv/linux/fpathconf.c: Rewritten using that.
	* sysdeps/unix/sysv/linux/pathconf.c (__pathconf): Likewise.
	* sysdeps/unix/sysv/linux/alpha/pathconf.c (__pathconf): Rewritten
	to use the linux/pathconf.c code by #include rather than duplication.
	* sysdeps/unix/sysv/linux/alpha/fpathconf.c (__pathconf): Likewise.

2002-10-16  Jakub Jelinek  <jakub@redhat.com>

	* sysdeps/unix/sysv/linux/x86_64/sysdep.h (SYSCALL_ERROR_HANDLER):
	Use __libc_errno only for libc itself.

2002-10-16  Andreas Jaeger  <aj@suse.de>

	* sysdeps/x86_64/_mcount.S: Fix off-by-1 error in argument access.

2002-10-16  Ulrich Drepper  <drepper@redhat.com>

	* sysdeps/unix/sysv/linux/i386/sysdep.h (SYSCALL_ERROR_HANDLER):
	Use __libc_errno only for libc itself.

2002-10-15  Roland McGrath  <roland@redhat.com>
	    Jakub Jelinek  <jakub@redhat.com>

	* sysdeps/unix/sysv/linux/Makefile
	($(objpfx)syscall-%.h $(objpfx)syscall-%.d): Take code from
	sparc/Makefile to produce a bi-arch file as needed.
	That's now parameterized by the variable $(64bit-predefine).
	Use LC_ALL=C for `comm' commands in that rule.
	No longer conditional on [$(no_syscall_list_h)].
	* sysdeps/unix/sysv/linux/sparc/Makefile: Remove replacement rules.
	(64bit-predefine): New variable.
	* sysdeps/unix/sysv/linux/x86_64/Makefile: Likewise.
	* sysdeps/unix/sysv/linux/s390/Makefile: New file.
	* sysdeps/unix/sysv/linux/powerpc/Makefile
	(64bit-predefine): New variable.

2002-10-15  Roland McGrath  <roland@redhat.com>

	* sysdeps/unix/sysv/linux/Makefile
	($(objpfx)syscall-%.h $(objpfx)syscall-%.d)

	* login/utmp-private.h: Declare __libc_utmp_lock.
	* sysdeps/unix/getlogin_r.c (getlogin_r): Take __libc_utmp_lock once
	and call __libc_utmp_jump_table functions directly, instead of using
	__setutent et al.

	* sysdeps/unix/sysv/linux/configure.in: Use case instead of if.
	* sysdeps/unix/sysv/linux/configure: Regenerated.

	* sysdeps/gnu/bits/utmp.h: Include <bits/wordsize.h>.
	(struct lastlog) [__WORDSIZE == 64 && __WORDSIZE_COMPAT32]:
	Use int32_t for ll_time.
	(struct utmp) [__WORDSIZE == 64 && __WORDSIZE_COMPAT32]:
	Use int32_t instead of long int for ut_session.
	Use an anonymous struct with 32-bit fields for ut_tv.
	* sysdeps/gnu/bits/utmpx.h: Include <bits/wordsize.h>.
	(struct utmpx) [__WORDSIZE == 64 && __WORDSIZE_COMPAT32]: Do the same
	here as in utmp.h for `struct utmp'.
	* sysdeps/unix/sysv/linux/powerpc/bits/utmp.h: File removed.
	* sysdeps/unix/sysv/linux/powerpc/bits/utmpx.h: File removed.
	* sysdeps/unix/sysv/linux/sparc/bits/utmp.h: File removed.
	* sysdeps/unix/sysv/linux/sparc/bits/utmpx.h: File removed.
	* sysdeps/unix/sysv/linux/x86_64/bits/utmp.h: File removed.
	* sysdeps/unix/sysv/linux/x86_64/bits/utmpx.h: File removed.

	* sysdeps/unix/sysv/linux/bits/resource.h: Replaced with the contents
	of the sysdeps/unix/sysv/linux/i386/bits/resource.h file.
	All the following files were identical or equivalent to it.
	* sysdeps/unix/sysv/linux/i386/bits/resource.h: File removed.
	* sysdeps/unix/sysv/linux/arm/bits/resource.h: File removed.
	* sysdeps/unix/sysv/linux/cris/bits/resource.h: File removed.
	* sysdeps/unix/sysv/linux/hppa/bits/resource.h: File removed.
	* sysdeps/unix/sysv/linux/ia64/bits/resource.h: File removed.
	* sysdeps/unix/sysv/linux/m68k/bits/resource.h: File removed.
	* sysdeps/unix/sysv/linux/powerpc/bits/resource.h: File removed.
	* sysdeps/unix/sysv/linux/s390/bits/resource.h: File removed.
	* sysdeps/unix/sysv/linux/sh/bits/resource.h: File removed.
	* sysdeps/unix/sysv/linux/x86_64/bits/resource.h: File removed.

	* sysdeps/unix/sysv/linux/bits/socket.h (struct msghdr): Use size_t
	instead of int for msg_iovlen, instead of socklen_t for msg_controllen.
	Other than the previously incorrect sign of msg_iovlen, this is a
	no-op on 32-bit platforms.  On 64-bit platforms it makes this header
	match their layouts as well, so the following are now identical to it.
	* sysdeps/unix/sysv/linux/s390/bits/socket.h: File removed.
	* sysdeps/unix/sysv/linux/sparc/bits/socket.h: File removed.
	* sysdeps/unix/sysv/linux/x86_64/bits/socket.h: File removed.
	* sysdeps/unix/sysv/linux/ia64/bits/socket.h: File removed.
	* sysdeps/unix/sysv/linux/alpha/bits/socket.h: File removed.

2002-10-15  Ulrich Drepper  <drepper@redhat.com>

	* sysdeps/unix/sysv/linux/kernel-features.h (__ASSUME_VFORK_SYSCALL):
	Define for 2.4+ kernels.

	* sysdeps/unix/sysv/linux/i386/vfork.S: Optimize for kernels which
	are known to have the vfork syscall.  Don't confuse the CPUs
	branch prediction unit by jumping to the return address.

	* sysdeps/unix/sysv/linux/alpha/fpathconf.c (__fpathconf): Add
	support for reiserfs and xfs.

	* sysdeps/unix/sysv/linux/fpathconf.c (__fpathconf): Add case for
	XFS link count.
	* sysdeps/unix/sysv/linux/linux_fsinfo.h: Define XFS_SUPER_MAGIC
	and XFS_LINK_MAX.
	Patch by Eric Sandeen <sandeen@sgi.com> [PR libc/4706].

2002-10-16  Jakub Jelinek  <jakub@redhat.com>

	* include/libc-symbols.h (attribute_tls_model_ie): Define.
	* include/errno.h (errno): Define to __libc_errno in libc.so.
	Add attribute_tls_model_ie.
	* include/netdb.h (h_errno): Define to __libc_h_errno in libc.so.
	Add attribute_tls_model_ie.
	* include/resolv.h (_res): Define to __libc_res in libc.so.  Add
	attribute_tls_model_ie.
	* inet/herrno.c (__libc_h_errno): Add hidden alias to h_errno.
	(h_errno): Define.
	* resolv/res_libc.c (__libc_res): Add hidden alias to _res.
	(_res): Define.
	* sysdeps/generic/bits/libc-tsd.h (__libc_tsd_define): Add
	attribute_tls_model_ie.
	* sysdeps/generic/errno-loc.c (errno): Only undefine if not using
	__thread.
	* sysdeps/generic/errno.c (__libc_errno): Add hidden alias to errno.
	* sysdeps/unix/sysv/linux/i386/sysdep.h (SYSCALL_ERROR_HANDLER): Use
	__libc_errno in USE___THREAD case.
	* sysdeps/unix/sysv/linux/x86_64/sysdep.h (SYSCALL_ERROR_HANDLER):
	Likewise.
	* configure.in (HAVE_TLS_MODEL_ATTRIBUTE): Check for
	__attribute__((tls_model (""))).
	* configure: Rebuilt.
	* config.h.in (HAVE_TLS_MODEL_ATTRIBUTE): Add.

2002-10-15  Ulrich Drepper  <drepper@redhat.com>

	* timezone/asia: Update from tzdata2002d.
	* timezone/australasia: Likewise.
	* timezone/iso3166.tab: Likewise.
	* timezone/southamerica: Likewise.
	* timezone/zone-tab: Likewise.

2002-10-15  Roland McGrath  <roland@redhat.com>

	* sysdeps/generic/dl-tls.c (_dl_deallocate_tls) [TLS_TCB_AT_TP]:
	Adjust TCB pointer before calling free, so we get the whole block.

2002-10-14  Roland McGrath  <roland@redhat.com>

	* sysdeps/unix/sysv/linux/x86_64/sigaction.c
	[HAVE_HIDDEN && !HAVE_BROKEN_VISIBILITY_ATTRIBUTE]: Declare restore_rt
	extern using attribute_hidden instead of static, avoids warning.

2002-10-09  Jakub Jelinek  <jakub@redhat.com>

	* sysdeps/unix/sysv/linux/configure.in: Use */lib64 for s390x too.
	* sysdeps/unix/sysv/linux/configure: Rebuilt.

2002-10-14  Ulrich Drepper  <drepper@redhat.com>

	* po/sv.po: Update from translation team.

2002-10-12  H.J. Lu  <hjl@gnu.org>

	* sunrpc/thrsvc.c (PROCQUIT): New.
	(struct rpc_arg): New.
	(dispatch): Call exit (0) if request->rq_proc == PROCQUIT.
	(test_one_call): Take struct rpc_arg * instead of CLIENT *c.
	(thread_wrapper): Modified for struct rpc_arg * and call PROCQUIT.
	(main): Modified for struct rpc_arg *.

2002-10-14  Ulrich Drepper  <drepper@redhat.com>

	* dirent/scandir.c: Rearrange code a bit to reduce binary size.

2002-10-14  Jakub Jelinek  <jakub@redhat.com>

	* sysdeps/unix/sysv/linux/x86_64/sysdep.h: Include tls.h.
	(SYSCALL_ERROR_HANDLER): Use RTLD_PRIVATE_ERRNO sequence
	in ld.so even if __thread is supported.

2002-10-13  Jakub Jelinek  <jakub@redhat.com>

	* sysdeps/unix/sysv/linux/arm/profil-counter.h (profil_counter):
	Add hack to prevent the compiler from clobbering the signal context.
	* sysdeps/unix/sysv/linux/sh/profil-counter.h (profil_counter):
	Likewise.
	* sysdeps/unix/sysv/linux/x86_64/profil-counter.h (profil_counter):
	Likewise.

2002-10-14  Andreas Jaeger  <aj@suse.de>

	* sysdeps/mips/fpu/libm-test-ulps: Regenerated by
	Guido Guenther <agx@sigxcpu.org>.

2002-10-14  Ulrich Drepper  <drepper@redhat.com>

	* po/sk.po: Update from translation team.

2002-09-26  Roland McGrath  <roland@redhat.com>

	* elf/dl-load.c (_dl_dst_count, _dl_dst_substitute): Handle $LIB
	dynamic string tag.
	* elf/Makefile ($(objpfx)trusted-dirs.st): Make the output define
	DL_DST_LIB based on $(slibdir).

2002-10-13  Roland McGrath  <roland@frob.com>

	* elf/rtld-Rules ($(objpfx)rtld-libc.a): Use $(verbose) in ar command.

	* sysdeps/mach/hurd/getresuid.c: New file.
	* sysdeps/mach/hurd/getresgid.c: New file.
	* sysdeps/mach/hurd/setresuid.c: New file.
	* sysdeps/mach/hurd/setresgid.c: New file.

	* posix/unistd.h [__USE_GNU] (getresuid, getresgid, setresuid,
	setresgid): Declare them.
	* NEWS: Mention it.
	* include/unistd.h
	(__getresuid, __getresgid, __setresuid, __setresgid): Declare them,
	add libc_hidden_proto.
	* posix/Versions (libc: GLIBC_2.3.2): New set.  Add
	getresuid, getresgid, setresuid, setresgid here.
	* Versions.def (libc): Define GLIBC_2.3.2 set.
	* sysdeps/generic/getresuid.c (__getresuid): Fix argument types.
	Add libc_hidden_def.
	* sysdeps/generic/getresgid.c (__getresgid): Likewise.
	* sysdeps/generic/setresgid.c: New file.
	* sysdeps/generic/setresuid.c: New file.
	* sysdeps/unix/sysv/linux/Makefile [$(subdir) = misc]
	(sysdep_routines): Don't add getresuid and getresgid here.
	* sysdeps/unix/sysv/linux/arm/Makefile [$(subdir) = misc]
	(sysdep_routines): Don't add setresuid and setresgid here.
	* sysdeps/unix/sysv/linux/cris/Makefile: Likewise.
	* sysdeps/unix/sysv/linux/sh/Makefile: Likewise.
	* sysdeps/unix/sysv/linux/s390/s390-32/Makefile: Likewise.
	* sysdeps/unix/sysv/linux/s390/s390-64/Makefile: Likewise.
	* sysdeps/unix/sysv/linux/i386/Makefile: Likewise.
	* sysdeps/unix/sysv/linux/m68k/Makefile: Likewise.
	* posix/Makefile (routines): Add them all here instead.
	* sysdeps/unix/sysv/linux/i386/getresuid.c (getresuid): Renamed to
	__getresuid.  Add libc_hidden_def for that, and weak alias to old name.
	* sysdeps/unix/sysv/linux/i386/getresgid.c (getresgid): Renamed to
	__getresgid.  Add libc_hidden_def for that, and weak alias to old name.
	* sysdeps/unix/sysv/linux/i386/setresuid.c: Add libc_hidden_def.
	[! __NR_setresuid]: Include generic file.
	* sysdeps/unix/sysv/linux/i386/setresgid.c (setresgid): Renamed to
	__setresgid.  Add libc_hidden_def for that, and weak alias to old name.
	[! __NR_setresuid]: Include generic file.
	* sysdeps/unix/sysv/linux/syscalls.list (setresuid, setresgid):
	Caller is - now, not EXTRA.
	* sysdeps/unix/sysv/linux/sparc/sparc32/syscalls.list
	(setresuid, setresgid, getresuid, getresgid): Likewise.
	* sysdeps/unix/sysv/linux/syscalls.list (getresuid, getresgid):
	Add these calls here.
	* sysdeps/unix/sysv/linux/alpha/syscalls.list: Remove them here.
	* sysdeps/unix/sysv/linux/hppa/syscalls.list: Likewise.
	* sysdeps/unix/sysv/linux/sparc/sparc64/syscalls.list: Likewise.
	* sysdeps/unix/sysv/linux/s390/s390-64/syscalls.list: Likewise.
	* sysdeps/unix/sysv/linux/x86_64/syscalls.list: Likewise.
	* sysdeps/unix/sysv/linux/powerpc/powerpc32/syscalls.list: Likewise.
	* sysdeps/unix/sysv/linux/powerpc/powerpc64/syscalls.list: Likewise.
	* sysdeps/unix/sysv/linux/mips/syscalls.list: Likewise.
	* sysdeps/unix/sysv/linux/ia64/syscalls.list: Likewise.

	* sysdeps/unix/sysv/linux/Makefile [$(subdir) = misc]
	(sysdep_routines): Add setfsuid and setfsgid here.
	* sysdeps/unix/sysv/linux/arm/Makefile: Not here.
	* sysdeps/unix/sysv/linux/sparc/sparc32/Makefile: Likewise.
	* sysdeps/unix/sysv/linux/cris/Makefile: Likewise.
	* sysdeps/unix/sysv/linux/sh/Makefile: Likewise.
	* sysdeps/unix/sysv/linux/s390/s390-32/Makefile: Likewise.
	* sysdeps/unix/sysv/linux/s390/s390-64/Makefile: Likewise.
	* sysdeps/unix/sysv/linux/i386/Makefile: Likewise.
	* sysdeps/unix/sysv/linux/m68k/Makefile: Likewise.

	* hurd/errno.c: Renamed to ...
	* hurd/errno-loc.c: ... this.
	* hurd/Makefile (routines): errno -> errno-loc

2002-10-13  Ulrich Drepper  <drepper@redhat.com>

	* po/de.po: Update from translation team.

	* MakeTAGS: Add -E flag to xgettext runs.

2002-10-12  Ulrich Drepper  <drepper@redhat.com>

	* po/fr.po: Update from translation team.

	* sysdeps/posix/system.c: Remove support for old and buggy SCO systems.
	Optimize a bit for use in glibc.

2002-10-12  Roland McGrath  <roland@redhat.com>

	* stdio-common/tst-rndseek.c (TIMEOUT): Increase to 10 seconds.
	Some machines are slow.  Guido Guenther <agx@sigxcpu.org> has one.

2002-10-12  Ulrich Drepper  <drepper@redhat.com>

	* po/sv.po: Update from translation team.

2002-10-11  Isamu Hasegawa  <isamu@yamato.ibm.com>

	* posix/regcomp.c (re_compile_fastmap_iter): Remove the handling
	OP_CONTEXT_NODE.
	(regfree): Likewise.
	(create_initial_state): Likewise.
	(analyze): Remove the substitutions which became useless.
	(calc_first): Likewise.
	(calc_epsdest): Use edests of OP_BACK_REF in case that it has
	epsilon destination.
	(duplicate_node_closure): New function.
	(duplicate_node): Remove the handling OP_CONTEXT_NODE.
	(calc_inveclosure): Likewise.
	(calc_eclosure): Likewise.
	(calc_eclosure_iter): Invoke duplicate_node_closure instead of
	direct invocation of duplicate_node.
	(parse): Don't use comma operator in the return to avoid compiler
	warning.
	(parse_reg_exp): Likewise.
	(parse_branch): Likewise.
	(parse_expression): Likewise.
	(parse_sub_exp): Likewise.
	(parse_dup_op): Likewise.
	* posix/regex_internal.c (re_dfa_add_node): Remove the substitutions
	which became useless.
	(create_ci_newstate): Remove the handling OP_CONTEXT_NODE.
	(create_cd_newstate): Likewise.
	* posix/regex_internal.h (re_token_type_t): Remove the obsolete type.
	(re_token_t): Likewise.
	(re_dfa_t): Likewise.
	(re_node_set_remove): New macro.
	* posix/regexec.c (check_matching): Remove the handling
	OP_CONTEXT_NODE.
	(check_halt_node_context): Likewise.
	(proceed_next_node): Likewise.
	(pop_fail_stack): Fix the memory leak.
	(set_regs): Likewise.
	(free_fail_stack_return): New function.
	(sift_states_backward): Fix the memory leak.  Remove the handling
	OP_CONTEXT_NODE.
	(update_cur_sifted_state): Append some if clause to avoid redundant
	call.
	(sub_epsilon_src_nodes): Use IS_EPSILON_NODE since it might be a
	back reference.
	(check_dst_limits): Remove the handling OP_CONTEXT_NODE.
	(check_subexp_limits): Likewise.
	(search_subexp): Likewise.
	(sift_states_bkref): Likewise.
	(transit_state_mb): Likewise.
	(transit_state_bkref_loop): Likewise.
	(transit_state_bkref_loop): Likewise.
	(group_nodes_into_DFAstates): Likewise.
	(check_node_accept): Likewise.
	(sift_ctx_init): Add initializing.

2002-10-12  Ulrich Drepper  <drepper@redhat.com>

	* sysdeps/unix/sysv/linux/i386/sysdep.h (INLINE_SYSCALL): Use
	__builtin_expect.

2002-10-11  Ulrich Drepper  <drepper@redhat.com>

	* elf/dl-load.c (_dl_map_object_from_fd): Remove unnecessarily
	duplicated variable c.

	* sysdeps/unix/sysv/linux/sigwait.c (__sigwait): Use INTERNAL_SYSCALL
	if possible.

	* sysdeps/unix/sysv/linux/i386/sysdep.h
	(INTERNAL_SYSCALL_ERROR_P): New define.
	(INTERNAL_SYSCALL_ERRNO): Likewise.

	* sysdeps/unix/sysv/linux/i386/profil-counter.h (profil_counter):
	Add hack to prevent the compiler from clobbering the signal context.

2002-10-11  Roland McGrath  <roland@redhat.com>

	* sysdeps/unix/sysv/linux/x86_64/sysdep.h (SYSCALL_ERROR_HANDLER):
	Fix typos.

	* sysdeps/generic/dl-lookupcfg.h: Include <tls.h>.
	* sysdeps/sh/dl-lookupcfg.h: File removed.
	* sysdeps/i386/dl-lookupcfg.h: File removed.

	* sysdeps/unix/sysv/linux/x86_64/sysdep.h (SYSCALL_ERROR_HANDLER): Add
	missing labels and ; from last change.

	* stdio-common/tst-sscanf.c (val_double): Append .0 to large whole
	number literals, so they are doubles instead of ints.

2002-10-09  Roland McGrath  <roland@redhat.com>

	* sysdeps/generic/bits/libc-tsd.h [USE___THREAD]: Conditional
	changed from [USE_TLS && HAVE___THREAD].

	* sysdeps/i386/dl-machine.h (elf_machine_type_class, elf_machine_rel):
	Disable TLS relocs if [RTLD_BOOTSTRAP && !USE___THREAD].
	* sysdeps/x86_64/dl-machine.h
	(elf_machine_type_class, elf_machine_rela): Likewise.
	* sysdeps/sh/dl-machine.h (elf_machine_type_class, elf_machine_rela):
	Likewise.

	* include/link.h (struct link_map): Remove member l_tls_tp_initialized.
	* elf/rtld.c (_dl_start_final, dl_main): Don't use it.
	(_dl_start): Conditionalize PT_TLS check on [USE___THREAD].

	* sysdeps/i386/dl-tls.h (__TLS_GET_ADDR): Use ___tls_get_addr_internal
	instead of ___tls_get_addr.
	(___tls_get_addr_internal): Add attribute_hidden to decl.

	* sysdeps/generic/ldsodefs.h (struct rtld_global): New variable
	_dl_error_catch_tsd.
	* elf/rtld.c (startup_error_tsd): New function.
	(dl_main): Point _dl_error_catch_tsd at that.
	* elf/dl-error.c: Don't use libc-tsd.h for DL_ERROR,
	use new function pointer instead.
	* elf/dl-tsd.c: New file.
	* elf/Makefile (routines): Add it.

2002-10-07  Roland McGrath  <roland@redhat.com>

	* elf/dl-misc.c (_dl_debug_vdprintf): Use INTERNAL_SYSCALL macro for
	writev if it's available.  Otherwise if [RTLD_PRIVATE_ERRNO] then
	take _dl_load_lock around calling __writev.

	* sysdeps/unix/sysv/linux/i386/sysdep.h (INTERNAL_SYSCALL): New macro.
	(INLINE_SYSCALL): Use that.

	* sysdeps/generic/dl-sysdep.h: New file.
	* sysdeps/mach/hurd/dl-sysdep.h: New file.
	* sysdeps/generic/ldsodefs.h: Include <dl-sysdep.h>.
	* include/errno.h [IS_IN_rtld]: Include <dl-sysdep.h> to define ...
	[RTLD_PRIVATE_ERRNO]: Use a hidden global variable for errno and
	access it directly.
	* elf/dl-minimal.c (__errno_location): Removed.
	* sysdeps/unix/i386/sysdep.S (__syscall_errno) [RTLD_PRIVATE_ERRNO]:
	Use GOTOFF access for errno.
	* sysdeps/unix/sysv/linux/i386/sysdep.h
	[RTLD_PRIVATE_ERRNO] (SYSCALL_ERROR_HANDLER): Likewise.

	* sysdeps/unix/x86_64/sysdep.S (__syscall_errno) [RTLD_PRIVATE_ERRNO]:
	Use PC-relative access for errno.
	* sysdeps/unix/sysv/linux/x86_64/sysdep.h
	[RTLD_PRIVATE_ERRNO] (SYSCALL_ERROR_HANDLER): Likewise.

	* include/tls.h: New file.
	(USE___THREAD): New macro.
	Define to 1 under [USE_TLS && HAVE___THREAD] and only when compiling
	libc or libpthread.
	* sysdeps/unix/sysv/linux/i386/sysdep.h [USE___THREAD]: Conditional
	changed from [USE_TLS && HAVE___THREAD].
	* sysdeps/unix/sysv/linux/x86_64/sysdep.h: Likewise.
	* sysdeps/unix/i386/sysdep.S: Likewise.
	* sysdeps/unix/x86_64/sysdep.S: Likewise.
	* include/errno.h: Likewise.
	* include/netdb.h: Likewise.
	* include/resolv.h: Likewise.

	* sysdeps/generic/errno.c: New file.
	* csu/Makefile (aux): New variable, list errno.
	* sysdeps/unix/sysv/linux/i386/sysdep.S (errno, _errno): Remove defns.
	* sysdeps/unix/sysv/linux/m68k/sysdep.S: Likewise.
	* sysdeps/unix/sysv/linux/x86_64/sysdep.S: Likewise.
	* sysdeps/unix/sysv/linux/s390/s390-64/sysdep.S: Likewise.
	* sysdeps/unix/sysv/linux/s390/s390-32/sysdep.S: Likewise.
	* sysdeps/unix/sysv/linux/arm/sysdep.S: Likewise.
	* sysdeps/unix/sysv/linux/cris/sysdep.S: Likewise.
	* sysdeps/unix/sysv/linux/hppa/sysdep.c: Likewise.
	* sysdeps/unix/sysv/linux/ia64/sysdep.S: Likewise.
	* sysdeps/unix/sysv/linux/powerpc/sysdep.c: Likewise.
	* sysdeps/unix/sysv/linux/sparc/sysdep.S: Likewise.
	* sysdeps/unix/sysv/linux/sh/sysdep.S: Likewise.
	* sysdeps/unix/alpha/sysdep.S: Likewise.
	* sysdeps/generic/start.c: Likewise.
	* sysdeps/unix/start.c: Likewise.
	* sysdeps/unix/arm/start.c: Likewise.
	* sysdeps/unix/bsd/ultrix4/mips/start.S: Likewise.
	* sysdeps/unix/sparc/start.c: Likewise.
	* sysdeps/unix/sysv/irix4/start.c: Likewise.
	* sysdeps/unix/sysv/linux/mips/sysdep.S: File removed.

	* manual/search.texi (Tree Search Function, Hash Search Function):
	Mention search.h clearly.

2002-10-05  Roland McGrath  <roland@redhat.com>

	* elf/dl-fxstat64.c: File removed.
	* elf/dl-xstat64.c: File removed.
	* elf/Makefile (rtld-routines): Remove them.
	* sysdeps/unix/sysv/linux/xstat64.c: Remove RTLD_STAT64 conditionals.
	Instead, use strong_alias instead of versioned_symbol in the
	!SHLIB_COMPAT case.
	* sysdeps/unix/sysv/linux/fxstat64.c: Likewise.
	* sysdeps/unix/sysv/linux/lxstat64.c: Likewise.

	* include/shlib-compat.h
	(SHLIB_COMPAT): Require that IS_IN_##lib be defined nonzero.
	[! NOT_IN_libc] (IS_IN_libc): Define it.
	* cppflags-iterator.mk (CPPFLAGS-$(cpp-src)): Use -Dx=1 not just -Dx.
	* elf/Makefile (CPPFLAGS-.os): Likewise.

	* sunrpc/rpc_main.c (main): Don't declare with noreturn attribute.
	Return the status instead of calling exit.

	* Makeconfig (CFLAGS): Prepend -std=gnu99.
	* Makerules (+make-deps): Use $(CFLAGS) only for .c sources.
	Remove superfluous rm command, whose @ plus make bugs hid
	all these commands from the make output.

	* include/stubs-prologue.h: New file.  Give #error under #ifdef _LIBC.
	* Makefile ($(inst_includedir)/gnu/stubs.h): Depend on it.
	Use that file's contents instead of literal echo's for the prologue.
	* include/features.h: Include <gnu/stubs.h> unconditionally.
	* include/gnu/stubs.h: New file.

2002-09-30  Roland McGrath  <roland@redhat.com>

	* elf/rtld-Rules: New file.
	* elf/Makefile ($(objpfx)librtld.map, $(objpfx)librtld.mk,
	$(objpfx)rtld-libc.a): New targets.
	(generated): Add them.
	(reloc-link): Remove -o $@ from the variable.
	($(objpfx)dl-allobjs.os): Add -o $@ after $(reloc-link).
	(distribute): Add rtld-Rules.
	(CPPFLAGS-.os): Define this instead of CFLAGS-.os.
	* Makerules ($(+sysdir_pfx)sysd-rules): Emit rules for rtld-% targets.
	(common-mostlyclean, common-clean): Clean up rtld-* files.
	* sysdeps/unix/make-syscalls.sh: Add rtld-*.os target name to rules.

2002-10-11  Roland McGrath  <roland@redhat.com>

	* sysdeps/generic/dl-tls.c (__tls_get_addr): After freeing block in
	now-unused dtv slot, reset the slot to TLS_DTV_UNALLOCATED.

	* elf/tls-macros.h [__x86_64__] (TLS_GD): Fix the sequence with the
	proper set of no-op insn prefixes.

	* elf/tst-tls8.c (do_test): Use %zd format for l_tls_modid members.

2002-10-11  Ulrich Drepper  <drepper@redhat.com>

	* sysdeps/unix/sysv/linux/execve.c: Don't try calling
	__pthread_kill_other_threads_np.

	* sysdeps/generic/pselect.c: Avoid unnecessary sigprocmask calls.

2002-10-08  Roland McGrath  <roland@redhat.com>

	* locale/newlocale.c (__newlocale): If setting all categories to "C",
	just return &_nl_C_locobj instead of copying it.
	* locale/freelocale.c (__freelocale): Check for &_nl_C_locobj.
	* locale/duplocale.c (__duplocale): Likewise.

2002-10-07  Roland McGrath  <roland@frob.com>

	* config.h.in (HAVE_I386_SET_GDT): New #undef.
	* sysdeps/mach/configure.in: Define it with new check for i386_set_gdt.
	* sysdeps/mach/configure: Regenerated.

2002-10-06  Franz Sirl  <Franz.Sirl-kernel@lauterbach.com>

	* sysdeps/unix/sysv/linux/powerpc/powerpc32/sysdep.h (INLINE_SYSCALL):
	Add all necessary register outputs for syscall-clobbered registers.

2002-10-02  David Mosberger  <davidm@hpl.hp.com>

	* sysdeps/ia64/bzero.S: Rewritten by Sverre Jarp to tune for
	Itanium 2 (and Itanium).
	Fix unwind directives and make it fit in 80 columns.
	* sysdeps/ia64/memset.S: Likewise.
	* sysdeps/ia64/memcpy.S: Likewise.
	Move jump table to .rodata section.

2002-10-03  Roland McGrath  <roland@frob.com>

	* sysdeps/mach/hurd/i386/init-first.c (_hurd_stack_setup): Add
	clobbers to asm.

2002-10-10  Andreas Jaeger  <aj@suse.de>

	* sysdeps/x86_64/_mcount.S: Restore correct registers.

2002-10-10  Ulrich Drepper  <drepper@redhat.com>

	* posix/Versions (libc) [GLIBC_PRIVATE]: Add __pselect.

2002-10-09  Ulrich Drepper  <drepper@redhat.com>

	* sysdeps/generic/ldsodefs.h: Remove attribute_hidden from
	_dl_allocate_tls_init.  Add rtld_hidden_proto.
	* sysdeps/generic/dl-tls.c (_dl_allocate_tls_init): Add
	rtld_hidden_def.
	* elf/Versions (ld) [GLIBC_PRIVATE]: Add _dl_allocate_tls_init.

	* version.h (VERSION): Bump to 2.3.1.

	* Make-dist: Add back one of the tar invocations removed before.

	* stdlib/Makefile (distribute): Add allocalim.h.

	* sysdeps/generic/bits/libc-tsd.h [!(USE_TLS && HAVE___THREAD)]
	(__libc_tsd_address): Use correct variable name.
	Patch by Stefan Jones <stefan.jones@multigig.com>.

	* sysdeps/unix/sysv/linux/ia64/getcontext.S: Add missing ;;.
	Reported by edwardsg@sgi.com [PR libc/4678].

	* Versions.def (libc): Add GLIBC_2.3.1.
	(libpthread): Add GLIBC_2.3.1.

	* include/signal.h: Add libc_hidden_proto for __sigwait, __sigwaitinfo,
	and __sigtimedwait.
	* signal/Versions: Add __sigtimedwait, __sigwait, and __sigwaitinfo.
	* sysdeps/unix/sysv/linux/sigtimedwait.c (__sigtimedwait): Add
	libc_hidden_def.
	* sysdeps/unix/sysv/linux/sigwait.c (__sigwait): Likewise.
	* sysdeps/unix/sysv/linux/sigwaitinfo.c (__sigwaitinfo): Likewise.

	* include/sys/msg.h: Declare __libc_msgrcv and __libc_msgsnd.
	* sysdeps/unix/sysv/linux/msgrcv.c (__msgrcv): Rename to __libc_msgrcv
	and make old name an alias.
	* sysdeps/unix/sysv/linux/msgsnd.c (__msgsnd): Rename to __libc_msgsnd
	and make old name an alias.
	* sysvipc/Versions (libc) [GLIBC_PRIVATE]: Add __libc_msgrcv and
	__libc_msgsnd.

	* include/sys/uio.h: Declare __libc_readv and __libc_writev.
	* misc/Versions (libc) [GLIBC_PRIVATE]: Add __libc_readv and
	__libc_writev.
	* sysdeps/generic/readv.c (__readv): Rename to __libc_readv and make
	old name an alias.
	* sysdeps/posix/readv.c: Likewise
	* sysdeps/unix/sysv/aix/readv.c: Likewise.
	* sysdeps/unix/sysv/linux/readv.c: Likewise.
	* sysdeps/generic/writev.c (__writev): Rename to __libc_writev and make
	old name an alias.
	* sysdeps/posix/writev.c: Likewise
	* sysdeps/unix/sysv/aix/writev.c: Likewise.
	* sysdeps/unix/sysv/linux/writev.c: Likewise.

	* include/sys/wait.h: Declare __waitid.
	* posix/Versions (libc) [GLIBC_PRIVATE]: Add __waitid.
	* sysdeps/generic/waitid.c (waitid): Rename to __waitid and make old
	name an alias.
	* sysdeps/posix/waitid.c: Likewise.
	* sysdeps/unix/sysv/aix/waitid.c: Likewise.

	* sysdeps/unix/sysv/linux/syscalls.list: Add creat syscall.

2002-10-07  Jakub Jelinek  <jakub@redhat.com>

	* include/alloca.h (__libc_use_alloca, __libc_alloca_cutoff): New
	prototypes.
	(__MAX_ALLOCA_CUTOFF): Define.
	Include allocalim.h.
	* resolv/nss_dns/dns-host.c (_nss_dns_gethostbyname2_r,
	_nss_dns_gethostbyaddr_r): Use alloca or malloc to allocate
	host_buffer depending on __libc_use_alloca.
	* resolv/nss_dns/dns-network.c (_nss_dns_getnetbyname_r,
	_nss_dns_getnetbyaddr_r): Use alloca or malloc to allocate
	net_buffer depending on __libc_use_alloca.
	* resolv/res_query.c (res_nquery): Use alloca or malloc to allocate
	buf depending on __libc_use_alloca.
	* resolv/gethnamaddr.c (gethostbyname2, gethostbyaddr): Likewise.
	* stdio-common/vfprintf.c (vfprintf): Use __libc_use_alloca
	instead of hardcoded constants.
	Pass proper size argument to alloca and compute end for wide char
	version.
	* stdio-common/printf_fp.c (__printf_fp): Use __libc_use_alloca
	instead of hardcoded constants.
	* string/strcoll.c (strcoll): Likewise.
	* string/strxfrm.c (strxfrm): Likewise.
	* sysdeps/posix/readv.c (__readv): Likewise.
	* sysdeps/posix/writev.c (__writev): Likewise.
	* sysdeps/generic/allocalim.h: New file.

2002-10-08  Roland McGrath  <roland@redhat.com>

	* configure.in (aux_missing warning): Change "too old" to
	"incompatible versions", since for autoconf it's "too new" right now.
	* configure: Regenerated.

	* configure.in (AUTOCONF): New check to set it.  Set to "no" if the
	one found doesn't work on our configure.in.
	* configure: Regenerated.
	* config.make.in (AUTOCONF): New substituted variable.
	* Makefile (autoconf-it-cvs): New canned sequence, broken out of ...
	(autoconf-it): ... here, use that instead of defining conditionally.
	Use $(AUTOCONF) instead of literal autoconf.
	[$(AUTOCONF) != no] (configure, %/configure): Protect these rules
	with this condition.
	* Make-dist (autoconf-it, configure, %/configure): Copy those changes.

2002-10-08  Ulrich Drepper  <drepper@redhat.com>

	* Make-dist (dist): Cleanup a bit.  We are not interested in the
	14 char filename limit anymore.  Remove intermediate files and
	symlinks.

2002-10-05  Ulrich Drepper  <drepper@redhat.com>

	* po/sk.po: Update from translation team.
	* po/tr.po: Likewise.
	* po/gl.po: Likewise.

2002-10-05  Kaz Kojima  <kkojima@rr.iij4u.or.jp>

	* elf/tls-macros.h: Fix SH version of macros so as to match ABI syntax.

2002-10-03  Ulrich Drepper  <drepper@redhat.com>

	* version.h (RELEASE): Change to stable.

2002-10-03  Jakub Jelinek  <jakub@redhat.com>

	* sysdeps/unix/sysv/linux/_exit.c (__syscall_exit,
	__syscall_exit_group): New prototypes.

2002-10-03  Ulrich Drepper  <drepper@redhat.com>

	* glibc 2.3 released.


See ChangeLog.13 for earlier changes.
